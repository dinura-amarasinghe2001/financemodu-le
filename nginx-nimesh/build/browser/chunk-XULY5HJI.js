import{a as ct}from"./chunk-BT3QW6HI.js";import{a as lt}from"./chunk-LFICRIBC.js";import{a as st}from"./chunk-IXCLTE66.js";import{a as nt}from"./chunk-PMESUWSZ.js";import{a as at}from"./chunk-Z4PJH56D.js";import{a as ot}from"./chunk-X77UPS6A.js";import{a as rt}from"./chunk-3FV7DAM6.js";import{a as ze}from"./chunk-ALJ75YVM.js";import{a as Ze,b as et,c as tt,d as it}from"./chunk-G4IOVJWU.js";import{a as Xe}from"./chunk-A6AKI5EW.js";import{a as Ye}from"./chunk-M5AHF4UO.js";import{a as Ue}from"./chunk-Y6RDMGCV.js";import{a as $e}from"./chunk-CI6T4FGN.js";import{a as Ge,b as Je}from"./chunk-T73PE35A.js";import"./chunk-RHLCCWT6.js";import{d as Ke}from"./chunk-6GYTZCHH.js";import{h as He}from"./chunk-ZGGKBBB7.js";import{a as Re}from"./chunk-E4TC4E2W.js";import{a as F}from"./chunk-YEGTZ3HQ.js";import"./chunk-QJXHZJQJ.js";import{a as be}from"./chunk-NKWJDJWK.js";import{a as Le}from"./chunk-3N5N6CVQ.js";import{a as xe}from"./chunk-QQNGDF4M.js";import"./chunk-YK5MGRE7.js";import"./chunk-OT3AQSDR.js";import{b as Fe}from"./chunk-HN3GTZ22.js";import{b as Be}from"./chunk-2V7PXVXU.js";import{a as ke,c as Me,d as De}from"./chunk-4WAQRQWE.js";import{d as we}from"./chunk-KKTU7MAV.js";import{b as We}from"./chunk-HLRQKUHW.js";import"./chunk-5RBAZJQA.js";import{a as Oe,b as je}from"./chunk-LMUZFXJ5.js";import"./chunk-6F4FOUKE.js";import{F as Ee,J as Ne,K as Pe,M as Qe,O as Ve,P as qe,i as ve,j as he,l as Ce,q as Ie,u as B,w as Se,y as Te,z as Ae}from"./chunk-MXRUEL7B.js";import{b as ye,c as _e}from"./chunk-PNSBUHWU.js";import"./chunk-GRVU3NMS.js";import{g as pe}from"./chunk-TEYA6QDP.js";import"./chunk-JTAP5U5F.js";import{a as fe,d as ge}from"./chunk-VPJKTFM7.js";import{fa as de,ia as ue}from"./chunk-GXFYRQIF.js";import"./chunk-T4I3R2GV.js";import{b as se,d as me}from"./chunk-DJWEABC6.js";import{h as ie,i as ne,j as oe,m as re,p as ae,q as le,r as ce}from"./chunk-MZLVPJ5Q.js";import{Aa as g,Ac as Y,Bc as c,Db as X,Dc as b,E as L,Ec as Z,Fc as Q,Gc as V,Hc as q,Kb as w,Lc as ee,M as G,Qc as N,R as J,Rc as te,Sc as k,Tb as s,a as $,aa as H,b as U,ba as K,cc as n,dc as o,ec as x,g as O,ic as D,m as z,nb as a,oa as E,ob as S,oc as I,qc as p,y as j,za as f}from"./chunk-2GFQMTJ2.js";var ut=(l,v)=>({"bg-indigo-600 group-hover:bg-indigo-700 text-white":l,"bg-transparent text-black":v});function pt(l,v){l&1&&(n(0,"div",4)(1,"div",5)(2,"div",6)(3,"div",7)(4,"div",8)(5,"fuse-alert",9),c(6," Please Select Vehicle Before Create a Invoice. "),o()()()()()()),l&2&&(a(5),s("appearance","soft")("dismissible",!0)("dismissed",!0)("name","alertBox4")("type","warn"))}function vt(l,v){if(l&1){let e=D();n(0,"button",17),I("click",function(){f(e);let t=p(2);return g(t.createInvoice())}),n(1,"span",18),c(2,"Create"),o()()}}function ht(l,v){if(l&1&&(n(0,"div",33),c(1),o()),l&2){let e=p(2);a(),b(" ",e.invoiceDetails.vehicleOwnerContactNumber2," ")}}function ft(l,v){if(l&1){let e=D();n(0,"button",51),I("click",function(){f(e);let t=p(2);return g(t.createPayments())}),c(1," Add Payment "),o()}}function gt(l,v){if(l&1){let e=D();n(0,"div",56)(1,"span",57),c(2),N(3,"currency"),o(),n(4,"button",58),I("click",function(){let t=f(e).$implicit,r=p(3);return g(r.deletePayment(t))}),x(5,"mat-icon",59),o()()}if(l&2){let e=v.$implicit;a(2),Z(" ",k(3,3,e.amount," ")," - ",e.paymentType," "),a(3),s("svgIcon","heroicons_outline:x-mark")}}function yt(l,v){if(l&1&&(n(0,"div",52)(1,"div",53),c(2),N(3,"currency"),o(),n(4,"div",54),w(5,gt,6,6,"div",55),o()()),l&2){let e=p(2);a(2),b(" Payments Made (Total: ",k(3,2,e.totalPaidAmount," "),") "),a(3),s("ngForOf",e.invoicePayments)}}function _t(l,v){if(l&1&&(n(0,"mat-option",66),c(1),o()),l&2){let e=v.$implicit;s("value",e),a(),b(" ",e," ")}}function xt(l,v){if(l&1){let e=D();n(0,"div",60)(1,"mat-form-field",61)(2,"mat-select",62),q("valueChange",function(t){f(e);let r=p(2);return V(r.selectedPrintType,t)||(r.selectedPrintType=t),g(t)}),w(3,_t,2,2,"mat-option",63),o()(),n(4,"button",64),I("click",function(){f(e);let t=p(2);return g(t.printInvoice(t.selectedPrintType))}),n(5,"mat-icon",65),c(6,"print"),o(),n(7,"span"),c(8,"Print"),o()()()}if(l&2){let e=p(2);a(2),Q("value",e.selectedPrintType),a(),s("ngForOf",e.printTypes)}}function bt(l,v){if(l&1&&(n(0,"mat-option",66),c(1),o()),l&2){let e=v.$implicit,i=p(4);s("value",e),a(),b(" ",i.getWorkLabel(e)," ")}}function wt(l,v){if(l&1){let e=D();n(0,"div",74)(1,"div",75),x(2,"input",76),n(3,"mat-autocomplete",77,0),I("optionSelected",function(t){let r=f(e).index,m=p(3);return g(m.onWorkSelected(t.option.value,r))}),w(5,bt,2,2,"mat-option",63),N(6,"async"),o()(),n(7,"input",78),q("ngModelChange",function(t){let r=f(e).$implicit;return V(r.qty,t)||(r.qty=t),g(t)}),I("ngModelChange",function(){let t=f(e).index,r=p(3);return g(r.onQtyChange(t))}),o(),n(8,"input",79),q("ngModelChange",function(t){let r=f(e).$implicit;return V(r.types,t)||(r.types=t),g(t)}),o(),n(9,"input",80),N(10,"number"),I("input",function(t){let r=f(e).$implicit,m=p(3);return g(m.onAmountInput(t,r))}),o()()}if(l&2){let e=v.$implicit,i=v.index,t=Y(4),r=p(3);a(2),s("formControl",r.treatmentControls[i])("matAutocomplete",t),a(),s("displayWith",r.getWorkLabel),a(2),s("ngForOf",te(6,8,r.filteredTreatments$[i])),a(2),Q("ngModel",e.qty),s("disabled",e.sourceType==="line"),a(),Q("ngModel",e.types),a(),s("value",k(10,10,e.amount,"1.0-0"))}}function Ct(l,v){if(l&1&&(n(0,"div",67)(1,"div",68)(2,"div",69)(3,"div",70)(4,"div",71)(5,"div",72),c(6," Description "),o(),n(7,"div",72),c(8," Quantity "),o(),n(9,"div",72),c(10," Type "),o(),n(11,"div",72),c(12," Amount "),o()(),w(13,wt,11,13,"div",73),o()()()()),l&2){let e=p(2);a(13),s("ngForOf",e.vehicleEstimateTreatments)}}function It(l,v){if(l&1&&(n(0,"div",88)(1,"div",89),c(2),N(3,"currency"),o(),n(4,"div",90),x(5,"mat-icon",91),n(6,"div",92),c(7,"22.2%"),o()()()),l&2){let e=p(3);a(2),b(" ",k(3,2,e.dueAmount," ")," "),a(3),s("svgIcon","heroicons_solid:arrow-up-circle")}}function St(l,v){l&1&&(n(0,"div",88)(1,"div",89),c(2," UNPAID "),o(),n(3,"div",90),x(4,"mat-icon",91),o()()),l&2&&(a(4),s("svgIcon","heroicons_solid:arrow-up-circle"))}function Tt(l,v){l&1&&(n(0,"div",88)(1,"div",89),c(2," PAID "),o(),n(3,"div",90),x(4,"mat-icon",91),o()()),l&2&&(a(4),s("svgIcon","heroicons_solid:arrow-up-circle"))}function At(l,v){if(l&1&&(n(0,"div",81)(1,"div",82)(2,"div",83)(3,"div",84)(4,"div",85)(5,"div",86),c(6," Total Amount "),o(),x(7,"mat-icon",87),o(),n(8,"div",88)(9,"div",89),c(10),N(11,"currency"),o(),n(12,"div",90),x(13,"mat-icon",91),n(14,"div",92),c(15,"42.9%"),o()()()(),n(16,"div",84)(17,"div",85)(18,"div",86),c(19," Paid Amount "),o(),x(20,"mat-icon",87),o(),n(21,"div",88)(22,"div",89),c(23),N(24,"currency"),o(),n(25,"div",90),x(26,"mat-icon",93),n(27,"div",94),c(28,"13.1%"),o()()()(),n(29,"div",84)(30,"div",85)(31,"div",86),c(32,"Due Amount"),o(),x(33,"mat-icon",87),o(),w(34,It,8,5,"div",95)(35,St,5,1,"div",95)(36,Tt,5,1,"div",95),o()()()()),l&2){let e=p(2);a(7),s("svgIcon","heroicons_mini:information-circle")("matTooltip","Score is calculated by using the historical ratio between Page Views and Visitors. Best score is 1000, worst score is 0."),a(3),b(" ",k(11,13,e.totalAmount," ")," "),a(3),s("svgIcon","heroicons_solid:arrow-up-circle"),a(7),s("svgIcon","heroicons_mini:information-circle")("matTooltip","Average Ratio is the average ratio between Page Views and Visitors"),a(3),b(" ",k(24,16,e.totalPaidAmount," ")," "),a(3),s("svgIcon","heroicons_solid:arrow-down-circle"),a(7),s("svgIcon","heroicons_mini:information-circle")("matTooltip","Predicted Ratio is calculated by using historical ratio, current trends and your goal targets."),a(),s("ngIf",e.dueAmount),a(),s("ngIf",e.totalPaidAmount===0),a(),s("ngIf",e.totalPaidAmount===e.totalAmount&&e.totalPaidAmount!=0)}}function Et(l,v){if(l&1){let e=D();n(0,"div",10)(1,"div",11)(2,"div",12)(3,"div",13)(4,"div",14),c(5),o(),n(6,"div",15),w(7,vt,3,0,"button",16),n(8,"button",17),I("click",function(){f(e);let t=p();return g(t.createEmptyLineitem())}),n(9,"span",18),c(10,"Add Item"),o()(),n(11,"button",17),I("click",function(){f(e);let t=p();return g(t.createEmptyLine())}),n(12,"span",18),c(13,"Add work"),o()()()(),n(14,"div",19)(15,"div",20)(16,"div",21)(17,"div",22)(18,"div",23),x(19,"mat-icon",24),o(),n(20,"div",25)(21,"div",26),c(22,"Vehicle"),o(),n(23,"div",27),c(24),o(),n(25,"div",28)(26,"div",29),c(27),o(),n(28,"div",30),c(29),o()()()(),n(30,"div",22)(31,"div",31),x(32,"mat-icon",24),o(),n(33,"div",25)(34,"div",26),c(35,"Owner"),o(),n(36,"div",27),c(37),o(),n(38,"div",32)(39,"div",33),c(40),o(),w(41,ht,2,1,"div",34),o()()()()(),n(42,"div",35)(43,"div",36)(44,"div",37)(45,"div",31),x(46,"mat-icon",24),o(),n(47,"div",38)(48,"div",39),c(49," Select Payment Type "),o(),n(50,"mat-button-toggle-group",40),q("ngModelChange",function(t){f(e);let r=p();return V(r.paymentType,t)||(r.paymentType=t),g(t)}),I("ngModelChange",function(){f(e);let t=p();return g(t.addFullAmount(t.paymentType))}),n(51,"mat-button-toggle",41),c(52,"Advance"),o(),n(53,"mat-button-toggle",42),c(54,"Partial"),o(),n(55,"mat-button-toggle",43),c(56,"Full"),o()(),n(57,"div",44)(58,"input",45),N(59,"number"),I("input",function(t){f(e);let r=p();return g(r.onPaymentAmountInput(t))}),o(),w(60,ft,2,0,"button",46),o()(),w(61,yt,6,5,"div",47),o(),w(62,xt,9,2,"div",48),o()()()()(),w(63,Ct,14,1,"div",49)(64,At,37,19,"div",50),o()}if(l&2){let e=p();a(4),s("ngClass",ee(22,ut,e.invoiceDetails.invoiceNumber||e.invoiceNumber,!(e.invoiceDetails.invoiceNumber||e.invoiceNumber))),a(),b(" ",e.invoiceDetails.invoiceNumber||e.invoiceNumber," "),a(2),s("ngIf",e.isCreating),a(12),s("svgIcon","mat_outline:directions_car_filled"),a(5),b(" ",e.invoiceDetails.licenseNo||e.invoiceDetails.vehicleLicenseNumber," "),a(3),b(" ",e.invoiceDetails.vehicleBrand," "),a(2),b(" ",e.invoiceDetails.vehicleModel," "),a(3),s("svgIcon","heroicons_outline:user-circle"),a(5),b(" ",e.invoiceDetails.vehicleOwnerName," "),a(3),b(" ",e.invoiceDetails.vehicleOwnerContactNumber1," "),a(),s("ngIf",e.invoiceDetails.vehicleOwnerContactNumber2),a(5),s("svgIcon","heroicons_outline:banknotes"),a(4),Q("ngModel",e.paymentType),a(8),s("value",k(59,19,e.paymentAmount,"1.0-0")),a(2),s("ngIf",e.invoiceID),a(),s("ngIf",e.invoicePayments.length>0),a(),s("ngIf",e.invoiceID),a(),s("ngIf",e.vehicleEstimateTreatments.length>0),a(),s("ngIf",e.vehicleEstimateTreatments.length>0)}}var mt=(()=>{class l{constructor(e,i,t,r,m,C,h,u,y,d){this._estimateService=e,this._estimateTreatmentService=i,this._vatService=t,this._invoiceService=r,this._invoiceItemService=m,this._jobCardRegistryService=C,this._snackBarService=h,this._invoicePaymentsService=u,this._selectedCardService=y,this._vehicleTreatmentRegistryService=d,this._unsubscribeAll=new z,this.isUpdating=!1,this.showDetails=!1,this.bincardsave=E(st),this.vehicleEstimateTreatments=[],this._fuseConfirmationService=E(xe),this._fuseAlertService=E(Oe),this.selectedVehicleandClientDetails=null,this.router=E(me),this.totalAmount=0,this.netTotalAmount=0,this.vatDetails=[],this.selectedVats=[],this.invoicePayments=[],this.paymentAmount=null,this.totalPaidAmount=0,this.dueAmount=null,this.paymentType="",this.treatmentControl=new B,this.treatmentControls={},this.filteredTreatments$=[],this.treatments=[],this.resentEsitamte=[],this.showAlert=!1,this.invSts="",this.searchInputControl=new B,this._route=E(se),this.inventoryService=E(lt),this.gatePassService=E(Xe),this._fuseNavigationService=E(be),this.inventorybatch=E(ct),this.isCreating=!1,this.printTypes=["Full Invoice","Customer"],this.selectedPrintType=this.printTypes[0],this.searchInputControl.valueChanges.subscribe(T=>{}),this._fuseNavigationService.getComponent("mainNavigation").close()}ngOnInit(){this.invoiceDetails=Nt(),this._selectedCardService.selectedCard$.subscribe(e=>{if(!e){this.showAlert=!0,this.show("alertBox4");return}this.vehicleLicenseNumber=e?.vehicle?.licenseNo??"",this.invoiceDetails.vehicleLicenseNumber=e?.vehicle?.licenseNo??"",this.invoiceDetails.vehicleBrand=e?.vehicle?.brand??"",this.invoiceDetails.vehicleModel=e?.vehicle?.model??"",this.invoiceDetails.vehicleOwnerName=e?.client?.name??"",this.invoiceDetails.vehicleOwnerContactNumber1=e?.client?.contactNumber1??"",this.invoiceDetails.vehicleOwnerContactNumber2=e?.client?.contactNumber2??""})}getWorkLabel(e){return e&&(e.description||e.repairName||(e.name&&e.code?`${e.name} - ${e.code}`:null)||e.paintName||e.fittingChargeName||e.otherName)||""}filterTreatments(e){return this.treatments.filter(i=>this.getWorkLabel(i).toLowerCase().includes(e))}onQtyChange(e){let i=this.vehicleEstimateTreatments[e],t=Number(i.qty)||0,r=Number(i.lastSellingPrice)||0;i.amount=t*r,this.calculateTotals()}onWorkSelected(e,i){let t=this.vehicleEstimateTreatments[i],r=Number(t.qty)||1;t.id=e.id||0,t.descriptions=this.getWorkLabel(e),t.lastSellingPrice=e.price||e.lastSellingPrice||0,t.amount=r*t.lastSellingPrice,t.types=e.treatmentType||"PARTS",this.treatmentControls[i].setValue(e),this.calculateTotals()}calculateTotals(){let e=this.vehicleEstimateTreatments.reduce((i,t)=>i+(t.amount||0),0);this.totalAmount=e,this.netTotalAmount=this.totalAmount-(this.paymentAmount||0)}createEmptyLineitem(){this.isCreating=!0;let e=this.vehicleEstimateTreatments.length;this.vehicleEstimateTreatments.push({id:0,invoiceDate:null,descriptions:"",qty:"",amount:0,types:"",invoice:null,sourceType:"item"});let i=new B("");this.treatmentControls[e]=i,this.filteredTreatments$[e]=i.valueChanges.pipe(G(300),J(),K(t=>{let r=typeof t=="string"?t:this.getWorkLabel(t);return this.inventoryService.query({"keyword.contains":r,"availableQuantity.greaterThan":0})}),j(t=>t.body||[]))}batchlineedit(){return new Promise((e,i)=>{let m=this.vehicleEstimateTreatments.filter(d=>d.types==="PARTS").map(d=>{let _=d.descriptions||"";return{code:_.includes("-")?_.split("-")[1].trim():_.trim(),qty:d.qty||0,batchid:d.id||0}}).filter(d=>d.qty>0);if(m.length===0)return e();let C=()=>new Promise((d,_)=>{let T=m.map(A=>this.inventoryService.query({"id.equals":A.batchid}).pipe(j(P=>{let M=P.body?.[0]?.availableQuantity||0;return{code:A.code,requestedQty:A.qty,availableQty:M}})));L(T).subscribe({next:A=>{let P=A.find(M=>M.requestedQty>M.availableQty);if(P)return alert(`Not enough stock for item ${P.code}. Requested: ${P.requestedQty}, Available: ${P.availableQty}`),d();y()},error:_})}),h=[],u=(d,_=0)=>new Promise((T,A)=>{this.inventorybatch.query({"itemId.equals":d.batchid,"quantity.greaterThan":0,sort:["id,asc"],page:_,size:1}).subscribe({next:P=>{let M=P.body||[];if(!M.length)return console.warn(`Not enough stock to fulfill ${d.code}`),T();let W=M[0],R=Math.min(d.qty,W.quantity),dt=W.quantity-R;h.push(this.inventorybatch.partialUpdate({id:W.id,quantity:dt})),d.qty-=R,d.qty>0?u(d,_+1).then(T).catch(A):T()},error:A})}),y=()=>O(this,null,function*(){for(let d of m)yield u(d);if(h.length===0)return e();L(h).subscribe({next:()=>e(),error:i})});C().catch(i)})}inventoryedit(){return new Promise((e,i)=>{let m=this.vehicleEstimateTreatments.filter(h=>h.types==="PARTS").map(h=>{let u=h.descriptions||"";return{code:u.includes("-")?u.split("-")[1].trim():u.trim(),qty:h.qty||0,batchid:h.id||0}}).filter(h=>h.qty>0);if(m.length===0)return e();let C=0;m.forEach(h=>{this.inventoryService.query({"id.equals":h.batchid}).subscribe({next:u=>{let y=u.body?.[0];if(!y)return;let d=y.availableQuantity-h.qty;if(d<0)return;let _=U($({},y),{availableQuantity:d});this.inventoryService.partialUpdate(_).subscribe({next:()=>{C++,C===m.length&&e()},error:i})},error:i})})})}bincardadd(){return new Promise((e,i)=>{let m=this.vehicleEstimateTreatments.filter(u=>u.types==="PARTS").map(u=>{let y=u.descriptions||"";return{code:y.includes("-")?y.split("-")[1].trim():y.trim(),qty:u.qty||0,batchid:u.id||0,name:u.descriptions||""}}).filter(u=>u.qty>0);if(m.length===0)return e();let C="Sold item",h=0;m.forEach(u=>{this.inventoryService.query({"id.equals":u.batchid}).subscribe({next:y=>{let d=y.body?.[0];if(!d)return;let _=d.availableQuantity||0,T=u.qty,A={id:null,qtyOut:T,recordDate:F(),lmd:F(),itemCode:u.code,reference:u.name,opening:_,closing:_-T,description:C};this.bincardsave.create(A).subscribe({next:()=>{h++,h===m.length&&e()},error:i})},error:i})})})}processInventoryFlow(){return O(this,null,function*(){try{yield this.batchlineedit(),yield this.inventoryedit(),yield this.bincardadd(),console.log("All inventory processes completed successfully.")}catch(e){console.error("Error during inventory process flow:",e)}})}createEmptyLine(){this.isCreating=!0;let e=this.vehicleEstimateTreatments.length;this.vehicleEstimateTreatments.push({id:0,invoiceDate:null,descriptions:"",qty:"",amount:0,types:"",invoice:null,sourceType:"line"}),this.treatmentControls[e]=new B("");let i={page:0,size:2e3};this._vehicleTreatmentRegistryService.query(i).subscribe(t=>{this.treatments=t.body||[],this.filteredTreatments$[e]=this.treatmentControls[e].valueChanges.pipe(H(""),j(r=>{let m=typeof r=="string"?r.toLowerCase():this.getWorkLabel(r).toLowerCase();return this.filterTreatments(m)}))})}dismiss(e){this._fuseAlertService.dismiss(e)}show(e){this._fuseAlertService.show(e)}createInvoice(){return O(this,null,function*(){if(this.paymentType===""){this._snackBarService.open("Please Add Payment!","Close",{duration:3e3});return}let e=yield this.getNexInvID(),i={id:null,customerVATNumber:this.customerVATNumber,vehicleID:this.invoiceDetails.vehicleID,vehicleBrand:this.invoiceDetails.vehicleBrand,vehicleModel:this.invoiceDetails.vehicleModel,vehicleLicenseNumber:this.vehicleLicenseNumber,vehicleOwnerID:this.invoiceDetails.vehicleOwnerID,vehicleOwnerName:this.invoiceDetails.vehicleOwnerName,vehicleOwnerContactNumber1:this.invoiceDetails.vehicleOwnerContactNumber1,vehicleOwnerContactNumber2:this.invoiceDetails.vehicleOwnerContactNumber2,jobID:this.jobID??null,totalNetAmount:this.totalAmount,discountRate:this.invoiceDetails.discountRate,discountAmount:this.invoiceDetails.discountAmount,totalAmount:this.totalAmount,netTotalAmount:this.netTotalAmount,vatAmount:this.selectedVats.reduce((t,r)=>t+(r.vatRate||0),0),invoiceDate:F(),invoiceNumber:e,insuranceName:this.insuranceName,invoiceStatus:this.paymentAmount===this.totalAmount?"PAID":"UNPAID"};this.processInventoryFlow(),this._invoiceService.create(i).subscribe(t=>{this.invoiceID=t.body.id,this.isCreating=!1,this.invoiceNumber=t.body.invoiceNumber,this.createPayments(t.body.id),this.createInvoiceItem(t.body.id)})})}createPayments(e){let i=e||this.invoiceID,t={id:null,paymentType:this.paymentType,amount:this.paymentAmount,invoice:i?{id:i}:null};this._invoicePaymentsService.create(t).subscribe(r=>{this.getAllPayments(i),this.paymentAmount=null})}clickLog(){alert("Hellooo")}getAllPayments(e){let i={size:1e3,"invoiceId.equals":e};this._invoicePaymentsService.query(i).subscribe(t=>{this.invoicePayments=t.body||[],this.totalPaidAmount=this.invoicePayments.reduce((r,m)=>r+(m.amount||0),0),this.dueAmount=Math.max(this.totalAmount-this.totalPaidAmount,0)})}deletePayment(e){console.log("Deleting payment with ID:",e.id),this._fuseConfirmationService.open({title:"Delete Vehicle",message:"Are you sure you want to delete this Payment? This action cannot be undone!",icon:{name:"heroicons_outline:exclamation-triangle",color:"warn"},actions:{confirm:{label:"Delete",color:"warn"}}}).afterClosed().subscribe(t=>{t==="confirmed"&&this._invoicePaymentsService.delete(e.id).subscribe(r=>{this.getAllPayments(e.invoice.id)})})}createInvoiceItem(e){let i=this.vehicleEstimateTreatments.map(t=>{let r={id:null,invoiceDate:F(),descriptions:`${t.descriptions||""} - ${t.qty}`,amount:t.amount,types:t.types,invoice:{id:e}};return this._invoiceItemService.create(r)});L(i).subscribe(t=>{console.log("All Invoice Items created successfully:",t);let r={"jobCardNumber.equals":this.jobID};this.gatePassService.query(r).subscribe(m=>{if(m.body&&m.body.length>0){console.log("Gate Pass Found: ",m.body[0]);let C={id:m.body[0].id,invoiceNumber:e.toString()};console.log("Updated Data: ",C),this.gatePassService.partialUpdate(C).subscribe(()=>{console.log("Gate Pass Updated Successfully")}),this._snackBarService.open("Invoice Created Successfully!","Close",{duration:3e3})}}),this._snackBarService.open("Invoice Created Successfully!","Close",{duration:3e3})})}printInvoice(e){let i=this.invoiceID;switch(this.router.navigate(["/invoices-print/",i]).then(()=>{}),e){case"Full Invoice":this.router.navigate(["/invoices-print-final/",i]).then(()=>{});break;case"Summary":this.router.navigate(["/invoices-print/",i]).then(()=>{});break;case"Customer":this.router.navigate(["/invoices-print-customer/",i]).then(()=>{});break;default:console.warn("Unknown print type selected")}}onAmountInput(e,i){let r=e.target.value.replace(/,/g,""),m=parseFloat(r);isNaN(m)?i.amount=0:(i.amount=m,this.calculateTotals())}onPaymentAmountInput(e){let t=e.target.value.replace(/,/g,""),r=parseFloat(t);isNaN(r)?this.paymentAmount=0:this.paymentAmount=r}addFullAmount(e){e==="full"&&(this.paymentAmount=this.totalAmount),e==="partial"&&(this.paymentAmount=this.totalAmount/4),e==="advance"&&(this.paymentAmount=Math.round(this.totalAmount*.1*100)/100)}getNexInvID(){let e={page:0,size:1,sort:"id,desc"};return new Promise(i=>{this._invoiceService.query(e).subscribe(t=>{let r=t.body?.[0],m="INV-000001";r?.invoiceNumber&&(m="INV-"+(parseInt(r.invoiceNumber.replace("INV-",""),10)+1).toString().padStart(6,"0")),i(m)})})}static{this.\u0275fac=function(i){return new(i||l)(S($e),S(Ye),S(at),S(ze),S(rt),S(Ue),S(Re),S(ot),S(Le),S(nt))}}static{this.\u0275cmp=X({type:l,selectors:[["app-invoice-create"]],decls:3,vars:2,consts:[["auto","matAutocomplete"],[1,"absolute","inset-0","flex","min-w-0","flex-col","overflow-auto"],["class","bg-default flex flex-0 flex-col dark:bg-transparent sm:flex-row sm:items-center sm:justify-between sm:px-6 sm:pt-3",4,"ngIf"],["class","flex flex-col gap-4 px-6 mt-3",4,"ngIf"],[1,"bg-default","flex","flex-0","flex-col","dark:bg-transparent","sm:flex-row","sm:items-center","sm:justify-between","sm:px-6","sm:pt-3"],[1,"min-w-0","flex-1","mb-6"],[1,"mt-2"],[1,"flex","justify-between","items-center","mb-6","gap-3"],[1,"flex","flex-col","gap-2","h-16"],[3,"appearance","dismissible","dismissed","name","type"],[1,"flex","flex-col","gap-4","px-6","mt-3"],[1,"rounded-2xl","w-full"],[1,"flex","flex-col","gap-3","bg-white","rounded-xl"],[1,"justify-between","flex","p-3"],[1,"text-xl","rounded-full","px-4","py-2","transition","w-36","text-center",3,"ngClass"],[1,"flex","flex-row","gap-2"],["class","px-4 py-6 bg-gradient-to-r from-indigo-500 to-blue-500 hover:from-indigo-600 hover:to-blue-600 rounded-lg shadow text-white flex items-center transition-all duration-200","mat-button","",3,"click",4,"ngIf"],["mat-button","",1,"px-4","py-6","bg-gradient-to-r","from-indigo-500","to-blue-500","hover:from-indigo-600","hover:to-blue-600","rounded-lg","shadow","text-white","flex","items-center","transition-all","duration-200",3,"click"],[1,""],[1,"flex","flex-row"],[1,"bg-white","flex","flex-row","rounded-lg","p-4","md:p-6","gap-6"],[1,"flex","flex-col","gap-6","lg:flex-row","lg:items-start"],[1,"flex","items-start"],[1,"flex","h-14","w-14","items-center","justify-center","rounded-2xl","bg-indigo-100","text-indigo-800","dark:bg-indigo-600","dark:text-indigo-50"],[1,"text-xl",3,"svgIcon"],[1,"ml-4"],[1,"text-sm","text-secondary","font-medium"],[1,"text-lg","font-semibold"],[1,"flex","flex-wrap","gap-2","mt-2","text-sm"],[1,"bg-amber-500","text-white","px-3","py-1","rounded-lg"],[1,"bg-red-500","text-white","px-3","py-1","rounded-lg"],[1,"flex","h-14","w-14","items-center","justify-center","rounded-2xl","bg-teal-100","text-teal-800","dark:bg-teal-600","dark:text-teal-50"],[1,"text-sm","text-gray-500","mt-2","space-y-1"],[1,"bg-teal-500","text-white","px-3","py-1","rounded-lg"],["class","bg-teal-500 text-white px-3 py-1 rounded-lg",4,"ngIf"],[1,"bg-white","flex","flex-row","rounded-lg","p-4","md:p-6","space-y-6"],[1,"flex","flex-row","gap-6"],[1,"bg-amber-50","p-5","rounded-2xl","shadow-md","flex","flex-col","lg:flex-row","gap-4"],[1,"flex-1"],[1,"text-sm","text-secondary","font-medium","mb-2"],[1,"flex","flex-wrap","gap-2",3,"ngModelChange","ngModel"],["value","advance"],["value","partial"],["value","full"],[1,"mt-4","flex","flex-col","sm:flex-row","gap-4"],["type","text","placeholder","Enter amount",1,"w-full","sm:w-48","text-right","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-amber-400","outline-none",3,"input","value"],["class","bg-amber-500 text-white font-semibold px-6 py-2 rounded-xl shadow-md hover:bg-amber-600 transition transform hover:scale-105",3,"click",4,"ngIf"],["class","w-full lg:w-80 p-6 rounded-2xl",4,"ngIf"],["class","w-full lg:w-52 h-52 bg-amber-50 p-6 rounded-2xl shadow-md flex flex-col items-center",4,"ngIf"],["class","px-6 mt-4 flex justify-center items-center w-full",4,"ngIf"],["class","w-auto mt-6 mb-6 flex justify-center",4,"ngIf"],[1,"bg-amber-500","text-white","font-semibold","px-6","py-2","rounded-xl","shadow-md","hover:bg-amber-600","transition","transform","hover:scale-105",3,"click"],[1,"w-full","lg:w-80","p-6","rounded-2xl"],[1,"text-sm","font-semibold","text-gray-700","mb-3"],[1,"flex","flex-col","gap-3","max-h-44","overflow-y-auto","pr-2"],["class","flex justify-between items-center bg-amber-500 text-white px-4 py-2 rounded-xl shadow hover:bg-amber-600 transition",4,"ngFor","ngForOf"],[1,"flex","justify-between","items-center","bg-amber-500","text-white","px-4","py-2","rounded-xl","shadow","hover:bg-amber-600","transition"],[1,"truncate"],["title","Delete Payment",1,"bg-red-600","hover:bg-red-700","rounded-full","w-6","h-6","flex","items-center","justify-center","text-xs",3,"click"],[1,"text-white",3,"svgIcon"],[1,"w-full","lg:w-52","h-52","bg-amber-50","p-6","rounded-2xl","shadow-md","flex","flex-col","items-center"],["appearance","fill",1,"w-full"],[3,"valueChange","value"],[3,"value",4,"ngFor","ngForOf"],[1,"mt-4","px-4","py-3","bg-gradient-to-r","from-indigo-500","to-blue-500","hover:from-indigo-600","hover:to-blue-600","rounded-lg","shadow","text-white","flex","items-center",3,"click"],[1,"mr-2","text-white"],[3,"value"],[1,"px-6","mt-4","flex","justify-center","items-center","w-full"],[1,"p-4","bg-white","rounded-xl","shadow","w-full","max-w-full"],[1,"overflow-x-auto"],[1,"flex","flex-col","gap-2","min-w-max","text-sm","text-gray-800"],[1,"flex","gap-4","font-semibold","text-gray-700"],[1,"w-1/3","text-lg","bg-amber-400","rounded-lg","text-center","py-2"],["class","flex gap-4",4,"ngFor","ngForOf"],[1,"flex","gap-4"],[1,"relative","w-1/3"],["type","text","matInput","","placeholder","Select Work",1,"w-full","p-3","border","border-gray-300","rounded-lg",3,"formControl","matAutocomplete"],[3,"optionSelected","displayWith"],["type","number","min","0","placeholder","Qty",1,"w-1/3","p-3","border","border-gray-300","rounded-lg","text-right",3,"ngModelChange","ngModel","disabled"],["type","text",1,"w-1/3","p-3","border","border-gray-300","rounded-lg",3,"ngModelChange","ngModel"],["type","text","placeholder","Amount",1,"w-1/3","p-3","text-right","border","border-gray-300","rounded-lg",3,"input","value"],[1,"w-auto","mt-6","mb-6","flex","justify-center"],[1,"bg-white","rounded-3xl","shadow-xl","p-6"],[1,"grid","grid-cols-1","gap-8","sm:grid-cols-3","sm:gap-12"],[1,"flex","flex-col"],[1,"flex","items-center"],[1,"text-secondary","font-medium","leading-5"],[1,"text-hint","ml-1.5","icon-size-4",3,"svgIcon","matTooltip"],[1,"mt-2","flex","items-start"],[1,"text-4xl","font-bold","leading-none","tracking-tight"],[1,"ml-2","flex","items-center"],[1,"text-green-500","icon-size-5",3,"svgIcon"],[1,"ml-1","text-md","font-medium","text-green-500"],[1,"text-red-500","icon-size-5",3,"svgIcon"],[1,"ml-1","text-md","font-medium","text-red-500"],["class","mt-2 flex items-start",4,"ngIf"]],template:function(i,t){i&1&&(n(0,"div",1),w(1,pt,7,5,"div",2)(2,Et,65,25,"div",3),o()),i&2&&(a(),s("ngIf",t.showAlert),a(),s("ngIf",t.invoiceDetails==null?null:t.invoiceDetails.vehicleLicenseNumber))},dependencies:[ce,ie,ne,oe,re,ae,le,pe,he,ve,Ne,Ce,Te,Ie,Ee,Se,Pe,Ae,ge,fe,_e,ye,we,Fe,qe,Ve,ue,de,Be,De,ke,Me,We,Ke,He,je,tt,Ze,et,Je,Ge,it,Qe],encapsulation:2})}}return l})();function Nt(){return{id:null,invoiceNumber:null,insuranceName:null,vehicleID:null,vehicleBrand:null,vehicleModel:null,vehicleLicenseNumber:null,vehicleOwnerID:null,vehicleOwnerName:null,vehicleOwnerContactNumber1:null,vehicleOwnerContactNumber2:null,jobID:null,totalNetAmount:null,discountRate:null,discountAmount:null,totalAmount:null,netTotalAmount:null,vatAmount:null,customerVATNumber:null,invoiceDate:null,invoiceStatus:null}}var Mi=[{path:"",component:mt}];export{Mi as default};
