import{a as Be,b as Pe}from"./chunk-3NQFVCM6.js";import{a as B}from"./chunk-GDZACH7M.js";import{a as me}from"./chunk-VQIWVYPK.js";import{a as de}from"./chunk-7RWLPLTW.js";import{c as we}from"./chunk-XGCX3TDA.js";import{a as he,b as ge,c as _e,d as Me,e as be,f as Ce,g as xe,h as ve,i as Se,j as ye,k as Ie,l as De}from"./chunk-4HPTI4QK.js";import{a as pe,b as fe,c as ue}from"./chunk-Z5CSESBH.js";import{a as D,b as Te}from"./chunk-4IV6I57G.js";import{b as Ee}from"./chunk-T73PE35A.js";import{h as ke}from"./chunk-ZGGKBBB7.js";import{a as ce}from"./chunk-E4TC4E2W.js";import{a as k}from"./chunk-YEGTZ3HQ.js";import{a as ee}from"./chunk-QQNGDF4M.js";import"./chunk-YK5MGRE7.js";import"./chunk-OT3AQSDR.js";import"./chunk-HN3GTZ22.js";import"./chunk-2V7PXVXU.js";import"./chunk-4WAQRQWE.js";import"./chunk-KKTU7MAV.js";import"./chunk-5RBAZJQA.js";import{J as ae,K as re,O as le,P as se,d as O,i as W,j as G,l as te,q as ie,u as oe,z as ne}from"./chunk-MXRUEL7B.js";import{b as Y,c as Z}from"./chunk-PNSBUHWU.js";import{c as Q,g as L}from"./chunk-TEYA6QDP.js";import"./chunk-JTAP5U5F.js";import{a as J,d as K}from"./chunk-VPJKTFM7.js";import"./chunk-GXFYRQIF.js";import"./chunk-T4I3R2GV.js";import{j as $,r as U}from"./chunk-MZLVPJ5Q.js";import{Aa as _,Ac as T,Bc as c,Cc as q,Db as z,Dc as v,Jc as X,Kb as h,L as N,S as R,Tb as d,V as F,cc as r,dc as s,ec as p,fc as M,gc as b,ic as E,nb as l,oa as V,ob as x,oc as C,qc as I,s as P,uc as A,vc as H,wc as j,za as g}from"./chunk-2GFQMTJ2.js";var Re=()=>[5,10,20];function Fe(e,m){e&1&&p(0,"mat-icon",34),e&2&&d("svgIcon","heroicons_outline:plus")}function Ve(e,m){e&1&&p(0,"mat-spinner",35)}function ze(e,m){e&1&&(r(0,"th",36),c(1," ID "),s())}function Ae(e,m){if(e&1&&(r(0,"td",37),c(1),s()),e&2){let i=m.$implicit;l(),v(" ",i.id," ")}}function He(e,m){e&1&&(r(0,"th",38),c(1," Model Name "),s())}function je(e,m){if(e&1&&(r(0,"td",37),c(1),s()),e&2){let i=m.$implicit;l(),v(" ",i.modelName," ")}}function qe(e,m){e&1&&(r(0,"th",38),c(1," Description "),s())}function Xe(e,m){if(e&1&&(r(0,"td",37),c(1),s()),e&2){let i=m.$implicit;l(),v(" ",i.description," ")}}function $e(e,m){e&1&&(r(0,"th",38),c(1," Brand "),s())}function Ue(e,m){if(e&1&&(r(0,"td",37),c(1),s()),e&2){let i=m.$implicit,o=I();l(),v(" ",o.getBrandNameById(i.brand.id)," ")}}function Qe(e,m){e&1&&p(0,"th",39)}function Le(e,m){if(e&1){let i=E();r(0,"td",37)(1,"button",40),C("click",function(){let t=g(i).$implicit,a=I();return _(a.openModelEditDialog(t))}),c(2," Update "),s(),r(3,"button",41),C("click",function(){let t=g(i).$implicit,a=I();return _(a.deleteModel(t))}),c(4," Delete "),s()()}}function Oe(e,m){e&1&&p(0,"tr",42)}function We(e,m){e&1&&p(0,"tr",43)}var Ne=(()=>{class e{constructor(i,o,t,a){this._dialogService=i,this._snackBarService=o,this._modelService=t,this._brandService=a,this.dataSource=new De,this.searchInputControl=new oe,this.allModelDetails=[],this.noRecord=!1,this.isImporting=!1,this.allBrand=[],this.displayedColumns=["id","modelName","brand","action"],this.itemsPerPage=10,this.totalItems=0,this.page=1,this._fuseConfirmationService=V(ee),this.searchInputControl.valueChanges.subscribe(f=>{this.page=0,this.searchModel()})}ngOnInit(){this.getAllModelDetails(),this._brandService.query({size:1e3}).subscribe(i=>{this.allBrand=i.body||[]})}ngAfterViewInit(){this._paginator.page.subscribe(()=>{this.page=this._paginator.pageIndex+1,this.itemsPerPage=this._paginator.pageSize,this.getAllModelDetails()})}getAllModelDetails(){let i={page:this.page-1,size:this.itemsPerPage};this._modelService.query(i).subscribe(o=>{o.body?(this.dataSource.data=o.body,this.totalItems=Number(o.headers.get("X-Total-Count"))):this.dataSource.data=[],this.noRecord=this.dataSource.data.length===0})}searchModel(){let i=this.searchInputControl.value?.trim();if(!i){this.getAllModelDetails();return}let o={page:this.page,size:this.itemsPerPage,"licenseNo.contains":i};this._modelService.query(o).subscribe(t=>{this.totalItems=Number(t.headers.get("X-Total-Count")),this.dataSource.data=t.body||[],this.noRecord=this.dataSource.data.length===0})}openModelEditDialog(i){this._dialogService.open(B,{width:"80vh",maxHeight:"90vh",data:{model:i}}).afterClosed().subscribe(t=>{t&&(this._snackBarService.open("Model Updated Successfully!","Close",{duration:3e3}),this.getAllModelDetails())})}deleteModel(i){this._fuseConfirmationService.open({title:"Delete Model",message:"Are you sure you want to delete this model? This action cannot be undone!",icon:{name:"heroicons_outline:exclamation-triangle",color:"warn"},actions:{confirm:{label:"Delete",color:"warn"}}}).afterClosed().subscribe(t=>{t==="confirmed"&&this._modelService.delete(i.id).subscribe(()=>{this.getAllModelDetails()})})}openModelCreateDialog(){this._dialogService.open(B,{width:"80vh",maxHeight:"90vh"}).afterClosed().subscribe(o=>{o&&(this._snackBarService.open("Model Created Successfully!","Close",{duration:3e3}),this.getAllModelDetails())})}getBrandNameById(i){let o=this.allBrand.find(t=>t.id===i);return o?o.brandName:"-"}onFileUpload(i,o){let t=i.target.files[0];if(!t){console.warn("No file selected.");return}this.isImporting=!0;let a=new FileReader;a.onload=f=>{let u=new Uint8Array(f.target.result),n=Be(u,{type:"array"}),S=n.SheetNames[0],y=n.Sheets[S],w=Pe.sheet_to_json(y);console.log("Parsed Excel Data:",w),this.importModelFromExcel(w),o.value=""},a.onerror=()=>{console.error("Error reading file"),this.isImporting=!1,o.value=""},a.readAsArrayBuffer(t)}importModelFromExcel(i){if(!i.length){console.warn("No data to import.");return}this.isImporting=!0;let o=[...new Set(i.map(a=>a.id).filter(Boolean))],t={page:this.page,size:this.itemsPerPage};o.length&&(t["id.in"]=o.join(",")),console.log("Query Parameters:",t),this._modelService.query(t).subscribe(a=>{let f=a.body||[];console.log("Found existingModel:",f);let u=new Map;f.forEach(n=>{n.id&&u.set(n.id,n)}),P(i).pipe(N(n=>{let S=u.has(n.id),y={id:S?n.id:null,modelName:n.modelName??null,description:n.description??null,opsUnitID:n.opsUnitID??null,createdBy:n.createdBy??null,createdDate:n.createdDate?k(n.createdDate):null,lastModifiedBy:n.lastModifiedBy??null,lastModifiedDate:n.lastModifiedDate?k(n.lastModifiedDate):null,brand:{id:n.brandId??null}};return S?this._modelService.update(y):this._modelService.create(y)}),F(),R(()=>{this.isImporting=!1,console.log("Model import completed."),this.getAllModelDetails()})).subscribe()})}static{this.\u0275fac=function(o){return new(o||e)(x(Q),x(ce),x(de),x(me))}}static{this.\u0275cmp=z({type:e,selectors:[["app-models"]],viewQuery:function(o,t){if(o&1&&A(D,5),o&2){let a;H(a=j())&&(t._paginator=a.first)}},decls:44,vars:18,consts:[["fileInput",""],["paginator",""],[1,"absolute","inset-0","flex","min-w-0","flex-col","overflow-hidden"],[1,"bg-default","flex","flex-0","flex-col","p-6","pb-22","dark:bg-transparent","sm:flex-row","sm:items-center","sm:justify-between","sm:px-10","sm:pb-28","sm:pt-12"],[1,"min-w-0","flex-1"],[1,"mt-2"],[1,"truncate","text-3xl","font-extrabold","leading-7","tracking-tight","sm:leading-10","md:text-4xl"],[1,"mt-6","flex","shrink-0","items-center","sm:ml-4","sm:mt-0"],[1,"fuse-mat-dense","fuse-mat-rounded","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"formControl","autocomplete","placeholder"],["mat-flat-button","",1,"ml-3",3,"click","color"],[1,"icon-size-4",3,"svgIcon"],[1,"ml-2"],[1,"relative","ml-2"],["type","file","accept",".xls, .xlsx",1,"hidden",3,"change"],["mat-flat-button","","color","accent",1,"flex","items-center","space-x-2",3,"click","disabled"],[3,"svgIcon",4,"ngIf"],["diameter","20",4,"ngIf"],[1,"example-table-container","bg-card","-mt-16","h-full","rounded-t-2xl","shadow","overflow-auto"],[1,"flex","flex-col","flex-auto","sm:mb-18","overflow-auto"],["mat-table","","matSort","",1,"w-full","table-fixed","border-separate","border-spacing-y-2","px-6",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","","class","px-4 py-3 text-center font-semibold","style","width: 10%",4,"matHeaderCellDef"],["mat-cell","","class","px-4 py-2",4,"matCellDef"],["matColumnDef","modelName"],["mat-header-cell","","mat-sort-header","","class","px-4 py-3 text-left font-semibold",4,"matHeaderCellDef"],["matColumnDef","description"],["matColumnDef","brand"],["matColumnDef","action"],["mat-header-cell","","class","px-4 py-3 text-left font-semibold",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","","aria-label","Select page of periodic elements",1,"bottom-0","justify-self-end",3,"length","pageSize","pageSizeOptions"],[3,"svgIcon"],["diameter","20"],["mat-header-cell","","mat-sort-header","",1,"px-4","py-3","text-center","font-semibold",2,"width","10%"],["mat-cell","",1,"px-4","py-2"],["mat-header-cell","","mat-sort-header","",1,"px-4","py-3","text-left","font-semibold"],["mat-header-cell","",1,"px-4","py-3","text-left","font-semibold"],["mat-flat-button","","color","primary",1,"fuse-mat-button-large","mr-2",3,"click"],["mat-flat-button","","color","warn",1,"fuse-mat-button-large",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(o,t){if(o&1){let a=E();r(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"h2",6),c(5," Models "),s()()(),r(6,"div",7)(7,"mat-form-field",8),p(8,"mat-icon",9)(9,"input",10),s(),r(10,"button",11),C("click",function(){return g(a),_(t.openModelCreateDialog())}),p(11,"mat-icon",12),r(12,"span",13),c(13,"Create New Model"),s()(),r(14,"div",14)(15,"input",15,0),C("change",function(u){g(a);let n=T(16);return _(t.onFileUpload(u,n))}),s(),r(17,"button",16),C("click",function(){g(a);let u=T(16);return _(u.click())}),h(18,Fe,1,1,"mat-icon",17)(19,Ve,1,0,"mat-spinner",18),r(20,"span"),c(21),s()()()()(),r(22,"div",19)(23,"div",20)(24,"table",21),M(25,22),h(26,ze,2,0,"th",23)(27,Ae,2,1,"td",24),b(),M(28,25),h(29,He,2,0,"th",26)(30,je,2,1,"td",24),b(),M(31,27),h(32,qe,2,0,"th",26)(33,Xe,2,1,"td",24),b(),M(34,28),h(35,$e,2,0,"th",26)(36,Ue,2,1,"td",24),b(),M(37,29),h(38,Qe,1,0,"th",30)(39,Le,5,0,"td",24),b(),h(40,Oe,1,0,"tr",31)(41,We,1,0,"tr",32),s()()(),p(42,"mat-paginator",33,1),s()}o&2&&(l(7),d("subscriptSizing","dynamic"),l(),d("svgIcon","heroicons_solid:magnifying-glass"),l(),d("formControl",t.searchInputControl)("autocomplete","off")("placeholder","Search Models"),l(),d("color","primary"),l(),d("svgIcon","heroicons_mini:plus"),l(6),d("disabled",t.isImporting),l(),d("ngIf",!t.isImporting),l(),d("ngIf",t.isImporting),l(2),q(t.isImporting?"Importing...":"Import Excel"),l(3),d("dataSource",t.dataSource),l(16),d("matHeaderRowDef",t.displayedColumns),l(),d("matRowDefColumns",t.displayedColumns),l(),d("length",t.totalItems)("pageSize",t.itemsPerPage)("pageSizeOptions",X(17,Re)))},dependencies:[U,$,Z,Y,K,J,ue,pe,fe,L,ae,te,ie,re,ne,Ie,he,_e,xe,Me,ge,ve,be,Ce,Se,ye,G,W,O,se,le,we,Te,D,ke,Ee],encapsulation:2})}}return e})();var Pt=[{path:"",component:Ne}];export{Pt as default};
