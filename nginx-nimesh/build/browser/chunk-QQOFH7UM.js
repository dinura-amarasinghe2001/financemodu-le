import{a as se}from"./chunk-XV5PI6EW.js";import{a as ne}from"./chunk-A6AKI5EW.js";import{b}from"./chunk-RHLCCWT6.js";import{d as ae}from"./chunk-6GYTZCHH.js";import{h as re}from"./chunk-ZGGKBBB7.js";import{a as F}from"./chunk-E4TC4E2W.js";import{a as D}from"./chunk-YEGTZ3HQ.js";import{a as ie}from"./chunk-3N5N6CVQ.js";import"./chunk-5RBAZJQA.js";import{a as ee,b as te}from"./chunk-LMUZFXJ5.js";import"./chunk-6F4FOUKE.js";import{A as K,B as Q,K as X,P as Z,l as z,n as W,q as Y,r as q,s as J,u as s,x as H}from"./chunk-MXRUEL7B.js";import{b as $}from"./chunk-PNSBUHWU.js";import"./chunk-GRVU3NMS.js";import{a as V}from"./chunk-LYMDSWFK.js";import"./chunk-JTAP5U5F.js";import{a as A,d as j}from"./chunk-VPJKTFM7.js";import"./chunk-GXFYRQIF.js";import"./chunk-T4I3R2GV.js";import{b as L,d as O}from"./chunk-DJWEABC6.js";import{i as R,j as k,r as U}from"./chunk-MZLVPJ5Q.js";import{Aa as _,Bc as l,Cc as T,Db as M,Dc as B,Kb as y,Tb as d,a as f,b as v,cc as r,dc as a,ec as c,ia as G,ic as C,kb as N,nb as m,oa as p,ob as E,oc as I,qc as x,za as P}from"./chunk-2GFQMTJ2.js";var oe=(()=>{class o{createGatePassFormGroup(t={id:null}){let e=this.convertGatePassToGatePassRawValue(f(f({},this.getFormDefaults()),t));return new J({id:new s({value:e.id,disabled:!0},{nonNullable:!0,validators:[W.required]}),vehicleID:new s(e.vehicleID),vehicleBrand:new s(e.vehicleBrand),vehicleModel:new s(e.vehicleModel),vehicleLicenseNumber:new s(e.vehicleLicenseNumber),vehicleOwnerID:new s(e.vehicleOwnerID),vehicleOwnerName:new s(e.vehicleOwnerName),vehicleOwnerContactNumber1:new s(e.vehicleOwnerContactNumber1),vehicleOwnerContactNumber2:new s(e.vehicleOwnerContactNumber2),fuelLevel:new s(e.fuelLevel),meterReading:new s(e.meterReading),status:new s(e.status),frontView1:new s(e.frontView1),sideRView1:new s(e.sideRView1),sideLView1:new s(e.sideLView1),rearView1:new s(e.rearView1),jobCardNumber:new s(e.jobCardNumber),receiptValue:new s(e.receiptValue),entryDateTime:new s(e.entryDateTime),opsUnitID:new s(e.opsUnitID),invoiceNumber:new s(e.invoiceNumber),ownerBelongings:new s(e.ownerBelongings),createdBy:new s(e.createdBy),createdDate:new s(e.createdDate),lastModifiedBy:new s(e.lastModifiedBy),lastModifiedDate:new s(e.lastModifiedDate),jobCard:new s(e.jobCard)})}getGatePass(t){return this.convertGatePassRawValueToGatePass(t.getRawValue())}resetForm(t,e){let i=this.convertGatePassToGatePassRawValue(f(f({},this.getFormDefaults()),e));t.reset(v(f({},i),{id:{value:i.id,disabled:!0}}))}getFormDefaults(){let t=D();return{id:null,entryDateTime:t,createdDate:t,lastModifiedDate:t}}convertGatePassRawValueToGatePass(t){return v(f({},t),{entryDateTime:D(t.entryDateTime,b),createdDate:D(t.createdDate,b),lastModifiedDate:D(t.lastModifiedDate,b)})}convertGatePassToGatePassRawValue(t){return v(f({},t),{entryDateTime:t.entryDateTime?t.entryDateTime.format(b):void 0,createdDate:t.createdDate?t.createdDate.format(b):void 0,lastModifiedDate:t.lastModifiedDate?t.lastModifiedDate.format(b):void 0})}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275prov=G({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();function de(o,w){if(o&1){let t=C();r(0,"button",35),I("click",function(){P(t);let i=x();return _(i.createGatePass())}),r(1,"span",36),l(2,"Add"),a()()}}function ce(o,w){if(o&1){let t=C();r(0,"button",35),I("click",function(){P(t);let i=x();return _(i.updateGatePass())}),r(1,"span",37),l(2,"Update"),a()()}}function ue(o,w){if(o&1){let t=C();r(0,"button",35),I("click",function(){P(t);let i=x();return _(i.gatePassPrint())}),r(1,"span",37),l(2,"Print"),a()()}}function ge(o,w){o&1&&(r(0,"fuse-alert",8),l(1," Please add images before submitting the form. "),a()),o&2&&d("appearance","soft")("dismissible",!0)("dismissed",!0)("name","alertBox5")("type","warn")}function fe(o,w){if(o&1&&(r(0,"div",42),c(1,"img",43),r(2,"span",44),l(3),a()()),o&2){let t=x().$implicit;m(),d("src",t.preview,N),m(2),T(t.name)}}function pe(o,w){if(o&1){let t=C();r(0,"div",38)(1,"label",39),l(2),a(),r(3,"input",40),I("change",function(i){let n=P(t).index,u=x();return _(u.onImageSelected(i,n))}),a(),y(4,fe,4,2,"div",41),a()}if(o&2){let t=w.$implicit;m(2),B("Image ",t.label,""),m(2),d("ngIf",t.preview)}}var le=(()=>{class o{constructor(t){this._snackBar=t,this.gatePassFormService=p(oe),this.gatePassService=p(ne),this.gatePassImgService=p(se),this.activatedRoute=p(L),this._selectedCardService=p(ie),this._fuseAlertService=p(ee),this._snackBarService=p(F),this._router=p(O),this.isUpdating=!1,this.selectedCard=null,this.gatePassId="",this.gatePassIdForPrint=0,this.editForm=this.gatePassFormService.createGatePassFormGroup(),this.gatePass=this.gatePassFormService.getGatePass(this.editForm),this.horizontalPosition="end",this.verticalPosition="top",this.alert={type:"success",message:""},this.showAlert=!0,this.imageSlots=[{preview:"",file:null,name:"",label:"Front View"},{preview:"",file:null,name:"",label:"Side Right View"},{preview:"",file:null,name:"",label:"Side Left View"},{preview:"",file:null,name:"",label:"Rear View"}]}ngOnInit(){this._selectedCardService.selectedCard$.subscribe(e=>{this.selectedCard=e,e&&(e.vehicle.licenseNo&&(this.showAlert=!1),this.editForm.patchValue({vehicleID:e.vehicle?.id?String(e.vehicle?.id):"",vehicleBrand:e.vehicle?.brand??"",vehicleModel:e.vehicle?.model??"",vehicleLicenseNumber:e.vehicle?.licenseNo??"",vehicleOwnerID:e.client?.id?String(e.client?.id):"",vehicleOwnerName:e.client?.name??"",vehicleOwnerContactNumber1:e.client?.contactNumber1??"",vehicleOwnerContactNumber2:e.client?.contactNumber2??""}))});let t=this.activatedRoute.snapshot.paramMap.get("id");t&&(this.gatePassIdForPrint=Number(t),this.isUpdating=!0,this.gatePassId=t,this.gatePassService.find(Number(t)).subscribe(e=>{let i=e.body;console.log("Front View Image:",i.frontView1),this.imageSlots[0].name=i.frontView1,this.imageSlots[0].name=i.frontView1,i&&(this.gatePassFormService.resetForm(this.editForm,i),this.gatePass=i,i&&(this.gatePassFormService.resetForm(this.editForm,i),this.gatePass=i,i.frontView1&&(this.gatePassImgService.getImageWithAuth(`${V.imgUrl}${i.frontView1}`).subscribe(n=>{this.imageSlots[0].preview=n}),this.imageSlots[0].name=i.frontView1),i.sideRView1&&(this.gatePassImgService.getImageWithAuth(`${V.imgUrl}${i.sideRView1}`).subscribe(n=>{this.imageSlots[1].preview=n}),this.imageSlots[1].name=i.sideRView1),i.sideLView1&&(this.gatePassImgService.getImageWithAuth(`${V.imgUrl}${i.sideLView1}`).subscribe(n=>{this.imageSlots[2].preview=n}),this.imageSlots[2].name=i.sideLView1),i.rearView1&&(this.gatePassImgService.getImageWithAuth(`${V.imgUrl}${i.rearView1}`).subscribe(n=>{this.imageSlots[3].preview=n}),this.imageSlots[3].name=i.rearView1)))}))}onImageSelected(t,e){let n=t.target.files?.[0];if(n){let u=new FileReader;u.onload=()=>{this.imageSlots[e].preview=u.result},u.readAsDataURL(n),this.imageSlots[e].file=n}}createGatePass(){let t=this.editForm.get("vehicleID")?.value;if(!t||t.trim()===""){this.show("alertBox4"),setTimeout(()=>this.dismiss("alertBox4"),4e3);return}this.dismiss("alertBox4");let e=this.gatePassFormService.getGatePass(this.editForm);if(this.imageSlots[0].file===null||this.imageSlots[1].file===null||this.imageSlots[2].file===null||this.imageSlots[3].file===null){this.show("alertBox5"),setTimeout(()=>this.dismiss("alertBox5"),4e3);return}this.dismiss("alertBox5");let i=this.imageSlots.map(n=>n.file).filter(n=>!!n);this.gatePassImgService.uploadImages(i).subscribe({next:n=>{(n?.filePaths).forEach((h,g)=>{this.imageSlots[g]&&(this.imageSlots[g].name=h.fileName)});let S=v(f({},e),{id:null,frontView1:this.imageSlots[0]?.name||null,sideRView1:this.imageSlots[1]?.name||null,sideLView1:this.imageSlots[2]?.name||null,rearView1:this.imageSlots[3]?.name||null});console.log("New Gate Pass Data:",S),this.gatePassService.create(S).subscribe({next:h=>{console.log(" Gate Pass Created Successfully:",h),this.editForm.reset(),this.imageSlots.forEach(g=>{g.preview="",g.file=null,g.name=""}),this._snackBar.open("GatePass Created Successfully!","Close",{horizontalPosition:this.horizontalPosition,verticalPosition:this.verticalPosition}),this.gatePassIdForPrint=h.body.id},error:h=>{console.error(" Error Creating Gate Pass:",h),this._snackBarService.open("Error on Creating!","Close",{duration:3e3})}})},error:n=>{console.error("Image upload failed:",n)}})}updateGatePass(){let t=this.editForm.get("vehicleID")?.value;if(!t||t.trim()===""){this.show("alertBox4"),setTimeout(()=>this.dismiss("alertBox4"),4e3);return}this.dismiss("alertBox4");let e=this.gatePassFormService.getGatePass(this.editForm),i=this.imageSlots.map(n=>n.file).filter(n=>!!n);if(i.length===0){let n=v(f({},e),{id:Number(this.gatePassId),frontView1:this.imageSlots[0]?.name||null,sideRView1:this.imageSlots[1]?.name||null,sideLView1:this.imageSlots[2]?.name||null,rearView1:this.imageSlots[3]?.name||null});this.gatePassService.update(n).subscribe({next:u=>{console.log("\u2705 Gate Pass Updated Successfully:",u),this._snackBar.open("GatePass Updated Successfully!","Close",{horizontalPosition:this.horizontalPosition,verticalPosition:this.verticalPosition})},error:u=>{this._snackBarService.open("Error on Updating","Close",{duration:3e3}),console.error("\u274C Error Updating Gate Pass:",u)}});return}this.gatePassImgService.uploadImages(i).subscribe({next:n=>{let u=n?.filePaths;if(!u){console.error("Image upload failed or returned empty.");return}let S=0;this.imageSlots.forEach((g,he)=>{g.file&&(g.name=u[S]?.fileName||"",S++)});let h=v(f({},e),{id:Number(this.gatePassId),frontView1:this.imageSlots[0]?.name||null,sideRView1:this.imageSlots[1]?.name||null,sideLView1:this.imageSlots[2]?.name||null,rearView1:this.imageSlots[3]?.name||null});this.gatePassService.update(h).subscribe({next:g=>{console.log("\u2705 Gate Pass Updated Successfully:",g)},error:g=>{console.error("\u274C Error Updating Gate Pass:",g)}})},error:n=>{console.error("\u274C Image Upload Failed:",n)}})}gatePassPrint(){let t=this.gatePassIdForPrint;this._router.navigate(["/gatepass-print",t],{queryParams:{gatePassId:t}})}dismiss(t){this._fuseAlertService.dismiss(t)}show(t){this._fuseAlertService.show(t)}static{this.\u0275fac=function(e){return new(e||o)(E(F))}}static{this.\u0275cmp=M({type:o,selectors:[["app-gatepass-create"]],decls:76,vars:17,consts:[[1,"absolute","inset-0","flex","flex-col","overflow-auto","min-w-0"],[1,"bg-default","flex","flex-col","sm:flex-row","sm:items-start","sm:justify-between","sm:px-3","sm:pt-3","gap-2","dark:bg-transparent"],[1,"px-2","rounded-lg","flex","items-center","justify-center"],[1,"font-semibold","mt-3","text-3xl","text-black"],[1,"flex","flex-row","sm:items-center","gap-2"],[1,"flex","gap-2"],["class","px-4 py-3 bg-gradient-to-r from-amber-500 to-yellow-500 hover:from-indigo-600 hover:to-blue-600 rounded-lg shadow text-white flex items-center transition-all duration-200","mat-button","",3,"click",4,"ngIf"],[1,"flex","flex-col","gap-2","h-16"],[3,"appearance","dismissible","dismissed","name","type"],[3,"appearance","dismissible","dismissed","name","type",4,"ngIf"],[1,"flex","p-3","justify-center","items-center"],[1,"flex","flex-col","gap-6","w-full","bg-card","p-3","rounded-lg",3,"formGroup"],[1,"flex","flex-1","items-start","md:items-center"],[1,"flex","h-20","w-20","items-center","justify-center","rounded-2xl","bg-red-400","text-white","dark:bg-teal-600","dark:text-teal-50"],[1,"text-current","text-6xl","h-10","w-10",3,"svgIcon"],[1,"ml-4","w-full"],[1,"text-secondary","text-xl","font-medium","mb-1"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-3","gap-4"],[1,"relative","w-full"],[1,"absolute","-top-2","left-3","text-xs","px-1","bg-white","dark:bg-gray-900","text-gray-600","dark:text-gray-300","transform","scale-90"],["formControlName","vehicleLicenseNumber","placeholder","Vehicle ID",1,"w-full","p-3","pl-12","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-amber-400"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none","text-gray-400"],[1,"text-current","text-2xl",3,"svgIcon"],["formControlName","fuelLevel","placeholder","Fuel Level",1,"w-full","p-3","pl-12","pr-10","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-amber-400"],[1,"absolute","inset-y-0","right-0","flex","items-center","pr-3","pointer-events-none","text-gray-500","text-lg","font-semibold"],["formControlName","ownerBelongings","placeholder","Owner Belongings",1,"w-full","p-3","pl-12","pr-10","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-amber-400"],["formControlName","meterReading","placeholder","Meter Reading",1,"w-full","p-3","pl-12","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-amber-400"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-4","gap-6"],["class","flex flex-col items-center gap-3 border rounded-lg p-4",4,"ngFor","ngForOf"],[1,"grid","grid-cols-1","sm:grid-cols-2","lg:grid-cols-4","gap-4"],["formControlName","jobCardNumber","placeholder","Job Card Number",1,"w-full","h-13","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-amber-400"],["formControlName","invoiceNumber","placeholder","Invoice Number",1,"w-full","h-13","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-amber-400"],["formControlName","receiptValue","placeholder","Receipt Value",1,"w-full","h-13","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-amber-400"],["for","entryDateTime",1,"absolute","-top-2","left-3","text-xs","px-1","bg-white","dark:bg-gray-900","text-gray-600","dark:text-gray-300","transform","scale-90"],["type","datetime-local","id","entryDateTime","formControlName","entryDateTime","placeholder","YYYY-MM-DD HH:mm",1,"w-full","h-13","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-amber-400","dark:bg-gray-800","dark:text-white","dark:border-gray-600"],["mat-button","",1,"px-4","py-3","bg-gradient-to-r","from-amber-500","to-yellow-500","hover:from-indigo-600","hover:to-blue-600","rounded-lg","shadow","text-white","flex","items-center","transition-all","duration-200",3,"click"],[1,"mr-2"],[1,""],[1,"flex","flex-col","items-center","gap-3","border","rounded-lg","p-4"],[1,"text-sm","font-semibold","text-gray-700","dark:text-gray-300"],["type","file","accept","image/*",1,"w-full","text-sm","border","p-2","rounded","file:mr-4","file:py-2","file:px-4","file:rounded-full","file:border-0","file:bg-amber-100","file:text-amber-800","hover:file:bg-amber-200",3,"change"],["class","w-full flex flex-col items-center",4,"ngIf"],[1,"w-full","flex","flex-col","items-center"],["alt","Preview",1,"h-32","w-auto","object-cover","rounded","shadow",3,"src"],[1,"mt-2","text-xs","text-gray-600","truncate","w-full","text-center"]],template:function(e,i){e&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),l(4,"Gate Pass"),a()(),r(5,"div",4)(6,"div",5),y(7,de,3,0,"button",6)(8,ce,3,0,"button",6)(9,ue,3,0,"button",6),a(),r(10,"div",7)(11,"fuse-alert",8),l(12," Please fill all required fields before submitting the form. "),a(),y(13,ge,2,5,"fuse-alert",9),a()()(),r(14,"div",10)(15,"form",11)(16,"div",12)(17,"div",13),c(18,"mat-icon",14),a(),r(19,"div",15)(20,"div",16),l(21," Vehicle Details "),a(),r(22,"div",17)(23,"div",18)(24,"label",19),l(25," Vehicle "),a(),c(26,"input",20),r(27,"div",21),c(28,"mat-icon",22),a()(),r(29,"div",18),c(30,"input",23),r(31,"label",19),l(32," Fuel Level "),a(),r(33,"div",21),c(34,"mat-icon",22),a(),r(35,"div",24),l(36," % "),a()(),r(37,"div",18),c(38,"input",25),r(39,"label",19),l(40," Owner Belongings "),a(),r(41,"div",21),c(42,"mat-icon",22),a()(),r(43,"div",18)(44,"label",19),l(45," Meter Reading "),a(),c(46,"input",26),r(47,"div",21),c(48,"mat-icon",22),a(),r(49,"div",24),l(50," KM "),a()()()()(),r(51,"div",27),y(52,pe,5,2,"div",28),a(),r(53,"div",12)(54,"div",13),c(55,"mat-icon",14),a(),r(56,"div",15)(57,"div",16),l(58," Job Card Details "),a(),r(59,"div",29)(60,"div",18)(61,"label",19),l(62," Job Card Number "),a(),c(63,"input",30),a(),r(64,"div",18)(65,"label",19),l(66," Invoice Number "),a(),c(67,"input",31),a(),r(68,"div",18)(69,"label",19),l(70," Receipt Value "),a(),c(71,"input",32),a(),r(72,"div",18)(73,"label",33),l(74," Entry Date & Time "),a(),c(75,"input",34),a()()()()()()()),e&2&&(m(7),d("ngIf",!i.isUpdating),m(),d("ngIf",i.isUpdating),m(),d("ngIf",i.gatePassIdForPrint),m(2),d("appearance","soft")("dismissible",!0)("dismissed",!0)("name","alertBox4")("type","warn"),m(2),d("ngIf",i.imageSlots[0].file===null||i.imageSlots[1].file===null||i.imageSlots[2].file===null||i.imageSlots[3].file===null),m(2),d("formGroup",i.editForm),m(3),d("svgIcon","mat_outline:directions_car_filled"),m(10),d("svgIcon","mat_outline:directions_car_filled"),m(6),d("svgIcon","mat_outline:directions_car_filled"),m(8),d("svgIcon","mat_outline:directions_car_filled"),m(6),d("svgIcon","mat_outline:directions_car_filled"),m(4),d("ngForOf",i.imageSlots),m(3),d("svgIcon","sim_card_alert"))},dependencies:[X,H,z,Y,q,K,Q,Z,$,U,R,k,ae,re,te,j,A],encapsulation:2})}}return o})();var Ye=[{path:"",component:le}];export{Ye as default};
