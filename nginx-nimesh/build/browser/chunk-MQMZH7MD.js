import{a as yt,b as Ct}from"./chunk-FKEP7USQ.js";import{a as It,c as St,d as Dt}from"./chunk-MBFKKYVB.js";import{a as Nt}from"./chunk-2BGIWFS4.js";import{a as kt,b as Et}from"./chunk-JCUL3757.js";import{f as Mt}from"./chunk-R44K775J.js";import{a as wt}from"./chunk-PH6QFVW6.js";import{a as gt}from"./chunk-BT3QW6HI.js";import{a as ft}from"./chunk-LFICRIBC.js";import{a as ht}from"./chunk-IXCLTE66.js";import{a as bt,b as vt,c as xt,d as _t}from"./chunk-KYPGTARF.js";import{a as Ye,b as Xe,c as Ze,d as Ke,e as et,f as tt,g as it,h as nt,i as rt,j as ot,k as at}from"./chunk-4HPTI4QK.js";import{a as st,b as mt}from"./chunk-4IV6I57G.js";import{b as lt}from"./chunk-T73PE35A.js";import{a as ct,b as dt,c as pt,h as ut}from"./chunk-ZGGKBBB7.js";import{a as We}from"./chunk-E4TC4E2W.js";import{a as v,b as Je,c as J}from"./chunk-YEGTZ3HQ.js";import{a as Ne,b as ke}from"./chunk-OT3AQSDR.js";import{a as Be,c as $e,d as Ue}from"./chunk-4WAQRQWE.js";import{b as He}from"./chunk-HLRQKUHW.js";import{a as Le}from"./chunk-5RBAZJQA.js";import{A as Te,B as Oe,G as Ve,H as qe,J as Ae,K as ze,O as Qe,P as je,b as ve,d as xe,e as _e,i as ye,j as Ce,l as Ee,n as L,q as Re,r as Pe,x as Fe,z as Ge}from"./chunk-MXRUEL7B.js";import{b as De,c as Me}from"./chunk-PNSBUHWU.js";import{c as be}from"./chunk-TEYA6QDP.js";import"./chunk-JTAP5U5F.js";import{a as we,c as Ie,d as Se}from"./chunk-VPJKTFM7.js";import{W as fe,fa as ge,ia as he}from"./chunk-GXFYRQIF.js";import"./chunk-T4I3R2GV.js";import{b as pe,d as ue}from"./chunk-DJWEABC6.js";import{i as re,j as oe,k as ae,n as le,p as se,r as me,w as ce,y as de}from"./chunk-MZLVPJ5Q.js";import{Aa as h,Ac as D,Bc as s,Cc as E,Db as te,Dc as Q,E as $,Ec as ne,Jc as V,K,Kb as x,Kc as j,M as U,Qc as q,Sc as A,Tb as c,Tc as H,Ub as ie,a as _,b as C,cc as a,dc as o,ec as p,fc as M,gc as N,ia as ee,ic as P,nb as m,oa as y,ob as R,oc as b,p as X,qc as w,r as Z,uc as F,vc as G,wc as T,y as k,za as g}from"./chunk-2GFQMTJ2.js";var z,qt=new Uint8Array(16);function W(){if(!z&&(z=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!z))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return z(qt)}var Rt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function At(n){return typeof n=="string"&&Rt.test(n)}var Pt=At;var f=[];for(B=0;B<256;++B)f.push((B+256).toString(16).substr(1));var B;function zt(n){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=(f[n[l+0]]+f[n[l+1]]+f[n[l+2]]+f[n[l+3]]+"-"+f[n[l+4]]+f[n[l+5]]+"-"+f[n[l+6]]+f[n[l+7]]+"-"+f[n[l+8]]+f[n[l+9]]+"-"+f[n[l+10]]+f[n[l+11]]+f[n[l+12]]+f[n[l+13]]+f[n[l+14]]+f[n[l+15]]).toLowerCase();if(!Pt(e))throw TypeError("Stringified UUID is invalid");return e}var Ft=zt;function Bt(n,l,e){n=n||{};var i=n.random||(n.rng||W)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,l){e=e||0;for(var t=0;t<16;++t)l[e+t]=i[t];return l}return Ft(i)}var Y=Bt;var Gt=(()=>{class n{constructor(){this.http=y(de),this.applicationConfigService=y(Le),this.resourceUrl=this.applicationConfigService.getEndpointFor("api/the-grn-line-batches","inventorymicro"),this.resourceSearchUrl=this.applicationConfigService.getEndpointFor("api/the-grn-line-batches/_search","inventorymicro")}create(e){let i=this.convertDateFromClient(e);return this.http.post(this.resourceUrl,i,{observe:"response"}).pipe(k(t=>this.convertResponseFromServer(t)))}update(e){let i=this.convertDateFromClient(e);return this.http.put(`${this.resourceUrl}/${this.getTheGRNLineBatchesIdentifier(e)}`,i,{observe:"response"}).pipe(k(t=>this.convertResponseFromServer(t)))}partialUpdate(e){let i=this.convertDateFromClient(e);return this.http.patch(`${this.resourceUrl}/${this.getTheGRNLineBatchesIdentifier(e)}`,i,{observe:"response"}).pipe(k(t=>this.convertResponseFromServer(t)))}find(e){return this.http.get(`${this.resourceUrl}/${e}`,{observe:"response"}).pipe(k(i=>this.convertResponseFromServer(i)))}query(e){let i=J(e);return this.http.get(this.resourceUrl,{params:i,observe:"response"}).pipe(k(t=>this.convertResponseArrayFromServer(t)))}delete(e){return this.http.delete(`${this.resourceUrl}/${e}`,{observe:"response"})}search(e){let i=J(e);return this.http.get(this.resourceSearchUrl,{params:i,observe:"response"}).pipe(k(t=>this.convertResponseArrayFromServer(t)),K(()=>Z([new ce],X)))}getTheGRNLineBatchesIdentifier(e){return e.id}compareTheGRNLineBatches(e,i){return e&&i?this.getTheGRNLineBatchesIdentifier(e)===this.getTheGRNLineBatchesIdentifier(i):e===i}addTheGRNLineBatchesToCollectionIfMissing(e,...i){let t=i.filter(Je);if(t.length>0){let r=e.map(u=>this.getTheGRNLineBatchesIdentifier(u));return[...t.filter(u=>{let I=this.getTheGRNLineBatchesIdentifier(u);return r.includes(I)?!1:(r.push(I),!0)}),...e]}return e}convertDateFromClient(e){return C(_({},e),{txDate:e.txDate?.toJSON()??null,manufactureDate:e.manufactureDate?.toJSON()??null,expiredDate:e.expiredDate?.toJSON()??null,lmd:e.lmd?.toJSON()??null})}convertDateFromServer(e){return C(_({},e),{txDate:e.txDate?v(e.txDate):void 0,manufactureDate:e.manufactureDate?v(e.manufactureDate):void 0,expiredDate:e.expiredDate?v(e.expiredDate):void 0,lmd:e.lmd?v(e.lmd):void 0})}convertResponseFromServer(e){return e.clone({body:e.body?this.convertDateFromServer(e.body):null})}convertResponseArrayFromServer(e){return e.clone({body:e.body?e.body.map(i=>this.convertDateFromServer(i)):null})}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=ee({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Ut=["drawer"],Qt=["confirmResetDialog"],jt=["grnPanel"],Ht=["grnItemPanel"],Tt=()=>["itemName","manufactureDate","purcost","sellprice","quantity","lineTotal","actions"],Lt=()=>[5,10,20],Ot=n=>({width:"40px",height:"40px",minWidth:"40px",backgroundColor:"white",border:n,borderRadius:"6px"});function Jt(n,l){if(n&1&&(a(0,"mat-option",62),s(1),o()),n&2){let e=l.$implicit;c("value",e),m(),Q(" ",e.name," ")}}function Wt(n,l){if(n&1){let e=P();a(0,"h2",63),s(1,"Confirm Reset"),o(),a(2,"mat-dialog-content",64)(3,"p",65),s(4," Entered data will be lost. Are you sure you want to continue? "),o()(),a(5,"mat-dialog-actions",66)(6,"button",67),b("click",function(){g(e);let t=w();return h(t.cancelReset())}),s(7,"No"),o(),a(8,"button",68),b("click",function(){g(e);let t=w();return h(t.confirmReset())}),s(9,"Yes"),o()()}}function Yt(n,l){if(n&1){let e=P();a(0,"button",69),b("click",function(){g(e);let t=w();return h(t.resetFormAndOpenDrawer())}),s(1," Reset "),o()}}function Xt(n,l){if(n&1&&(a(0,"mat-option",62),s(1),o()),n&2){let e=l.$implicit;c("value",e),m(),ne(" ",e.name," (",e.code,") ")}}function Zt(n,l){if(n&1){let e=P();a(0,"mat-dialog-content",70)(1,"form",71)(2,"mat-card",72)(3,"mat-card-content")(4,"div",73)(5,"div",74)(6,"mat-form-field",75)(7,"mat-label"),s(8,"Search item"),o(),a(9,"mat-icon",17),s(10,"search"),o(),p(11,"input",76),a(12,"mat-autocomplete",77,6),b("optionSelected",function(t){g(e);let r=w();return h(r.onItemSelected(t.option.value))}),x(14,Xt,2,3,"mat-option",20),o()(),a(15,"div",78)(16,"button",79),b("click",function(){g(e);let t=w();return h(t.setSearchBy("code"))}),p(17,"mat-icon",80),o(),a(18,"button",81),b("click",function(){g(e);let t=w();return h(t.setSearchBy("name"))}),p(19,"mat-icon",82),o()()(),a(20,"mat-form-field",83)(21,"mat-label"),s(22,"Manufacture Date"),o(),p(23,"input",84)(24,"mat-datepicker-toggle",25)(25,"mat-datepicker",null,7),o(),a(27,"mat-form-field",83)(28,"mat-label"),s(29,"Item Code"),o(),p(30,"input",85),o(),a(31,"mat-form-field",83)(32,"mat-label"),s(33,"Item Name"),o(),p(34,"input",86),o(),a(35,"mat-form-field",83)(36,"mat-label"),s(37,"Expired Date"),o(),p(38,"input",87)(39,"mat-datepicker-toggle",25)(40,"mat-datepicker",null,8),o(),a(42,"mat-form-field",83)(43,"mat-label"),s(44,"Qty"),o(),p(45,"input",88),o(),a(46,"mat-form-field",83)(47,"mat-label"),s(48,"Purchased Price"),o(),p(49,"input",89),o(),a(50,"mat-form-field",83)(51,"mat-label"),s(52,"Selling Price"),o(),p(53,"input",90),o()(),a(54,"div",91)(55,"button",92),b("click",function(){g(e);let t=w();return h(t.closeDialog())}),s(56,` Close
`),o(),a(57,"button",93),b("click",function(){g(e);let t=w();return h(t.addItem())}),s(58," Add Item "),o()()()()()()}if(n&2){let e=D(13),i=D(26),t=D(41),r=w();m(),c("formGroup",r.grnitemForm),m(10),c("matAutocomplete",e),m(),c("displayWith",r.displayFn),m(2),c("ngForOf",r.searchResults),m(2),c("ngStyle",j(12,Ot,r.searchByCode?"2px solid black":"none")),m(),c("svgIcon","mat_outline:qr_code_scanner"),m(),c("ngStyle",j(14,Ot,r.searchByCode?"none":"2px solid black")),m(),c("svgIcon","heroicons_solid:magnifying-glass"),m(4),c("matDatepicker",i),m(),c("for",i),m(14),c("matDatepicker",t),m(),c("for",t)}}function Kt(n,l){n&1&&(a(0,"th",94),s(1,"Item Name"),o())}function ei(n,l){if(n&1&&(a(0,"td",95),s(1),o()),n&2){let e=l.$implicit;m(),E(e.itemName)}}function ti(n,l){n&1&&(a(0,"th",94),s(1,"Manufacture Date"),o())}function ii(n,l){if(n&1&&(a(0,"td",95),s(1),q(2,"date"),o()),n&2){let e=l.$implicit;m(),E(A(2,1,e.manufactureDate,"yyyy-MM-dd"))}}function ni(n,l){n&1&&(a(0,"th",96),s(1,"Total Purchase Price"),o())}function ri(n,l){if(n&1&&(a(0,"td",95),s(1),q(2,"number"),o()),n&2){let e=l.$implicit;m(),E(A(2,1,e.purcost,"1.2-2"))}}function oi(n,l){n&1&&(a(0,"th",94),s(1,"Unit Sell Price"),o())}function ai(n,l){if(n&1&&(a(0,"td",95),s(1),q(2,"number"),o()),n&2){let e=l.$implicit;m(),E(A(2,1,e.sellprice,"1.2-2"))}}function li(n,l){n&1&&(a(0,"th",96),s(1,"Qty"),o())}function si(n,l){if(n&1&&(a(0,"td",95),s(1),o()),n&2){let e=l.$implicit;m(),E(e.quantity)}}function mi(n,l){n&1&&(a(0,"th",96),s(1,"Total"),o())}function ci(n,l){if(n&1&&(a(0,"td",95),s(1),o()),n&2){let e=l.$implicit;m(),E(e.lineTotal)}}function di(n,l){n&1&&p(0,"th",94)}function pi(n,l){if(n&1){let e=P();a(0,"button",98),b("click",function(){g(e);let t=w().$implicit,r=w();return h(r.deleteItem(t))}),a(1,"mat-icon",99),s(2,"delete_outline"),o()()}}function ui(n,l){if(n&1&&(a(0,"td",95),x(1,pi,3,0,"button",97),o()),n&2){let e=l.$implicit;m(),c("ngIf",e.itemName)}}function fi(n,l){n&1&&p(0,"tr",100)}function gi(n,l){n&1&&p(0,"tr",101)}function hi(n,l){n&1&&(a(0,"tr")(1,"td",102),s(2," No data available. "),o()())}var Vt=(()=>{class n{constructor(e,i,t,r,d){this.fb=e,this.dialog=i,this._snackBar=t,this.router=r,this.route=d,this.grnservice=y(Ct),this.grnlinebatch=y(Gt),this.grnlineservice=y(yt),this.inventorybatchservice=y(gt),this.suplierprof=y(wt),this.supplierbank=y(kt),this.bincard=y(ht),this.inventory=y(ft),this.supplierbankdetails=y(Et),this.activeTabIndex=1,this.today=new Date,this.suid=null,this.drawerOpened=!1,this.items=[],this.searchResultsvendor=[],this.pageSize=10,this.currentPage=1,this.pagedItems=[],this.searchResults=[],this.grnForm=this.fb.group({supplierName:[null,L.required],poNum:[null],grnDate:[null],supplierInvoiceCode:[null],supplierInvoiceDate:[null]}),this.grnitemForm=this.fb.group({searchBy:["code"],searchitem:[""],itemId:[null],sellprice:[null],purcost:[null],itemCode:[null],itemName:[null],price:[null],cost:[null],expiredDate:[null],manufactureDate:[null],quantity:[null,L.required],lineTotal:[null],avaqty:[null]})}ngAfterViewInit(){}resetFormAndOpenDrawer(){this.dialogRef=this.dialog.open(this.confirmResetDialog,{width:"480px",disableClose:!0})}cancelReset(){this.dialogRef.close(),this.updatePagedItems()}confirmReset(){this.grnForm.reset();let i=this.items.filter(t=>t.itemName?.trim()).length;this.items=this.items.filter(t=>!t.itemName?.trim());for(let t=0;t<i;t++)this.items.push({itemName:""});this.items.length===0&&this.items.push({itemName:""}),this.currentPage=1,this.updatePagedItems(),this.drawerOpened=!0,setTimeout(()=>{this.drawer.open()}),this.dialog.closeAll()}openDialog(e){this.dialog.open(e,{width:"700px",disableClose:!0})}closeDialog(){this.dialog.closeAll()}onContinue(){this.grnForm.valid&&this.drawer.close()}expandBothPanels(){this.grnPanel.open(),this.grnItemPanel.open()}displayFn(e){return e?`${e.name} (${e.code})`:""}addItem(){if(this.grnitemForm.valid){if(!this.grnitemForm.value.itemName||this.grnitemForm.value.itemName.trim()===""){alert("Item Name cannot be empty.");return}if(!this.grnitemForm.value.quantity||this.grnitemForm.value.quantity.toString().trim()===""){alert("Item Qty cannot be empty.");return}let e=Number(this.grnitemForm.value.quantity),i=Number(this.grnitemForm.value.sellprice)||0,t=Number(this.grnitemForm.value.purcost)||0,r=C(_({},this.grnitemForm.value),{lineTotal:(e*i).toFixed(2),cost:t.toFixed(2),price:i.toFixed(2),availableQuantity:Number(this.grnitemForm.value.avaqty)||0}),d=this.items.findIndex(u=>Object.keys(u).length===0);d!==-1?(this.items[d]=r,this.items=[...this.items]):this.items=[...this.items,r],this.updatePagedItems(),this.grnitemForm.reset({searchBy:"code"}),console.log("Item added:",r),this.dialog.closeAll()}else console.warn("Item form is invalid")}inventoryquanity(){console.log("Updating inventory for all items...",this.items);for(let e=0;e<this.items.length;e++){let i=this.items[e].itemCode,t=this.items[e].quantity;console.log("Updating inventory for item code:",i,"with quantity:",t),this.inventory.query({"code.equals":i}).subscribe({next:r=>{if(console.log("Inventory query response:",r.body),r.body&&r.body.length>0){let d=r.body[0].id,u=r.body[0].availableQuantity||0;console.log(`Existing quantity for item ID ${d}:`,u);let I=parseInt(t)||0,S=u+I;console.log(`Updating item ID ${d}: existing = ${u}, added = ${t}, new = ${S}`),this.inventory.partialUpdate({id:d,availableQuantity:S}).subscribe({next:()=>{console.log(`Inventory updated successfully for item code: ${r.body}`)},error:O=>{console.error(`Error updating inventory for item code: ${i}`,O)}})}else console.warn("Item not found with code:",i)},error:r=>{console.error("Error fetching inventory for item code:",i,r)}})}}searchvendor(){let e=this.grnForm.value.supplierName,i="";console.log(e),i=`name.contains=${e}`,this.suplierprof.query({"name.contains":e}).subscribe({next:t=>{this.searchResultsvendor=t.body||[],console.log(this.searchResultsvendor)},error:t=>{console.error("Error fetching items:",t)}})}onItemSelectedvendor(e){this.grnForm.patchValue({supplierName:e.name})}deleteItem(e){this.items=this.items.filter(i=>i!==e),this.updatePagedItems(),console.log("Updated items:",this.items)}onPaginateChange(e){this.pageSize=e.pageSize,this.currentPage=e.pageIndex+1,this.updatePagedItems()}updatePagedItems(){let e=(this.currentPage-1)*this.pageSize,i=e+this.pageSize;this.pagedItems=this.items.slice(e,i)}searchitems(){let e=this.grnitemForm.value.searchBy,i=this.grnitemForm.value.searchitem;if(!i||!e)return;let t={};e==="code"?t["code.contains"]=i:e==="name"&&(t["name.contains"]=i),this.inventory.query(t).subscribe({next:r=>{this.searchResults=r.body||[],console.log(this.searchResults)},error:r=>{console.error("Error fetching items:",r)}})}onItemSelected(e){this.grnitemForm.patchValue({itemCode:e.code,itemName:e.name,itemId:e.id,avaqty:e.availableQuantity})}ngOnInit(){this.route.queryParamMap.subscribe(e=>{this.suid=e.get("suid"),console.log("Supplier UID:",this.suid),this.suid?(this.grnservice.query({"id.equals":this.suid}).subscribe({next:i=>{if(console.log("GRN data:",i.body),i.body&&i.body.length>0){let t=i.body[0];this.grnForm.patchValue({supplierName:t.supplierName,poNum:t.poNum,supplierInvoiceCode:t.supplierInvoiceCode,grnDate:t.grnDate,supplierInvoiceDate:t.supplierInvoiceDate})}},error:i=>{console.error("Error fetching GRN data:",i)}}),this.drawerOpened=!1):this.drawerOpened=!0}),this.updatePagedItems(),this.grnForm.get("supplierName")?.valueChanges.pipe(U(300)).subscribe(()=>this.searchvendor()),this.grnitemForm.get("searchitem")?.valueChanges.pipe(U(300)).subscribe(()=>this.searchitems()),this.grnitemForm.get("searchBy")?.valueChanges.subscribe(()=>this.searchitems()),this.updategrn()}preventClose(){}updategrn(){this.grnservice.query({sort:["id,desc"]}).subscribe({next:e=>{console.log("GRN query response:",e),this.grncode=e.body&&e.body.length>0?e.body[0].grnCode:"GRN001",console.log("Updated GRN code:",this.grncode)},error:e=>{console.error("Error querying GRN:",e)}}),console.log("Generated GRN code:",this.grncode)}supplierbanksave(e){let i=this.grnitemForm.value,t=_({id:e},i);this.supplierbank.create(t).subscribe({next:r=>{console.log(r.body)}})}supplierbankaccount(e){let i=this.grnitemForm.value,t=_({id:e},i);this.supplierbankdetails.create(t).subscribe({next:r=>{console.log(r.body)}})}grnlineservices(e){if(this.items.length===0){console.warn("No GRN line items to submit.");return}console.log("Creating GRN lines  :",this.items),this.items=this.items.map(i=>C(_({},i),{id:null,grnId:e})),this.items.forEach(i=>{this.grnlineservice.create(i).subscribe({next:t=>{console.log("GRN line created successfully:",t)},error:t=>{console.error("Error creating GRN line:",t)}})})}grnlinebatchsave(e){if(this.items.length===0){console.warn("No GRN line items to submit.");return}this.items=this.items.map((r,d)=>C(_({},r),{grnId:e,lineId:d+1,batchLineId:d+2}));let i=this.items.filter((r,d,u)=>u.findIndex(I=>I.id===r.id&&I.lineId===r.lineId)!==d);console.log("Duplicates in batch:",this.items);let t=this.items.map(r=>this.grnlinebatch.create(r));console.log("\u{1F4E6} Sending GRN batch line items:",this.items),$(t).subscribe({next:r=>{console.log("\u2705 All GRN batch lines created successfully:",r)},error:r=>{if(console.error("\u274C Error occurred while creating GRN batch lines:"),console.error("Status Code:",r.status),console.error("Status Text:",r.statusText),console.error("Error Message:",r.message),r.error){console.error("Error Body:",r.error);let d=r.error.detail||r.error.message||"";d.includes("Duplicate row was found")?console.error("\u{1F6AB} Duplicate row error detected!"):console.warn("\u26A0\uFE0F Unhandled backend error:",d)}else console.warn("\u26A0\uFE0F No detailed error information from backend.")}})}inventorybatchsave(e){if(this.items.length===0){console.warn("No GRN line items to submit.");return}this.items=this.items.map((t,r)=>C(_({},t),{grnId:e,lineId:r+1,lmu:r+2})),console.log("batch lines",this.items);let i=this.items.map(t=>this.inventorybatchservice.create(t));$(i).subscribe({next:t=>{console.log("All inventory items created:",t),console.log("everything finisheddddddd"),this._snackBar.open("GRN created successfully!","Close",{duration:3e3,verticalPosition:"top",panelClass:["bg-green-600","text-white"]}),setTimeout(()=>{this.router.navigate(["/grn"])},500)},error:t=>{console.error("Error creating one or more inventory items:",t)}})}get searchByCode(){return this.grnitemForm.get("searchBy")?.value==="code"}setSearchBy(e){this.grnitemForm.get("searchBy")?.setValue(e)}grnsave(){let e=this.grnForm.value,i=this.items.reduce((r,d)=>r+d.purcost,0),t=C(_({},e),{grnDate:e.grnDate?v(e.grnDate):void 0,supplierInvoiceDate:e.supplierInvoiceDate?v(e.supplierInvoiceDate):void 0,grnCode:this.grncode,amountOwing:i,inspected:!1,lmd:v()});this.grnservice.create(t).subscribe({next:r=>{console.log("GRN batches  created successfully:",r.body.id),this.grnlineservices(r.body.id),this.grnlinebatchsave(r.body.id),this.inventorybatchsave(r.body.id)},error:r=>{console.error("Error creating GRN:",r)}})}bincardsave(){if(this.items.length===0){console.warn("No GRN line items to submit.");return}this.items=this.items.map(e=>C(_({},e),{id:null,recordDate:v(),lmd:v(),description:"item added",opening:e.avaqty+e.qtyIn})),this.items.forEach(e=>{this.bincard.create(e).subscribe({next:i=>{console.log("Bin Card created successfully:",i)},error:i=>{console.error("Error creating Bin Card:",i)}})})}newupdategrn(e){let i=this.items.reduce((t,r)=>t+r.purcost,0);this.grnservice.query({"id.equals":e}).subscribe({next:t=>{if(t.body&&t.body.length>0){let u=(t.body[0].amountOwing??0)+i,I={id:e,amountOwing:u};this.grnservice.partialUpdate(I).subscribe({next:S=>{console.log("GRN amountOwing updated:",S)},error:S=>{console.error("Error updating GRN:",S)}})}else console.error("No GRN found with id:",e)},error:t=>{console.error("Error fetching GRN:",t)}})}save(){if(this.items=this.items.filter(i=>i&&typeof i=="object"&&Object.keys(i).length>0&&i.itemName),!this.items||this.items.length===0){alert("No valid items to save!");return}this.grncode=this.grncode||"GRN0",console.log("array namess",this.items);let e=this.grncode.match(/^([a-zA-Z]+)(\d+)$/);if(e){let i=e[1],t=parseInt(e[2],10)+1;console.log("Current GRN code nn:",t+1);let r=t;this.grncode=`${i}${r}`,console.log("Generated new GRN code:",this.grncode)}else this.grncode="GRN1";console.log("Generated GRN coderrrrrrrr:",this.grncode),console.log("Saving GRN with items:",this.items),this.items=this.items.map((i,t)=>C(_({},i),{code:Y(),lineId:t+1,quantity:parseInt(i.quantity,10)||0,qtyIn:parseInt(i.quantity,10)||0,qty:parseInt(i.quantity,10)||0,batchLineTotal:parseInt(i.lineTotal,10)||0,cost:parseInt(i.cost,10)||0,price:parseInt(i.sellprice,10)||0,purcost:parseInt(i.purcost,10)||0,sellprice:parseInt(i.sellprice,10)||0,costTotal:parseInt(i.lineTotal,10)||0,reference:i.itemName,expiredDate:i.expiredDate?v(i.expiredDate):null,manufactureDate:i.manufactureDate?v(i.manufactureDate):null,expireDate:i.expiredDate?v(i.expiredDate):null})),console.log("Updated GRN items with code, lineId, and parsed quantity:",this.items),console.log("GRN Form Data:",C(_({},this.grnForm.value),{grnDate:this.grnForm.value.grnDate?v(this.grnForm.value.grnDate):null,supplierInvoiceDate:this.grnForm.value.supplierInvoiceDate?v(this.grnForm.value.supplierInvoiceDate):null,grnCode:"GRN001"})),console.log("GRN Form Data:",this.grnForm.value),this.inventoryquanity(),this.bincardsave(),this.suid?(this.grnlineservices(Number(this.suid)),this.grnlinebatchsave(Number(this.suid)),this.inventorybatchsave(Number(this.suid)),this.newupdategrn(Number(this.suid))):this.grnsave()}static{this.\u0275fac=function(i){return new(i||n)(R(qe),R(be),R(We),R(ue),R(pe))}}static{this.\u0275cmp=te({type:n,selectors:[["app-grn-create"]],viewQuery:function(i,t){if(i&1&&(F(Ut,5),F(Qt,5),F(jt,5),F(Ht,5)),i&2){let r;G(r=T())&&(t.drawer=r.first),G(r=T())&&(t.confirmResetDialog=r.first),G(r=T())&&(t.grnPanel=r.first),G(r=T())&&(t.grnItemPanel=r.first)}},decls:99,vars:28,consts:[["drawer",""],["autov","matAutocomplete"],["grnDatePicker",""],["supplierInvoiceDatePicker",""],["confirmResetDialog",""],["grnItemDialog",""],["auto","matAutocomplete"],["manufacturePicker",""],["expiredPicker",""],[1,"stepper-container"],[2,"height","100vh"],["mode","over","disableClose","",2,"width","400px","padding","1rem",3,"backdropClick","opened"],[2,"flex","1","min-width","300px",3,"ngSubmit","formGroup"],[2,"margin-bottom","1rem"],[1,"form-section"],[1,"form-row",2,"display","flex","gap","1rem","flex-wrap","wrap"],["appearance","outline",1,"form-field",2,"flex","1","min-width","200px"],["matPrefix",""],["matInput","","required","","formControlName","supplierName",3,"matAutocomplete"],[3,"optionSelected"],[3,"value",4,"ngFor","ngForOf"],[1,"form-row",2,"display","flex","gap","1rem","flex-wrap","wrap","margin-top","1rem"],["appearance","outline",1,"form-field",2,"flex","1","min-width","100px"],["matInput","","formControlName","supplierInvoiceCode"],["matInput","","formControlName","grnDate",3,"matDatepicker","max"],["matSuffix","",3,"for"],["matInput","","formControlName","supplierInvoiceDate",3,"matDatepicker"],[2,"margin-top","1rem","text-align","right"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[2,"padding","1rem","transition","margin-left 0.3s ease"],[3,"formControl"],[1,"min-w-0","flex-1",2,"padding-left","30px"],[2,"display","flex","align-items","center","justify-content","space-between","width","100%","margin-top","1rem"],[1,"truncate","text-3xl","font-extrabold","leading-7","tracking-tight","sm:leading-10","md:text-4xl",2,"margin","0"],[2,"display","flex","gap","1rem"],[2,"display","flex","gap","1rem","padding-right","10px"],["mat-raised-button","","color","warn","style","height: 3.5rem; width: 10rem; font-size: 1.1rem;",3,"click",4,"ngIf"],["mat-raised-button","","color","accent",2,"height","3.5rem","width","10rem","font-size","1.1rem",3,"click"],["mat-raised-button","","color","primary",2,"height","3.5rem","width","10rem","font-size","1.1rem",3,"click"],[1,"card-container",2,"display","flex","gap","1rem","flex-wrap","wrap"],[1,"example-table-container","bg-card","mt-6","rounded-t-2xl","shadow","overflow-auto","flex-1","bg-white",2,"min-height","20cm"],[1,"flex","flex-col","flex-auto","sm:mb-18","overflow-auto","bg-white"],["mat-table","",1,"w-full","table-fixed","border-separate","border-spacing-y-1",3,"dataSource"],["matColumnDef","itemName"],["mat-header-cell","","class","px-4 py-3 text-left font-semibold",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","manufactureDate"],["matColumnDef","purcost",1,"px-4","py-3","text-left","font-semibold"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","sellprice"],["matColumnDef","quantity",1,"px-4","py-3","text-left","font-semibold"],["matColumnDef","lineTotal",1,"px-4","py-3","text-left","font-semibold"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[4,"ngIf"],[2,"position","fixed","bottom","0","left","278px","right","0","background","white","padding","0.5rem 1rem","box-shadow","0 -2px 5px rgba(0,0,0,0.1)","z-index","100",3,"page","length","pageSize","pageSizeOptions","pageIndex"],[2,"position","fixed","bottom","18px","right","10px","background","white","padding","0.5rem 9rem","display","flex","flex-wrap","wrap","align-items","center","gap","2rem","z-index","101","min-width","500px","max-width","90vw","box-sizing","border-box"],[2,"display","flex","align-items","center","gap","0.5rem"],[2,"font-size","1.1rem","font-weight","600"],["matInput","","readonly","",2,"padding-left","12px","width","180px",3,"value"],["matInput","","readonly","",2,"padding-left","3px","width","165px",3,"value"],[3,"value"],["mat-dialog-title","",1,"dialog-title"],[1,"dialog-content"],[1,"dialog-message"],["align","end",1,"dialog-actions"],["mat-button","",3,"click"],["mat-raised-button","","color","warn",3,"click"],["mat-raised-button","","color","warn",2,"height","3.5rem","width","10rem","font-size","1.1rem",3,"click"],[2,"overflow","hidden"],[2,"min-width","300px",3,"formGroup"],[1,"right-card",2,"padding","1rem"],[1,"form-grid",2,"display","grid","gap","1rem","grid-template-columns","repeat(auto-fit, minmax(180px, 1fr))"],[2,"display","grid","grid-template-columns","2fr 1fr","gap","1rem","align-items","center","min-width","0","grid-column","span 2"],["appearance","outline",2,"width","100%"],["matInput","","formControlName","searchitem","placeholder","Enter search term",3,"matAutocomplete"],[3,"optionSelected","displayWith"],[2,"display","flex","gap","0.5rem","align-items","center","margin-top","-21px"],["mat-icon-button","","type","button","matTooltip","Search by Code (QR)","matTooltipPosition","above",3,"click","ngStyle"],[2,"font-size","28px",3,"svgIcon"],["mat-icon-button","","type","button","matTooltip","Search by Name","matTooltipPosition","above",3,"click","ngStyle"],[2,"font-size","22px",3,"svgIcon"],["appearance","outline"],["matInput","","formControlName","manufactureDate",3,"matDatepicker"],["matInput","","formControlName","itemCode"],["matInput","","formControlName","itemName"],["matInput","","formControlName","expiredDate",3,"matDatepicker"],["matInput","","formControlName","quantity"],["matInput","","formControlName","purcost"],["matInput","","formControlName","sellprice"],[1,"button-row",2,"margin-top","1.5rem","display","flex","justify-content","space-between","align-items","center"],["mat-stroked-button","",2,"height","36px","color","red","border-color","red",3,"click"],["mat-raised-button","","color","accent","type","button",3,"click"],["mat-header-cell","",1,"px-4","py-3","text-left","font-semibold"],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","","style","background-color: white;",3,"click",4,"ngIf"],["mat-icon-button","",2,"background-color","white",3,"click"],[2,"color","red"],["mat-header-row",""],["mat-row",""],["colspan","7",1,"text-center","py-4","text-gray-500","font-medium"]],template:function(i,t){if(i&1){let r=P();a(0,"div",9)(1,"mat-drawer-container",10)(2,"mat-drawer",11,0),b("backdropClick",function(){return g(r),h(t.preventClose())}),a(4,"form",12),b("ngSubmit",function(){return g(r),h(t.onContinue())}),p(5,"br"),a(6,"h1",13),s(7,"Enter Vendor For GRN:"),o(),p(8,"br"),a(9,"fieldset")(10,"div",14)(11,"div",15)(12,"mat-form-field",16)(13,"mat-label"),s(14,"Vendor*"),o(),a(15,"mat-icon",17),s(16,"person"),o(),p(17,"input",18),a(18,"mat-autocomplete",19,1),b("optionSelected",function(u){return g(r),h(t.onItemSelectedvendor(u.option.value))}),x(20,Jt,2,2,"mat-option",20),o()()(),a(21,"div",21)(22,"mat-form-field",22)(23,"mat-label"),s(24,"Supplier Invoice No:"),o(),p(25,"input",23),o()(),a(26,"div",21)(27,"mat-form-field",16)(28,"mat-label"),s(29,"GRN DATE*"),o(),p(30,"input",24)(31,"mat-datepicker-toggle",25)(32,"mat-datepicker",null,2),o(),a(34,"mat-form-field",16)(35,"mat-label"),s(36,"Supplier Invoice Date"),o(),p(37,"input",26)(38,"mat-datepicker-toggle",25)(39,"mat-datepicker",null,3),o()()()(),a(41,"div",27)(42,"button",28),s(43," Continue "),o()()()(),x(44,Wt,10,0,"ng-template",null,4,H),p(46,"div",29),a(47,"div",30)(48,"div",31)(49,"div",32)(50,"h2",33),s(51),o(),a(52,"div",34)(53,"div",35),x(54,Yt,2,0,"button",36),a(55,"button",37),b("click",function(){g(r);let u=D(61);return h(t.openDialog(u))}),s(56," Add Line "),o(),a(57,"button",38),b("click",function(){return g(r),h(t.save())}),s(58," Save "),o()()()()(),a(59,"div",39),x(60,Zt,59,16,"ng-template",null,5,H),o(),a(62,"div",40)(63,"div",41)(64,"table",42),M(65,43),x(66,Kt,2,0,"th",44)(67,ei,2,1,"td",45),N(),M(68,46),x(69,ti,2,0,"th",44)(70,ii,3,4,"td",45),N(),M(71,47),x(72,ni,2,0,"th",48)(73,ri,3,4,"td",45),N(),M(74,49),x(75,oi,2,0,"th",44)(76,ai,3,4,"td",45),N(),M(77,50),x(78,li,2,0,"th",48)(79,si,2,1,"td",45),N(),M(80,51),x(81,mi,2,0,"th",48)(82,ci,2,1,"td",45),N(),M(83,52),x(84,di,1,0,"th",44)(85,ui,2,1,"td",45),N(),x(86,fi,1,0,"tr",53)(87,gi,1,0,"tr",54)(88,hi,3,0,"tr",55),o(),a(89,"mat-paginator",56),b("page",function(u){return g(r),h(t.onPaginateChange(u))}),o(),a(90,"div",57)(91,"div",58)(92,"label",59),s(93,"GRN Name:"),o(),p(94,"input",60),o(),a(95,"div",58)(96,"label",59),s(97,"Invoice No:"),o(),p(98,"input",61),o()()()()()()()}if(i&2){let r,d,u=D(3),I=D(19),S=D(33),O=D(40);m(2),c("opened",t.drawerOpened),m(2),c("formGroup",t.grnForm),m(13),c("matAutocomplete",I),m(3),c("ngForOf",t.searchResultsvendor),m(10),c("matDatepicker",S)("max",t.today),m(),c("for",S),m(6),c("matDatepicker",O),m(),c("for",O),m(4),c("disabled",t.grnForm.invalid),m(4),ie("margin-left",u.opened?400:0,"px"),m(),c("formControl",t.grnitemForm),m(4),Q(" ",t.suid?"GRN Add more items":"Good Received Note Create"," "),m(3),c("ngIf",!t.suid),m(10),c("dataSource",t.pagedItems),m(22),c("matHeaderRowDef",V(25,Tt)),m(),c("matRowDefColumns",V(26,Tt)),m(),c("ngIf",t.pagedItems.length===10),m(),c("length",t.items.length)("pageSize",t.pageSize)("pageSizeOptions",V(27,Lt))("pageIndex",t.currentPage-1),m(5),c("value",((r=t.grnForm.get("supplierName"))==null?null:r.value)||"N/A"),m(4),c("value",((d=t.grnForm.get("supplierInvoiceCode"))==null?null:d.value)||"N/A")}},dependencies:[Me,De,Ae,Fe,Ee,Re,Pe,Ve,ze,Ge,Te,Oe,Mt,Ce,ye,ve,xe,_e,je,Qe,lt,ge,he,Se,we,Ie,He,Nt,at,Ye,Ze,it,Ke,Xe,nt,et,tt,rt,ot,Ue,Be,$e,me,re,oe,ae,se,le,bt,Dt,It,St,_t,vt,xt,ut,ct,dt,pt,fe,mt,st,ke,Ne],styles:[".custom-radio-button .mat-radio-container{display:none!important}.mat-step-label[_ngcontent-%COMP%]{color:#333}.custom-header[_ngcontent-%COMP%]{cursor:pointer;transition:background-color .3s ease;padding:0 1rem}.custom-header[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.header-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%}.rotate-icon[_ngcontent-%COMP%]{font-size:32px;transition:transform .3s ease;color:#555}.rotate-icon.expanded[_ngcontent-%COMP%]{transform:rotate(180deg)}.mat-expansion-panel-header-title[_ngcontent-%COMP%], .mat-expansion-panel-header-description[_ngcontent-%COMP%]{display:flex;align-items:center}  button.mat-icon-button.custom-size{width:40px!important;height:40px!important;min-width:40px!important;border-radius:6px!important;background-color:#fff!important}  button.mat-icon-button.custom-size mat-icon{font-size:22px!important}.dialog-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;letter-spacing:.03em;margin-bottom:.5rem}.dialog-message[_ngcontent-%COMP%]{font-size:1.1rem;line-height:1.4;color:#333;margin:0}.dialog-content[_ngcontent-%COMP%]{padding:1rem 0 1.5rem}.dialog-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:16px;padding-top:.5rem}.btn-no[_ngcontent-%COMP%]{font-size:1rem;text-transform:uppercase;letter-spacing:.04em}.btn-yes[_ngcontent-%COMP%]{font-size:1rem;text-transform:uppercase;letter-spacing:.04em;min-width:80px}.dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:0 0 100px;height:36px;font-size:1rem;text-transform:uppercase;letter-spacing:.04em}","html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{height:100%;margin:0;padding:0}.stepper-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;background-color:#f5f7fa;border-radius:0;font-family:Poppins,sans-serif;width:100vw;height:100vh;margin:0;box-sizing:border-box}.step-card[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1.5rem;padding:2rem;border-radius:12px;background:linear-gradient(to bottom right,#fff,#f0f2f5);box-shadow:0 6px 18px #00000014;border:1px solid #e0e6ed;transition:box-shadow .3s ease,transform .3s ease}.step-card[_ngcontent-%COMP%]:hover{box-shadow:0 10px 24px #0000001f;transform:translateY(-2px)}mat-card[_ngcontent-%COMP%]{border-radius:12px!important}.form-field[_ngcontent-%COMP%]{flex:1 1 280px;min-width:250px;border-radius:0;overflow:visible}.mat-form-field[_ngcontent-%COMP%]{width:100%;background-color:azure;border-radius:0!important;overflow:visible}button[_ngcontent-%COMP%]{min-width:130px;padding:.6rem 1.2rem;border-radius:9999px;color:#fff;font-weight:500;transition:background-color .3s ease}button[_ngcontent-%COMP%]:hover{background-color:#a5aab0}.mat-table[_ngcontent-%COMP%]{width:100%;margin-top:1.5rem;border-radius:9999px;overflow:hidden;border:1px solid #ddd}.mat-form-field[_ngcontent-%COMP%], .mat-form-field-wrapper[_ngcontent-%COMP%]{overflow:visible!important}th.mat-header-cell[_ngcontent-%COMP%]:first-child{border-top-left-radius:9999px}th.mat-header-cell[_ngcontent-%COMP%]:last-child{border-top-right-radius:9999px}tr.mat-row[_ngcontent-%COMP%]:last-child   td.mat-cell[_ngcontent-%COMP%]:first-child{border-bottom-left-radius:12px}tr.mat-row[_ngcontent-%COMP%]:last-child   td.mat-cell[_ngcontent-%COMP%]:last-child{border-bottom-right-radius:8px}th.mat-header-cell[_ngcontent-%COMP%]{font-weight:700;text-align:center}td.mat-cell[_ngcontent-%COMP%], th.mat-header-cell[_ngcontent-%COMP%]{padding:12px 16px;text-align:center}@media (max-width: 768px){.step-card[_ngcontent-%COMP%]{flex-direction:column;padding:1.2rem}.form-field[_ngcontent-%COMP%]{flex:1 1 100%}.step-buttons[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}}"]})}}return n})();var $n=[{path:"",component:Vt}];export{$n as default};
