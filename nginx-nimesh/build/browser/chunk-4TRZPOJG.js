import{a as ke}from"./chunk-PMESUWSZ.js";import{a as Oe}from"./chunk-FKDMVCKV.js";import{a as Pe}from"./chunk-GTGBE7YF.js";import{a as Se}from"./chunk-XY3JYBSR.js";import{a as Ne,b as Me,c as De,d as Ve}from"./chunk-G4IOVJWU.js";import{b as Ie}from"./chunk-T73PE35A.js";import{b as N}from"./chunk-RHLCCWT6.js";import{a as we}from"./chunk-E4TC4E2W.js";import{a as M}from"./chunk-YEGTZ3HQ.js";import"./chunk-QJXHZJQJ.js";import{a as re,c as ae}from"./chunk-NKWJDJWK.js";import{a as Te}from"./chunk-3N5N6CVQ.js";import"./chunk-YK5MGRE7.js";import"./chunk-OT3AQSDR.js";import{a as fe,c as ve,d as xe}from"./chunk-4WAQRQWE.js";import"./chunk-KKTU7MAV.js";import"./chunk-5RBAZJQA.js";import{a as be,b as ye}from"./chunk-LMUZFXJ5.js";import"./chunk-6F4FOUKE.js";import{C as de,D as ue,E as _e,J as he,K as ge,O as Ce,P as Ee,j as X,l as oe,n as se,q as le,s as ce,u as _,w as me,y as pe}from"./chunk-MXRUEL7B.js";import{b as ie,c as ne}from"./chunk-PNSBUHWU.js";import"./chunk-GRVU3NMS.js";import"./chunk-JTAP5U5F.js";import{a as ee,d as te}from"./chunk-VPJKTFM7.js";import{fa as Q,ia as Z}from"./chunk-GXFYRQIF.js";import"./chunk-T4I3R2GV.js";import{b as J,d as K}from"./chunk-DJWEABC6.js";import{h as U,i as q,j as H,p as G,q as z,r as Y}from"./chunk-MZLVPJ5Q.js";import{Aa as g,Ac as D,Bc as m,Cc as w,Db as $,Dc as b,E as F,Fc as V,Gc as k,Hc as O,Jc as L,Kb as f,Lc as A,Qc as I,Sc as S,Tb as p,a as x,b as E,cc as o,dc as s,ec as T,fc as W,g as R,gc as j,ia as B,ic as C,nb as l,oa as P,ob as y,oc as v,qc as c,za as h}from"./chunk-2GFQMTJ2.js";var Le=(()=>{class r{createPreEstimateFormGroup(e={id:null}){let t=this.convertPreEstimateToPreEstimateRawValue(x(x({},this.getFormDefaults()),e));return new ce({id:new _({value:t.id,disabled:!0},{nonNullable:!0,validators:[se.required]}),vehicleID:new _(t.vehicleID),vehicleBrand:new _(t.vehicleBrand),vehicleModel:new _(t.vehicleModel),licenseNo:new _(t.licenseNo),vehicleOwnerID:new _(t.vehicleOwnerID),vehicleOwnerName:new _(t.vehicleOwnerName),vehicleOwnerContactNumber1:new _(t.vehicleOwnerContactNumber1),vehicleOwnerContactNumber2:new _(t.vehicleOwnerContactNumber2),preEstimateNumber:new _(t.preEstimateNumber),numberOfPanels:new _(t.numberOfPanels),jobType:new _(t.jobType),isInsurance:new _(t.isInsurance),insuranceName:new _(t.insuranceName),insuranceID:new _(t.insuranceID),opsUnitID:new _(t.opsUnitID),createdBy:new _(t.createdBy),createdDate:new _(t.createdDate),lastModifiedBy:new _(t.lastModifiedBy),lastModifiedDate:new _(t.lastModifiedDate)})}getPreEstimate(e){return this.convertPreEstimateRawValueToPreEstimate(e.getRawValue())}resetForm(e,t){let i=this.convertPreEstimateToPreEstimateRawValue(x(x({},this.getFormDefaults()),t));e.reset(E(x({},i),{id:{value:i.id,disabled:!0}}))}getFormDefaults(){let e=M();return{id:null,isInsurance:!1,createdDate:e,lastModifiedDate:e}}convertPreEstimateRawValueToPreEstimate(e){return E(x({},e),{createdDate:M(e.createdDate,N),lastModifiedDate:M(e.lastModifiedDate,N)})}convertPreEstimateToPreEstimateRawValue(e){return E(x({},e),{createdDate:e.createdDate?e.createdDate.format(N):void 0,lastModifiedDate:e.lastModifiedDate?e.lastModifiedDate.format(N):void 0})}static{this.\u0275fac=function(t){return new(t||r)}}static{this.\u0275prov=B({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var $e=()=>["part","fitting_charge","repair","paint","other"],We=()=>["part","fitting_Charge","repair","paint","other"],Ae=(r,u)=>({"w-1/2":r,"w-1/3":u});function je(r,u){r&1&&T(0,"mat-icon",31),r&2&&p("svgIcon","heroicons_solid:chevron-down")}function Ue(r,u){r&1&&T(0,"mat-icon",31),r&2&&p("svgIcon","heroicons_solid:chevron-up")}function qe(r,u){if(r&1){let e=C();o(0,"button",32),v("click",function(){h(e);let i=c(3);return g(i.createPreEstimate())}),T(1,"mat-icon",33),o(2,"span",34),m(3,"Create"),s()()}r&2&&(l(),p("svgIcon","heroicons_mini:plus"))}function He(r,u){if(r&1){let e=C();o(0,"button",32),v("click",function(){h(e);let i=c(3);return g(i.updatePreEstimate())}),o(1,"span",34),m(2,"Update"),s()()}}function Ge(r,u){if(r&1){let e=C();o(0,"button",35),v("click",function(){h(e);let i=c(3);return g(i.print())}),T(1,"mat-icon",33),o(2,"span",34),m(3,"Print"),s()()}r&2&&(l(),p("svgIcon","mat_outline:print"))}function ze(r,u){if(r&1){let e=C();o(0,"button",36),v("click",function(){h(e);let i=c(3);return g(i.createEstimate())}),T(1,"mat-icon",33),o(2,"span",34),m(3,"Create Estimate"),s()()}r&2&&(l(),p("svgIcon","mat_outline:receipt_long"))}function Ye(r,u){r&1&&(o(0,"div",26)(1,"fuse-alert",37),m(2," Please Select Vehicle Before Save Pre Estimate. "),s()()),r&2&&(l(),p("appearance","soft")("dismissible",!0)("dismissed",!0)("name","alertBox4")("type","warn"))}function Je(r,u){if(r&1&&(o(0,"mat-option",53),m(1),s()),r&2){let e=u.$implicit;p("value",e),l(),b(" ",e," ")}}function Ke(r,u){if(r&1){let e=C();o(0,"div",48)(1,"label",40),m(2,"Insurance Provider"),s(),o(3,"input",51),v("ngModelChange",function(i){h(e);let n=c(4);return g(n.insuranceProvider=i)})("input",function(i){h(e);let n=c(4);return g(n.filterInsuranceOptions(i.target.value))}),s(),o(4,"mat-autocomplete",null,1),f(6,Je,2,2,"mat-option",52),s()()}if(r&2){let e=D(5),t=c(4);l(3),p("matAutocomplete",e)("ngModel",t.insuranceProvider),l(3),p("ngForOf",t.filteredInsuranceOptions)}}function Qe(r,u){if(r&1){let e=C();o(0,"div")(1,"div",38)(2,"div",39)(3,"div",40),m(4," Estimate Type "),s(),o(5,"div",41)(6,"mat-button-toggle-group",42),O("ngModelChange",function(i){h(e);let n=c(3);return k(n.preEstimateType,i)||(n.preEstimateType=i),g(i)}),o(7,"mat-button-toggle",43),m(8,"Supplementary"),s(),o(9,"mat-button-toggle",44),m(10,"Pre-Estimate"),s()()()(),o(11,"div",45)(12,"label",40),m(13,"Is Insurance?"),s(),o(14,"select",46),O("ngModelChange",function(i){h(e);let n=c(3);return k(n.isInsurance,i)||(n.isInsurance=i),g(i)}),o(15,"option",47),m(16,"Yes"),s(),o(17,"option",47),m(18,"No"),s()()(),o(19,"div",48)(20,"label",40),m(21,"Number of Panels"),s(),o(22,"input",49),v("ngModelChange",function(i){h(e);let n=c(3);return g(n.numberOfPanels=i)}),s()(),f(23,Ke,7,3,"div",50),s()()}if(r&2){let e=c(3);l(6),V("ngModel",e.preEstimateType),l(8),V("ngModel",e.isInsurance),l(),p("ngValue",!0),l(2),p("ngValue",!1),l(5),p("ngModel",e.numberOfPanels),l(),p("ngIf",e.isInsurance)}}function Ze(r,u){if(r&1&&(o(0,"mat-option",53),m(1),s()),r&2){let e=u.$implicit,t=c(4);p("value",t.getWorkName(e)),l(),b(" ",t.getWorkName(e)," ")}}function Xe(r,u){if(r&1){let e=C();o(0,"div",63)(1,"label",56),m(2," S/H "),s(),o(3,"select",64),v("ngModelChange",function(i){h(e);let n=c().$implicit,a=c(2).$implicit,d=c();return g(d.onLineInputChange("sh",i,n,a))}),o(4,"option",65),m(5,"Select S/H"),s(),o(6,"option",66),m(7,"SH"),s(),o(8,"option",67),m(9,"MR"),s()()()}if(r&2){let e=c().$implicit;l(3),p("ngModel",e.sh)}}function et(r,u){if(r&1){let e=C();o(0,"div",63)(1,"label",56),m(2," Market Price "),s(),o(3,"input",68),I(4,"number"),v("input",function(i){h(e);let n=c().$implicit,a=c(2).$implicit,d=c();return g(d.onMarketPriceInput(i,n,a))}),s(),o(5,"div",69),m(6," Rs "),s()()}if(r&2){let e=c().$implicit;l(3),p("value",S(4,1,e.marketPrice,"1.0-0"))}}function tt(r,u){if(r&1){let e=C();o(0,"div",70)(1,"label",56),m(2," Estimate Price "),s(),o(3,"input",71),I(4,"number"),v("input",function(i){h(e);let n=c().$implicit,a=c(2).$implicit,d=c();return g(d.onEstimatePriceInput(i,n,a))}),s(),o(5,"div",69),m(6," Rs "),s()()}if(r&2){let e=c().$implicit,t=c(2).$implicit;p("ngClass",A(5,Ae,t!="part",t==="part")),l(3),p("value",S(4,2,e.price,"1.0-0"))}}function it(r,u){if(r&1){let e=C();o(0,"div",54)(1,"div",55)(2,"label",56),m(3," Select Work "),s(),o(4,"input",57),v("ngModelChange",function(i){let n=h(e).$implicit,a=c(2).$implicit,d=c();return g(d.onLineInputChange("works",i,n,a))})("focus",function(){h(e);let i=c(2).$implicit,n=c();return g(n.filterWorks("",i))})("input",function(i){h(e);let n=c(2).$implicit,a=c();return g(a.filterWorks(i.target.value,n))}),s(),o(5,"mat-autocomplete",58,2),v("optionSelected",function(i){let n=h(e).$implicit,a=c(2).$implicit,d=c();return g(d.onWorkSelected(i.option.value,n,a))}),f(7,Ze,2,2,"mat-option",52),s()(),f(8,Xe,10,1,"div",59)(9,et,7,4,"div",59)(10,tt,7,8,"div",60),o(11,"div",61)(12,"mat-icon",62),v("click",function(){let i=h(e).$implicit,n=c(2).$implicit,a=c();return g(a.removeLine(n,i))}),s()()()}if(r&2){let e=u.$implicit,t=D(6),i=c(2).$implicit,n=c();l(),p("ngClass",A(7,Ae,i!="part",i==="part")),l(3),p("matAutocomplete",t)("ngModel",e.works),l(3),p("ngForOf",n.filteredWorks[i]),l(),p("ngIf",i==="part"),l(),p("ngIf",i==="part"),l(),p("ngIf",i!="part")}}function nt(r,u){if(r&1&&(o(0,"div")(1,"div",72)(2,"div",73)(3,"span",74),m(4),I(5,"currency"),s()()()()),r&2){let e=c(2).$implicit,t=c();l(4),b(" Total Price: Rs ",S(5,1,t.getSectionTotal(e)," ")," ")}}function rt(r,u){if(r&1){let e=C();o(0,"div",10)(1,"div",11)(2,"fuse-card",12,0)(4,"div",13)(5,"div",14)(6,"div")(7,"h2",15),m(8),s(),o(9,"h2",16),m(10),s()(),o(11,"div",17)(12,"button",18),v("click",function(){h(e);let i=c(2);return g(i.toggleEstimateAndTreatments())}),o(13,"span",19),m(14,"Details"),s(),f(15,je,1,1,"mat-icon",20)(16,Ue,1,1,"mat-icon",20),s(),f(17,qe,4,1,"button",21)(18,He,3,0,"button",21)(19,Ge,4,1,"button",22)(20,ze,4,1,"button",23),s()(),f(21,Ye,3,5,"div",24),s(),f(22,Qe,24,6,"div",25),s()(),o(23,"div",26),f(24,it,13,10,"div",27),o(25,"div",28)(26,"div")(27,"div",29)(28,"button",30),v("click",function(){h(e);let i=c().$implicit,n=c();return g(n.addLine(i))}),m(29),s()()(),f(30,nt,6,4,"div",25),s()()()}if(r&2){let e=c().$implicit,t=c();p("hidden",t.selectedMenu!==e),l(8),b(" ",t.preEstimateNumber," "),l(2),b(" ",e," Estimate "),l(5),p("ngIf",!t.preEstimateDetails),l(),p("ngIf",t.preEstimateDetails),l(),p("ngIf",!t.preEstimateID),l(),p("ngIf",t.isUpdating||t.preEstimateID),l(),p("ngIf",t.preEstimateID),l(),p("ngIf",t.preEstimateID),l(),p("ngIf",!(!(t.selectedVehicleandClientDetails==null||t.selectedVehicleandClientDetails.vehicle==null)&&t.selectedVehicleandClientDetails.vehicle.licenseNo)),l(),p("ngIf",t.preEstimateDetails),l(2),p("ngForOf",t.formLines[e])("ngForTrackBy",t.trackByIndex),l(5),b(" + Add ",e," "),l(),p("ngIf",(t.formLines[e]==null?null:t.formLines[e].length)>0)}}function at(r,u){r&1&&(W(0),f(1,rt,31,15,"div",9),j()),r&2&&(l(),p("ngIf",!0))}function ot(r,u){if(r&1&&(o(0,"tr")(1,"td",80),m(2),s(),o(3,"td",80),m(4),s(),o(5,"td",80),m(6),s(),o(7,"td",80),m(8),I(9,"currency"),s(),o(10,"td",80),m(11),s(),o(12,"td",80),m(13),s()()),r&2){let e=u.$implicit;l(2),w(e.works),l(2),w(e.quantity),l(2),w(e.type),l(2),w(S(9,6,e.priceType," ")),l(3),w(e.customPrice),l(2),w(e.price)}}function st(r,u){if(r&1&&(o(0,"div",76)(1,"h2",77),m(2),s(),o(3,"table",78)(4,"thead",79)(5,"tr")(6,"th",80),m(7,"Work"),s(),o(8,"th",80),m(9,"Quantity"),s(),o(10,"th",80),m(11,"Type"),s(),o(12,"th",80),m(13,"Price Type"),s(),o(14,"th",80),m(15,"Custom Price"),s(),o(16,"th",80),m(17,"Final Price"),s()()(),o(18,"tbody"),f(19,ot,14,9,"tr",7),s()()()),r&2){let e=c().$implicit,t=c();l(2),b("",e," Items"),l(17),p("ngForOf",t.formLines[e])}}function lt(r,u){if(r&1&&(o(0,"div"),f(1,st,20,2,"div",75),s()),r&2){let e=u.$implicit,t=c();l(),p("ngIf",(t.formLines[e]==null?null:t.formLines[e].length)>0)}}var Re=(()=>{class r{constructor(e,t,i,n,a,d){this._preEstimateTreatmentService=e,this._preEstimateService=t,this._selectedCardService=i,this._vehicleTreatmentRegistryService=n,this._route=a,this._snackBarService=d,this.preEstimateDetails=!0,this.preEstimateID=0,this.preEstimateType="PRE-ESTIMATE",this.isInsurance=!0,this.preEstimateNumber="",this.isUpdating=!1,this.insuranceOptions=["HNB","LOLC","CONTINENTAL","CO OPERATIVE","AMANA","SRI LANKA","MBSL","CEYLINCO","SANASA","PEOPLE S","AGRAHARA","FAIR FIRST","ORIENTAL","ALLIANZ"],this._router=P(K),this.filteredInsuranceOptions=[...this.insuranceOptions],this.selectedMenu="part",this.selectedVehicleModelID=0,this.partTreatments=[],this.paintTreatments=[],this.fittingChargeTreatments=[],this.repairTreatments=[],this.otherTreatments=[],this.formService=P(Le),this._fuseNavigationService=P(re),this.editForm=this.formService.createPreEstimateFormGroup(),this.selectedVehicleandClientDetails=null,this.vehiclePreEstimateTreatments=[],this._fuseAlertService=P(be),this.menuData=[{id:"pre-estimates",title:"Pre Estimates",type:"group",children:[{id:"part",title:"Part",type:"basic",icon:"heroicons_outline:inbox",function:()=>this.selectMenu("part")},{id:"fitting_charge",title:"Fitting Charge",type:"basic",icon:"heroicons_outline:bolt",function:()=>this.selectMenu("fitting_charge")},{id:"repair",title:"Repair",type:"basic",icon:"heroicons_outline:wrench-screwdriver",function:()=>this.selectMenu("repair")},{id:"paint",title:"Paint",type:"basic",icon:"heroicons_outline:paint-brush",function:()=>this.selectMenu("paint")},{id:"other",title:"Other",type:"basic",icon:"heroicons_outline:ellipsis-horizontal-circle",function:()=>this.selectMenu("other")}]}],this.formLines={part:[],fitting_charge:[],repair:[],paint:[],other:[]},this.filteredWorks={part:[],fitting_charge:[],repair:[],paint:[],other:[]},this._fuseNavigationService.getComponent("mainNavigation").close()}ngOnInit(){if(this._selectedCardService.selectedCard$.subscribe(t=>{this.selectedVehicleandClientDetails=t,console.log("Selected Vehicle and Client Details:",this.selectedVehicleandClientDetails),this.selectedVehicleModelID=Number(t?.vehicle?.modelID)||0}),console.log("\u{1F697} Vehicle Model ID:",this.selectedVehicleModelID),this.selectedVehicleModelID){console.log("\u{1F697} Vehicle Model ID:",this.selectedVehicleModelID);let t={page:0,size:1e3};this._vehicleTreatmentRegistryService.query(t).subscribe(i=>{console.log("\u{1F697} Vehicle Treatment Registry:",i.headers);let n=i.body||[];this.partTreatments=n.filter(a=>a.treatmentType==="PART"),console.log("\u{1F697} Part Treatments:",this.partTreatments),this.paintTreatments=n.filter(a=>a.treatmentType==="PAINT"),console.log("\u{1F3A8} Paint Treatments:",this.paintTreatments),this.fittingChargeTreatments=n.filter(a=>a.treatmentType==="FITTING_CHARGE"),this.repairTreatments=n.filter(a=>a.treatmentType==="REPAIR"),this.otherTreatments=n})}else{let t={size:1e3};this._vehicleTreatmentRegistryService.query(t).subscribe(i=>{console.log("\u{1F697} Vehicle Treatment Registry:",i.headers);let n=i.body||[];this.partTreatments=n.filter(a=>a.treatmentType==="PART"),console.log("\u{1F697} Part Treatments:",this.partTreatments),this.paintTreatments=n.filter(a=>a.treatmentType==="PAINT"),console.log("\u{1F3A8} Paint Treatments:",this.paintTreatments),this.fittingChargeTreatments=n.filter(a=>a.treatmentType==="FITTING_CHARGE"),this.repairTreatments=n.filter(a=>a.treatmentType==="REPAIR"),this.otherTreatments=n})}let e=this._route.snapshot.paramMap.get("id");e&&(this.isUpdating=!0,this.preEstimateID=Number(e),this._preEstimateService.find(Number(e)).subscribe(t=>{t.body&&(this.isInsurance=t.body.isInsurance,this.preEstimateNumber=t.body.preEstimateNumber,this.insuranceProviderID=t.body.insuranceID,this.insuranceProvider=t.body.insuranceName,this.numberOfPanels=t.body.numberOfPanels,this.preEstimateType=t.body.preEstimateType)}),this._preEstimateTreatmentService.query({"preEstimateId.equals":`${e}`}).subscribe(t=>{console.log("\u{1F697} Vehicle Pre-Estimate Treatments:",t.body),this.vehiclePreEstimateTreatments=t.body||[],this.vehiclePreEstimateTreatments.length>0&&this.vehiclePreEstimateTreatments.forEach(i=>{let n=this.mapTreatmentTypeToSection(i.treatmentType);n&&this.formLines[n].push({id:i.id,works:i.partName||i.repairName||i.paintName||i.fittingChargeName||i.other||"",quantity:i.quantity,type:i.type,marketPrice:i.marketPrice,sh:i.sh,priceType:i.priceType,customPrice:i.customPrice,price:i.price})})})),console.log("Received ID:",e)}loadAfterCreate(e){e&&(this.isUpdating=!0,this.preEstimateID=Number(e),this._preEstimateService.find(Number(e)).subscribe(t=>{t.body&&(this.isInsurance=t.body.isInsurance,this.preEstimateNumber=t.body.preEstimateNumber,this.insuranceProviderID=t.body.insuranceID,this.insuranceProvider=t.body.insuranceName,this.numberOfPanels=t.body.numberOfPanels,this.preEstimateType=t.body.preEstimateType)}),this._preEstimateTreatmentService.query({"preEstimateId.equals":`${e}`}).subscribe(t=>{console.log("\u{1F697} Vehicle Pre-Estimate Treatments:",t.body),this.vehiclePreEstimateTreatments=t.body||[],this.vehiclePreEstimateTreatments.length>0&&this.vehiclePreEstimateTreatments.forEach(i=>{let n=this.mapTreatmentTypeToSection(i.treatmentType);n&&this.formLines[n].push({id:i.id,works:i.partName||i.repairName||i.paintName||i.fittingChargeName||i.other||"",quantity:i.quantity,type:i.type,marketPrice:i.marketPrice,sh:i.sh,priceType:i.priceType,customPrice:i.customPrice,price:i.price})})}))}getWorkName(e){return e.partName||e.repairName||e.paintName||e.fittingChargeName}filterWorks(e,t){let i=this.getTreatmentList(t);if(!e){this.filteredWorks[t]=i.slice(0,2);return}let n=e.toLowerCase();this.filteredWorks[t]=i.filter(a=>this.getWorkName(a).toLowerCase().includes(n))}getTreatmentList(e){switch(e){case"part":return this.partTreatments;case"fitting_charge":return this.fittingChargeTreatments;case"repair":return this.repairTreatments;case"paint":return this.paintTreatments;case"other":return this.otherTreatments;default:return[]}}onWorkSelected(e,t,i){let n=this.getTreatmentList(i).find(a=>this.getWorkName(a)===e);n&&this.onLineInputChange("works",this.getWorkName(n),t,i)}mapTreatmentTypeToSection(e){switch(e.toUpperCase()){case"PART":return"part";case"REPAIR":return"repair";case"PAINT":return"paint";case"FITTING_CHARGE":return"fitting_charge";case"OTHER":return"other";default:return null}}filterInsuranceOptions(e){let t=e.toLowerCase();this.filteredInsuranceOptions=this.insuranceOptions.filter(i=>i.toLowerCase().includes(t))}getWorkOptions(e){switch(e){case"part":return this.partTreatments.map(t=>t.partName);case"fitting_charge":return this.fittingChargeTreatments.map(t=>t.fittingChargeName);case"repair":return this.repairTreatments.map(t=>t.repairName);case"paint":return this.paintTreatments.map(t=>t.paintName);case"other":return this.otherTreatments.map(t=>t.partName);default:return[]}}selectMenu(e){this.selectedMenu=e}addLine(e){this.formLines[e].push(this.createEmptyLine())}removeLine(e,t){let i=this.formLines[e].indexOf(t);i>-1&&this.formLines[e].splice(i,1)}createEmptyLine(){return{works:"",sh:"",marketPrice:"",quantity:null,type:"",priceType:"",customPrice:null,price:null}}onLineInputChange(e,t,i,n){let a=this.formLines[n].indexOf(i);a>-1&&(this.formLines[n][a]=E(x({},i),{[e]:t}));let d=E(x({},i),{[e]:t});e==="priceType"&&t==="SYSTEM"&&(d.customPrice="AP"),this.formLines[n][a]=d,console.log(`\u2705 ${e} changed to:`,t),console.log("\u{1F9FE} Full updated line:",this.formLines[n][a])}logLine(e,t){console.log(`\u{1F50D} Logging line in section [${t}]`,JSON.stringify(e))}trackByIndex(e){return e}createPreEstimate(){return R(this,null,function*(){let e=this.selectedVehicleandClientDetails?.vehicle?.licenseNo;if(!e||e.trim()===""){this.show("alertBox4"),setTimeout(()=>this.dismiss("alertBox4"),4e3);return}this.dismiss("alertBox4");let t=yield this.getNextPreEstimateID();this.preEstimateNumber=t;let i={id:null,preEstimateNumber:t,vehicleID:this.selectedVehicleandClientDetails?.vehicle.id?.toString()??null,licenseNo:this.selectedVehicleandClientDetails?.vehicle.licenseNo??null,vehicleBrand:this.selectedVehicleandClientDetails?.vehicle.brand??null,vehicleModel:this.selectedVehicleandClientDetails?.vehicle.model??null,vehicleOwnerID:this.selectedVehicleandClientDetails?.client.id?.toString()??null,vehicleOwnerName:this.selectedVehicleandClientDetails?.client.name??null,vehicleOwnerContactNumber1:this.selectedVehicleandClientDetails?.client.contactNumber1??null,vehicleOwnerContactNumber2:this.selectedVehicleandClientDetails?.client.contactNumber2??null,isInsurance:this.isInsurance,insuranceID:this.insuranceProviderID,insuranceName:this.insuranceProvider,opsUnitID:null,preEstimateType:this.preEstimateType,totalPrice:0,isActive:!0,numberOfPanels:this.numberOfPanels,createdBy:null,createdDate:null,lastModifiedBy:null,lastModifiedDate:null};console.log("NewPreEstimate:",i),this._preEstimateService.create(i).subscribe(n=>{console.log("Pre-estimate Created Successfully:",n),this.preEstimateID=n.body.id,this.createPreEstimateTreatments(n.body?.id)},n=>{console.error("Error Creating Pre Estimate:",n)})})}createPreEstimateTreatments(e){let t=[];Object.keys(this.formLines).forEach(n=>{this.formLines[n].forEach(a=>{let d={id:null,fittingChargeName:n==="fitting_charge"?a.works:null,paintName:n==="paint"?a.works:null,partName:n==="part"?a.works:null,repairName:n==="repair"?a.works:null,other:n==="other"?a.works:null,marketPrice:a.marketPrice,quantity:null,type:null,priceType:null,customPrice:null,price:a.price,sh:a.sh?a.sh:null,treatmentType:n.toUpperCase(),isSystemPrice:!0,unitPrice:null,partNumber:null,vehicleTreatmentID:null,opsUnitID:null,createdBy:null,createdDate:null,lastModifiedBy:null,lastModifiedDate:null,preEstimate:{id:e}};t.push(d)})});let i=t.map(n=>this._preEstimateTreatmentService.create(n));F(i).subscribe({next:n=>{console.log("\u2705 All treatments created:",n),this._snackBarService.open("Pre Estimate Created Successfully!","Close",{duration:3e3}),this.preEstimateID=e,this.formLines={part:[],fitting_charge:[],repair:[],paint:[],other:[]},this.loadAfterCreate(this.preEstimateID)},error:n=>{console.error("\u274C Error creating one or more treatments:",n)}})}getSectionTotal(e){return this.formLines[e]?.reduce((t,i)=>{let n=i.price??i.marketPrice;return t+(n?Number(n):0)},0)||0}toggleEstimateAndTreatments(){this.preEstimateDetails=!this.preEstimateDetails}updatePreEstimate(){let e=this.selectedVehicleandClientDetails?.vehicle?.licenseNo;if(!e||e.trim()===""){this.show("alertBox4"),setTimeout(()=>this.dismiss("alertBox4"),4e3);return}this.dismiss("alertBox4");let t={id:this.preEstimateID,preEstimateNumber:this.preEstimateNumber,vehicleID:this.selectedVehicleandClientDetails?.vehicle.id?.toString()??null,licenseNo:this.selectedVehicleandClientDetails?.vehicle.licenseNo??null,vehicleBrand:this.selectedVehicleandClientDetails?.vehicle.brand??null,vehicleModel:this.selectedVehicleandClientDetails?.vehicle.model??null,vehicleOwnerID:this.selectedVehicleandClientDetails?.client.id?.toString()??null,vehicleOwnerName:this.selectedVehicleandClientDetails?.client.name??null,vehicleOwnerContactNumber1:this.selectedVehicleandClientDetails?.client.contactNumber1??null,vehicleOwnerContactNumber2:this.selectedVehicleandClientDetails?.client.contactNumber2??null,isInsurance:this.isInsurance,insuranceID:this.insuranceProviderID,insuranceName:this.insuranceProvider,opsUnitID:null,totalPrice:0,isActive:!0,numberOfPanels:this.numberOfPanels,createdBy:null,createdDate:null,lastModifiedBy:null,lastModifiedDate:null,preEstimateType:this.preEstimateType};console.log("NewPreEstimate:",t),this._preEstimateService.update(t).subscribe(i=>{console.log("Pre Estimate Created Successfully:",i),this.updatePreEstimateTreatments(i.body?.id)},i=>{console.error("Error Creating Pre Estimate:",i)})}updatePreEstimateTreatments(e){let t=[];Object.keys(this.formLines).forEach(i=>{this.formLines[i].forEach(n=>{let a={id:n.id,fittingChargeName:i==="fitting_charge"?n.works:null,paintName:i==="paint"?n.works:null,partName:i==="part"?n.works:null,repairName:i==="repair"?n.works:null,other:i==="other"?n.works:null,marketPrice:n.marketPrice,quantity:null,type:null,priceType:null,customPrice:null,price:n.price,sh:n.sh?n.sh:null,treatmentType:i.toUpperCase(),isSystemPrice:!0,unitPrice:null,partNumber:null,vehicleTreatmentID:null,opsUnitID:null,createdBy:null,createdDate:null,lastModifiedBy:null,lastModifiedDate:null,preEstimate:{id:e}};t.push(a)})}),t.forEach(i=>{if(!i.id){let a=E(x({},i),{id:null});this._preEstimateTreatmentService.create(a).subscribe({next:d=>{console.log("New Pre Estimate Line Created:",d),this._snackBarService.open("New Line Added Successfully!","Close",{duration:3e3})},error:d=>{console.error("Error Adding New Line:",d)}})}else this._preEstimateTreatmentService.update(i).subscribe({next:a=>{console.log("Pre Estimate Line Updated:",a),this._snackBarService.open("Line Updated Successfully!","Close",{duration:3e3})},error:a=>{console.error("Error Updating Line:",a)}})})}printEstimate(){let e=document.getElementById("print-section"),t=document.body.innerHTML;e&&(document.body.innerHTML=e.innerHTML,window.print(),document.body.innerHTML=t)}print(){let e=this.preEstimateID;this._router.navigate(["/pre-estimates-print/",e])}createEstimate(){let e=this.preEstimateID;this._router.navigate(["/create-estimates"],{state:{presEstimateID:e}})}getNextPreEstimateID(){let e={page:0,size:1,sort:"id,desc"};return new Promise(t=>{this._preEstimateService.query(e).subscribe(i=>{let n=i.body?.[0],a="PRE-EST-000001";n?.preEstimateNumber&&(a="PRE-EST-"+(parseInt(n.preEstimateNumber.replace("PRE-EST-",""),10)+1).toString().padStart(6,"0")),t(a)})})}dismiss(e){this._fuseAlertService.dismiss(e)}show(e){this._fuseAlertService.show(e)}onMarketPriceInput(e,t,i){let a=e.target.value.replace(/,/g,""),d=parseFloat(a);isNaN(d)?t.marketPrice=0:(t.marketPrice=d,this.onLineInputChange("marketPrice",d,t,i))}onEstimatePriceInput(e,t,i){let a=e.target.value.replace(/,/g,""),d=parseFloat(a);isNaN(d)?t.price=0:(t.price=d,this.onLineInputChange("price",d,t,i))}static{this.\u0275fac=function(t){return new(t||r)(y(Oe),y(Pe),y(Te),y(ke),y(J),y(we))}}static{this.\u0275cmp=$({type:r,selectors:[["app-pre-estimates-create"]],decls:7,vars:8,consts:[["fuseCard",""],["insuranceAuto","matAutocomplete"],["auto","matAutocomplete"],[1,"flex","h-screen","w-full"],[1,"w-60","bg-white"],[3,"navigation","inner","mode","opened"],[1,"flex-1","p-6","overflow-y-auto","bg-gray-50","transition-all","duration-300","ease-in-out","relative"],[4,"ngFor","ngForOf"],["id","print-section",1,"hidden","print:block","p-6","text-sm","text-gray-800"],["class","animate-fade-in",3,"hidden",4,"ngIf"],[1,"animate-fade-in",3,"hidden"],[1,"flex","justify-between","items-center","mb-6","border-b"],[1,"flex","flex-col","px-4","py-2","pb-4","w-full","bg-transparent","border-none","shadow-none"],[1,"flex","flex-col","gap-4"],[1,"flex","justify-between","items-start"],[1,"text-xl","font-bold","capitalize"],[1,"text-2xl","font-bold","text-indigo-600","capitalize"],[1,"flex","flex-wrap","gap-2"],["mat-button","",1,"px-4","py-2","bg-gradient-to-r","from-indigo-500","to-blue-500","hover:from-indigo-600","hover:to-blue-600","rounded-lg","shadow","text-white","flex","items-center","transition-all","duration-200",3,"click"],[1,"mr-2"],["class","icon-size-5 text-white",3,"svgIcon",4,"ngIf"],["class","px-4 py-2 bg-gradient-to-r from-emerald-500 to-green-500 hover:from-emerald-600 hover:to-green-600 rounded-lg shadow text-white flex items-center transition-all duration-200",3,"click",4,"ngIf"],["class","px-4 py-2 bg-gradient-to-r from-rose-500 to-red-500 hover:from-rose-600 hover:to-red-600 rounded-lg shadow text-white flex items-center transition-all duration-200",3,"click",4,"ngIf"],["class","px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 rounded-lg shadow text-white flex items-center transition-all duration-200",3,"click",4,"ngIf"],["class","flex flex-col gap-2",4,"ngIf"],[4,"ngIf"],[1,"flex","flex-col","gap-2"],["class","flex flex-row gap-4",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","flex-row","mt-4"],[1,"flex","justify-start"],[1,"bg-indigo-100","text-lg","text-indigo-700","font-semibold","px-2","py-1","rounded","hover:bg-indigo-200","shadow",3,"click"],[1,"icon-size-5","text-white",3,"svgIcon"],[1,"px-4","py-2","bg-gradient-to-r","from-emerald-500","to-green-500","hover:from-emerald-600","hover:to-green-600","rounded-lg","shadow","text-white","flex","items-center","transition-all","duration-200",3,"click"],[1,"icon-size-4","text-white",3,"svgIcon"],[1,"ml-2"],[1,"px-4","py-2","bg-gradient-to-r","from-rose-500","to-red-500","hover:from-rose-600","hover:to-red-600","rounded-lg","shadow","text-white","flex","items-center","transition-all","duration-200",3,"click"],[1,"px-4","py-2","bg-gradient-to-r","from-purple-500","to-pink-500","hover:from-purple-600","hover:to-pink-600","rounded-lg","shadow","text-white","flex","items-center","transition-all","duration-200",3,"click"],[3,"appearance","dismissible","dismissed","name","type"],[1,"flex","flex-col","md:flex-row","gap-4","w-full","mt-2"],[1,"ml-4","leading-tight"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"text-lg","font-semibold"],[1,"flex","gap-2",3,"ngModelChange","ngModel"],["value","SUPPLEMENTARY"],["value","PRE-ESTIMATE"],[1,"w-full","md:w-1/4","h-full"],[1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-amber-400","appearance-none",3,"ngModelChange","ngModel"],[3,"ngValue"],[1,"w-full","md:w-1/3","h-full"],["type","number","placeholder","Enter number of panels",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-amber-400",3,"ngModelChange","ngModel"],["class","w-full md:w-1/3 h-full",4,"ngIf"],["type","text","matInput","","placeholder","Search Insurance",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-amber-400","appearance-none",3,"ngModelChange","input","matAutocomplete","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"flex","flex-row","gap-4"],[1,"relative","w-1/3",3,"ngClass"],[1,"absolute","-top-2","left-3","text-xs","px-1","bg-gray-50","dark:bg-gray-900","text-gray-600","dark:text-gray-300","transform","scale-90"],["type","text","matInput","","placeholder","Select Work",1,"w-full","h-13","pt-5","pb-2","px-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-amber-400","appearance-none",3,"ngModelChange","focus","input","matAutocomplete","ngModel"],[3,"optionSelected"],["class","relative w-1/3",4,"ngIf"],["class","relative",3,"ngClass",4,"ngIf"],[1,"flex","items-center","justify-center","w-10","h-12"],["svgIcon","delete_outline",1,"cursor-pointer","w-10","h-12","text-red-500","hover:text-red-700",3,"click"],[1,"relative","w-1/3"],[1,"w-full","h-13","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-amber-400","appearance-none",3,"ngModelChange","ngModel"],["value","","disabled","","selected","","hidden",""],["value","SH"],["value","MR"],["placeholder","Price","type","text",1,"w-full","h-13","pl-12","p-3","text-right","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-amber-400",3,"input","value"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none","text-gray-500","text-lg","font-semibold"],[1,"relative",3,"ngClass"],["placeholder","Price","type","text",1,"w-full","h-13","text-right","pl-12","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-amber-400",3,"input","value"],[1,"flex","justify-end"],[1,"bg-indigo-100","text-indigo-700","font-semibold","px-2","py-1","rounded","hover:bg-indigo-200","shadow","ml-2"],[1,"text-indigo-700","text-lg","font-semibold"],["class","mb-6 border-b pb-4",4,"ngIf"],[1,"mb-6","border-b","pb-4"],[1,"text-xl","font-bold","capitalize","mb-2"],[1,"w-full","border","border-collapse","border-gray-300","text-left","text-sm"],[1,"bg-gray-200"],[1,"border","p-2"]],template:function(t,i){t&1&&(o(0,"div",3)(1,"div",4),T(2,"fuse-vertical-navigation",5),s(),o(3,"div",6),f(4,at,2,1,"ng-container",7),s()(),o(5,"div",8),f(6,lt,2,1,"div",7),s()),t&2&&(l(2),p("navigation",i.menuData)("inner",!0)("mode","side")("opened",!0),l(2),p("ngForOf",L(6,$e)),l(2),p("ngForOf",L(7,We)))},dependencies:[he,ue,_e,oe,pe,de,le,me,ge,ae,Y,U,q,H,G,z,ne,ie,Z,Q,te,ee,xe,fe,ve,X,Ee,Ce,Se,De,Ne,Me,Ie,Ve,ye],styles:[".animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .4s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@media (max-width: 768px){.animate-fade-in[_ngcontent-%COMP%]{animation:fadeIn .4s ease-in-out}}"]})}}return r})();var Qt=[{path:"",component:Re}];export{Qt as default};
