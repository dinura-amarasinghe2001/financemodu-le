import{a as Ae}from"./chunk-PMESUWSZ.js";import{a as Be}from"./chunk-FKDMVCKV.js";import{a as Se}from"./chunk-7RWLPLTW.js";import{a as Me}from"./chunk-GTGBE7YF.js";import{a as we,b as Pe}from"./chunk-7KFYK36W.js";import{a as ke}from"./chunk-Z5CSESBH.js";import{a as Ve}from"./chunk-4IV6I57G.js";import{a as Re}from"./chunk-M5AHF4UO.js";import{a as De}from"./chunk-CI6T4FGN.js";import{h as Oe}from"./chunk-ZGGKBBB7.js";import{a as Ne}from"./chunk-E4TC4E2W.js";import{a as F}from"./chunk-YEGTZ3HQ.js";import{a as pe}from"./chunk-NKWJDJWK.js";import{a as Ie}from"./chunk-3N5N6CVQ.js";import{a as le}from"./chunk-QQNGDF4M.js";import{b as Ee}from"./chunk-2V7PXVXU.js";import{a as xe,c as ye,d as be}from"./chunk-4WAQRQWE.js";import{J as fe,K as ge,O as Ce,P as Te,j as ne,l as de,q as ue,u as he,w as ve,z as _e}from"./chunk-MXRUEL7B.js";import{b as oe,c as ce}from"./chunk-PNSBUHWU.js";import{a as me}from"./chunk-V44XL57R.js";import{a as ae,d as se}from"./chunk-VPJKTFM7.js";import{fa as ie,ia as re}from"./chunk-GXFYRQIF.js";import{b as ee,d as te}from"./chunk-DJWEABC6.js";import{i as J,j as X,n as Y,p as K,r as Z}from"./chunk-MZLVPJ5Q.js";import{Aa as v,Ac as Q,Bc as p,Cc as G,Db as U,Dc as f,Ec as H,Fc as R,Gc as A,Hc as B,Jc as z,Kb as x,Qc as w,Sc as S,Tb as d,a as I,b as L,ca as P,cc as s,dc as o,ea as W,ec as T,fc as D,g as $,gc as M,ic as E,m as q,nb as l,oa as N,ob as _,oc as g,qc as m,uc as k,vc as V,wc as O,za as h}from"./chunk-2GFQMTJ2.js";var qe=()=>["part","fitting_charge","repair","paint","other"];function We(c,u){if(c&1){let t=E();s(0,"div",6)(1,"div",7)(2,"div",8)(3,"div",9)(4,"div",10)(5,"button",11)(6,"div",12),T(7,"mat-icon",13),o()()(),s(8,"div",14)(9,"div",15)(10,"input",16),g("keydown.enter",function(){h(t);let r=m();return v(r.loadPreEstimates())}),o(),s(11,"div",17),D(12),T(13,"mat-icon",13),M(),o()()(),s(14,"button",18),g("click",function(){h(t);let r=m();return v(r.createEstimate())}),s(15,"span",19),p(16,"Save"),o()(),s(17,"button",18),g("click",function(){h(t);let r=m();return v(r.estimatePassPrint())}),s(18,"span",19),p(19,"Save"),o()()()()()()}if(c&2){let t=m();l(7),d("svgIcon","mat_outline:directions_car_filled"),l(3),d("formControl",t.searchInputControl)("placeholder","Enter Pre Estimate ID"),l(3),d("svgIcon","mat_outline:directions_car_filled")}}function Ue(c,u){if(c&1){let t=E();s(0,"div",23),g("click",function(){let r=h(t).$implicit,i=m(2);return v(i.selectEsitamte(r.id))}),s(1,"div",24)(2,"span",19),p(3),o(),s(4,"span"),p(5),o(),s(6,"span",25),p(7),w(8,"date"),o()()()}if(c&2){let t=u.$implicit;l(3),H("#",t.id," \u2014 ",t.licenseNo,""),l(2),G(t.vehicleOwnerName),l(2),f(" ",t.createdDate?S(8,4,t.createdDate,"medium"):"N/A"," ")}}function Qe(c,u){if(c&1&&(s(0,"div",20)(1,"div",21),x(2,Ue,9,7,"div",22),o()()),c&2){let t=m();l(2),d("ngForOf",t.resentEsitamte)}}function Ge(c,u){if(c&1){let t=E();s(0,"div",47)(1,"div")(2,"div",48),p(3),o()(),s(4,"div",49)(5,"button",50),g("click",function(){h(t);let r=m(2);return v(r.updateEstimate())}),s(6,"span",51),p(7,"Update"),o()(),s(8,"button",50),g("click",function(){h(t);let r=m(2);return v(r.estimatePassPrint())}),s(9,"span",52),p(10,"Print"),o()()()()}if(c&2){let t=m(2);l(3),f(" #",t.estimateNumber," ")}}function He(c,u){if(c&1&&(s(0,"div",26)(1,"div",27)(2,"div",28),x(3,Ge,11,1,"div",29),s(4,"div",30)(5,"div",31)(6,"div",32),T(7,"mat-icon",33),o(),s(8,"div",34)(9,"div",35),p(10," Vehicle licenseNo "),o(),s(11,"div",36),p(12),s(13,"div",37),p(14),o()(),s(15,"div",38)(16,"div",39)(17,"div",40),p(18),o(),s(19,"div",41),p(20),o()()()()(),s(21,"div",31)(22,"div",42),T(23,"mat-icon",33),o(),s(24,"div",34)(25,"div",35),p(26,"Owner"),o(),s(27,"div",36),p(28),o(),s(29,"div",43)(30,"div",44),p(31),o(),s(32,"div",45),p(33),o()()()(),s(34,"div",31)(35,"div",46),T(36,"mat-icon",33),o(),s(37,"div",34)(38,"div",35),p(39,"Insurance"),o(),s(40,"div",36),p(41),o()()()()()()()),c&2){let t,e=m();l(3),d("ngIf",e.estimateNumber),l(4),d("svgIcon","mat_outline:directions_car_filled"),l(5),f(" ",e.esitamte.licenseNo," "),l(2),f(" Panels: ",(t=e.esitamte.numberOfPanels)!==null&&t!==void 0?t:0," "),l(4),f(" ",e.esitamte.vehicleBrand," "),l(2),f(" ",e.esitamte.vehicleModel," "),l(3),d("svgIcon","heroicons_outline:user-circle"),l(5),f(" ",e.esitamte.vehicleOwnerName," "),l(3),f(" ",e.esitamte.vehicleOwnerContactNumber1," "),l(2),f(" ",e.esitamte.vehicleOwnerContactNumber2," "),l(3),d("svgIcon","heroicons_outline:clipboard-document-list"),l(5),f(" ",e.esitamte.insuranceName," ")}}function ze(c,u){c&1&&(s(0,"div",61),p(1,"S/H"),o())}function Je(c,u){if(c&1&&(s(0,"mat-option",71),p(1),o()),c&2){let t=u.$implicit,e=m(3).$implicit,r=m(2);d("value",r.getWorkName(t,e)),l(),f(" ",r.getWorkName(t,e)," ")}}function Xe(c,u){if(c&1){let t=E();s(0,"div",61)(1,"input",72),B("ngModelChange",function(r){h(t);let i=m().$implicit;return A(i.sh,r)||(i.sh=r),v(r)}),g("ngModelChange",function(r){h(t);let i=m().$implicit,n=m(2).$implicit,a=m(2);return v(a.onLineInputChange("sh",r,i,n))}),o()()}if(c&2){let t=m().$implicit;l(),R("ngModel",t.sh)}}function Ye(c,u){if(c&1){let t=E();s(0,"div",63)(1,"div",64)(2,"input",65),B("ngModelChange",function(r){let i=h(t).$implicit;return A(i.works,r)||(i.works=r),v(r)}),g("focus",function(){h(t);let r=m(2).$implicit,i=m(2);return v(i.filterWorks("",r))})("input",function(r){h(t);let i=m(2).$implicit,n=m(2);return v(n.filterWorks(r.target.value,i))}),o(),s(3,"mat-autocomplete",66,0),g("optionSelected",function(r){let i=h(t).$implicit;return v(i.works=r.option.value)}),x(5,Je,2,2,"mat-option",67),o()(),x(6,Xe,2,1,"div",60),s(7,"div",68)(8,"input",69),w(9,"number"),g("input",function(r){let i=h(t).$implicit,n=m(2).$implicit,a=m(2);return v(a.onEstimatePriceInput(r,i,n))}),o(),s(10,"div",70),p(11," Rs "),o()(),s(12,"div",68)(13,"input",69),w(14,"number"),g("input",function(r){let i=h(t).$implicit,n=m(2).$implicit,a=m(2);return v(a.onApprovedPriceInput(r,i,n))}),o(),s(15,"div",70),p(16," Rs "),o()()()}if(c&2){let t=u.$implicit,e=Q(4),r=m(2).$implicit,i=m(2);l(2),d("matAutocomplete",e),R("ngModel",t.works),l(3),d("ngForOf",i.filteredWorks[r]),l(),d("ngIf",r==="part"),l(2),d("value",S(9,6,t.price,"1.0-0")),l(5),d("value",S(14,9,t.approvedPrice,"1.0-0"))}}function Ke(c,u){if(c&1&&(s(0,"div",56)(1,"h2",57),p(2),o(),s(3,"div",58)(4,"div",59),p(5,"Work"),o(),x(6,ze,2,0,"div",60),s(7,"div",61),p(8,"Price"),o(),s(9,"div",61),p(10,"Approved Amount"),o()(),x(11,Ye,17,12,"div",62),o()),c&2){let t=m().$implicit,e=m(2);l(2),f(" ",e.sectionLabels[t]," "),l(4),d("ngIf",t==="part"),l(5),d("ngForOf",e.formLines[t])}}function Ze(c,u){if(c&1&&(D(0),x(1,Ke,12,3,"div",55),M()),c&2){let t=u.$implicit,e=m(2);l(),d("ngIf",(e.formLines[t]==null?null:e.formLines[t].length)>0)}}function et(c,u){c&1&&(s(0,"div",53),x(1,Ze,2,1,"ng-container",54),o()),c&2&&(l(),d("ngForOf",z(1,qe)))}var $t=(()=>{class c{constructor(t,e,r,i,n,a,y,b,C,Fe,je,Le,$e){this._preEstimateService=t,this._estimateService=e,this._estimateTreatmentService=r,this._vehicleRegistryService=i,this._clientRegistryService=n,this._preEstimateTreatmentService=a,this._vehicleModelService=y,this._vehicleTreatmentRegistryService=b,this._route=C,this._snackBarService=Fe,this._userService=je,this._router=Le,this._selectedCardService=$e,this._unsubscribeAll=new q,this.searchInputControl=new he,this.resentEsitamte=[],this.vehiclePreEstimateTreatments=[],this.totalItems=0,this.itemsPerPage=10,this.esitamteID=null,this.estimateNumber=null,this.partTreatments=[],this.paintTreatments=[],this.fittingChargeTreatments=[],this.repairTreatments=[],this.otherTreatments=[],this.preEstimateType="",this.allVehicleDetails=[],this.allClientDetails=[],this.searchByVehicleNo=!0,this.selectedCard=null,this._fuseNavigationService=N(pe),this._fuseConfirmationService=N(le),this.filteredWorks={part:[],fitting_charge:[],repair:[],paint:[],other:[]},this.sectionLabels={part:"Part",fitting_charge:"Fitting Charge",repair:"Repair",paint:"Paint",other:"Other"},this.formLines={part:[],fitting_charge:[],repair:[],paint:[],other:[]},this.searchInputControl.valueChanges.subscribe(it=>{this.loadPreEstimates()}),this._fuseNavigationService.getComponent("mainNavigation").close();let j=this._router.getCurrentNavigation()?.extras.state?.presEstimateID;this.searchInputControl.setValue(j),j&&(this.loadPreEstimates(),console.log("Im first"))}ngOnInit(){this._selectedCardService.selectedCard$.subscribe(r=>{this.selectedCard=r,console.log("Selected Vehicle and Client Details:",this.selectedCard)}),this._userService.user$.pipe(P(this._unsubscribeAll)).subscribe(r=>{this.user=r});let t={size:5,"licenseNo.contains":`${this.selectedCard?.vehicle?.licenseNo}`,sort:"createdDate,desc"};this._preEstimateService.query(t).subscribe(r=>{if(console.log("Recent Estimatesssssssssssss:",r.body),this.resentEsitamte=r.body||[],r.body.length===0){let i={size:5,sort:"createdDate,desc"};this._preEstimateService.query(i).subscribe(n=>{console.log("Recent Estimatesssssssssssss:",n.body),this.resentEsitamte=n.body||[]})}});let e=this._route.snapshot.paramMap.get("id");this.esitamteID=e,e&&this._estimateService.find(Number(e)).subscribe(r=>{this.esitamte=r.body,this.estimateNumber=r.body.estimateID,this.esitamte&&this._estimateTreatmentService.query({"estimateId.equals":`${this.esitamte.id}`}).subscribe(i=>{console.log("\u{1F697} Vehicle Pre-Estimate Treatments:",i.body),this.vehiclePreEstimateTreatments=i.body||[],this.vehiclePreEstimateTreatments.length>0&&this.vehiclePreEstimateTreatments.forEach(n=>{let a=this.mapTreatmentTypeToSection(n.treatmentType);a&&this.formLines[a].push({id:n.id,works:n.partName||n.repairName||n.paintName||n.fittingChargeName||n.other||"",quantity:n.quantity,type:n.type,priceType:n.sh,sh:n.sh,customPrice:n.customPrice,price:n.price,approvedPrice:n.approvedPrice,approvedPriceState:n.approvedPriceState,approvedDate:n.approvedDate?n.approvedDate.toDate():null,estimateTreatmentReason:n.estimateTreatmentReason})})})})}estimatePassPrint(){let t=this.esitamteID;this._router.navigate(["/estimate-print",t],{queryParams:{estimateId:t}})}loadAfterSave(t){t&&this._estimateService.find(Number(t)).subscribe(e=>{this.esitamte=e.body,this.esitamte&&this._estimateTreatmentService.query({"estimateId.equals":`${this.esitamte.id}`}).subscribe(r=>{console.log("\u{1F697} Vehicle Pre-Estimate Treatments:",r.body),this.vehiclePreEstimateTreatments=r.body||[],this.vehiclePreEstimateTreatments.length>0&&this.vehiclePreEstimateTreatments.forEach(i=>{let n=this.mapTreatmentTypeToSection(i.treatmentType);n&&this.formLines[n].push({id:i.id,works:i.partName||i.repairName||i.paintName||i.fittingChargeName||i.other||"",quantity:i.quantity,type:i.type,priceType:i.sh,sh:i.sh,customPrice:i.customPrice,price:i.price,approvedPrice:i.approvedPrice,approvedPriceState:i.approvedPriceState,approvedDate:i.approvedDate?i.approvedDate.toDate():null,estimateTreatmentReason:i.estimateTreatmentReason})})})})}selectEsitamte(t){this.searchInputControl.setValue(String(t)),this.searchInputControl.value&&(this.loadPreEstimates(),console.log("Im Second"))}loadPreEstimates(){let t=this.searchInputControl.value,e=typeof t=="string"?t.trim():String(t);this._preEstimateService.find(Number(e)).pipe(P(this._unsubscribeAll),W(r=>{this.totalItems=Number(r.headers.get("X-Total-Count"));let i=I({},r.body);this.esitamte=i,this.esitamte&&this._vehicleModelService.query().subscribe(n=>{let a=n.body?.[0]?.id;this._vehicleTreatmentRegistryService.query({"vehicleModelId.equals":`${a}`}).subscribe(y=>{console.log("\u{1F697} Vehicle Treatment Registry:",y.headers);let b=y.body||[];this.partTreatments=b.filter(C=>C.treatmentType==="PART"),console.log("\u{1F697} Part Treatments:",this.partTreatments),this.paintTreatments=b.filter(C=>C.treatmentType==="PAINT"),console.log("\u{1F3A8} Paint Treatments:",this.paintTreatments),this.fittingChargeTreatments=b.filter(C=>C.treatmentType==="FITTING_CHARGE"),this.repairTreatments=b.filter(C=>C.treatmentType==="REPAIR"),this.otherTreatments=b})}),this.esitamte&&this._preEstimateTreatmentService.query({"preEstimateId.equals":`${this.esitamte.id}`}).subscribe(n=>{console.log("\u{1F697} Vehicle Pre-Estimate Treatmentsssssssssssssssssss:",n.body),this.vehiclePreEstimateTreatments=(n.body||[]).map(a=>I({},a)),Object.keys(this.formLines).forEach(a=>{this.formLines[a]=[]}),this.vehiclePreEstimateTreatments.forEach(a=>{let y=this.mapTreatmentTypeToSection(a.treatmentType);y&&this.formLines[y].push({id:a.id,works:a.partName||a.repairName||a.paintName||a.fittingChargeName||a.other||"",quantity:a.quantity,type:a.type,priceType:a.sh,sh:a.sh,customPrice:a.customPrice,price:a.price||a.marketPrice,approvedPrice:a.approvedPrice,approvedPriceState:a.approvedPriceState,approvedDate:a.approvedDate?a.approvedDate.toDate():null,estimateTreatmentReason:a.estimateTreatmentReason})})})})).subscribe()}mapTreatmentTypeToSection(t){switch(t.toUpperCase()){case"PART":return"part";case"REPAIR":return"repair";case"PAINT":return"paint";case"FITTING_CHARGE":return"fitting_charge";case"OTHER":return"other";default:return null}}filterWorks(t,e){let r=this.getWorkOptions(e);this.filteredWorks[e]=r.filter(i=>this.getWorkName(i,e).toLowerCase().includes(t.toLowerCase()))}getWorkOptions(t){switch(t){case"part":return this.partTreatments;case"fitting_charge":return this.fittingChargeTreatments;case"repair":return this.repairTreatments;case"paint":return this.paintTreatments;case"other":return this.otherTreatments;default:return[]}}getWorkName(t,e){switch(e){case"part":return t.partName||"";case"fitting_charge":return t.fittingChargeName||"";case"repair":return t.repairName||"";case"paint":return t.paintName||"";case"other":return t.partName||t.repairName||t.paintName||t.fittingChargeName||"";default:return""}}syncFormLinesToTreatments(){let t={part:"PART",fitting_charge:"FITTING_CHARGE",repair:"REPAIR",paint:"PAINT",other:"OTHER"};this.vehiclePreEstimateTreatments=[],Object.keys(this.formLines).forEach(e=>{this.formLines[e].forEach(r=>{let i=L(I({},r),{treatmentType:t[e]});this.vehiclePreEstimateTreatments.push(i)})})}groupTreatmentsBySection(){let t={PART:"part",FITTING_CHARGE:"fitting_charge",REPAIR:"repair",PAINT:"paint",OTHER:"other"};Object.keys(this.formLines).forEach(e=>{this.formLines[e]=[]}),this.vehiclePreEstimateTreatments.forEach(e=>{let r=t[e.treatmentType?.toUpperCase()]||"other";this.formLines[r].push(e)})}createEstimate(){return $(this,null,function*(){let t=yield this.getNextEstimateID();this.estimateNumber=t;let e={id:null,serviceAdvisor:this.user.name,serviceAdvisorID:this.user.id,vehicleID:this.esitamte.vehicleID,licenseNo:this.esitamte.licenseNo,vehicleBrand:this.esitamte.vehicleBrand,vehicleModel:this.esitamte.vehicleModel,vehicleOwnerID:this.esitamte.vehicleOwnerID,vehicleOwnerName:this.esitamte.vehicleOwnerName,vehicleOwnerContactNumber1:this.esitamte.vehicleOwnerContactNumber1,vehicleOwnerContactNumber2:this.esitamte.vehicleOwnerContactNumber2,opsUnitID:this.esitamte.opsUnitID,totalPrice:this.esitamte.totalPrice,estimateID:t,numberOfPanels:this.esitamte.numberOfPanels,createdBy:this.esitamte.createdBy,createdDate:this.esitamte.createdDate,lastModifiedBy:this.esitamte.lastModifiedBy,lastModifiedDate:this.esitamte.lastModifiedDate,insuranceID:this.esitamte.insuranceID,insuranceName:this.esitamte.insuranceName,isInsurance:this.esitamte.isInsurance,preEstimateType:this.esitamte.preEstimateType};console.log("\u{1F697} Estimate:",e),this._estimateService.create(e).subscribe(r=>{r.body&&(console.log("\u{1F6E0}\uFE0F Estimate created:",r.body),this.createEstimateTreatments(r.body.id))})})}createEstimateTreatments(t){if(!this.vehiclePreEstimateTreatments||this.vehiclePreEstimateTreatments.length===0)return;let e=0,r=this.vehiclePreEstimateTreatments.length;this.vehiclePreEstimateTreatments.forEach(i=>{let n={id:null,vehicleTreatmentID:i.vehicleTreatmentID,fittingChargeName:i.fittingChargeName,paintName:i.paintName,partName:i.partName,sh:i.sh,other:i.other,repairName:i.repairName,priceType:i.priceType,type:i.type,partNumber:i.partNumber,availableQuantity:i.availableQuantity,unitPrice:i.unitPrice,treatmentType:i.treatmentType,quantity:i.quantity,isSystemPrice:i.isSystemPrice,isPriceConfirmed:i.isPriceConfirmed,approvedDate:i.approvedDate?F(i.approvedDate):void 0,price:i.price||i.marketPrice,customPrice:i.customPrice,approvedPrice:i.approvedPrice,approvedPriceState:i.approvedPriceState,estimateTreatmentReason:i.estimateTreatmentReason,opsUnitID:i.opsUnitID,createdBy:i.createdBy,createdDate:i.createdDate,lastModifiedBy:i.lastModifiedBy,lastModifiedDate:i.lastModifiedDate,estimate:{id:t}};this._estimateTreatmentService.create(n).subscribe(a=>{console.log("\u2705 Estimate Treatment Created:",a.body),e++,e===r&&(this.esitamteID=t.toString(),this.formLines={part:[],fitting_charge:[],repair:[],paint:[],other:[]},this.loadAfterSave(Number(t)),this._fuseConfirmationService.open({title:"Estimate Created!",message:"The estimate was created successfully. Do you want to go to the Job Card now?",icon:{name:"heroicons_outline:check-circle",color:"accent"},dismissible:!0,actions:{confirm:{label:"Yes, Go to Job Card",color:"primary"},cancel:{label:"No, Stay Here"}}}).afterClosed().subscribe(b=>{b==="confirmed"&&this._router.navigate(["/job-cards-create"])}))})})}onLineInputChange(t,e,r,i){if(r[t]=e,!r.id){console.warn("\u274C Line has no ID!",r);return}let n=this.vehiclePreEstimateTreatments.findIndex(a=>a.id===r.id);if(n!==-1){if(this.vehiclePreEstimateTreatments[n][t]=e,t==="works")switch(i){case"part":this.vehiclePreEstimateTreatments[n].partName=e;break;case"repair":this.vehiclePreEstimateTreatments[n].repairName=e;break;case"paint":this.vehiclePreEstimateTreatments[n].paintName=e;break;case"fitting_charge":this.vehiclePreEstimateTreatments[n].fittingChargeName=e;break;case"other":this.vehiclePreEstimateTreatments[n].other=e;break}console.log(`\u2705 Updated ${t} in treatment index ${n}`)}else console.warn(`\u274C Could not find matching treatment for line ID ${r.id}`,r)}updateEstimate(){let t={id:this.esitamte.id,vehicleID:this.esitamte.vehicleID,serviceAdvisor:this.esitamte.serviceAdvisor,serviceAdvisorID:this.esitamte.serviceAdvisorID,licenseNo:this.esitamte.licenseNo,vehicleBrand:this.esitamte.vehicleBrand,vehicleModel:this.esitamte.vehicleModel,vehicleOwnerID:this.esitamte.vehicleOwnerID,vehicleOwnerName:this.esitamte.vehicleOwnerName,vehicleOwnerContactNumber1:this.esitamte.vehicleOwnerContactNumber1,vehicleOwnerContactNumber2:this.esitamte.vehicleOwnerContactNumber2,opsUnitID:this.esitamte.opsUnitID,totalPrice:this.esitamte.totalPrice,estimateID:this.esitamte.estimateID,numberOfPanels:this.esitamte.numberOfPanels,createdBy:this.esitamte.createdBy,createdDate:this.esitamte.createdDate,lastModifiedBy:this.esitamte.lastModifiedBy,lastModifiedDate:this.esitamte.lastModifiedDate,insuranceID:this.esitamte.insuranceID,insuranceName:this.esitamte.insuranceName,isInsurance:this.esitamte.isInsurance,preEstimateType:this.esitamte.preEstimateType};console.log("\u{1F697} Estimate:",t),this._estimateService.update(t).subscribe(e=>{console.log("\u{1F6E0}\uFE0F Estimate updated:",e.body),e.body&&this.updateEstimateTreatments(e.body.id)})}updateEstimateTreatments(t){!this.vehiclePreEstimateTreatments||this.vehiclePreEstimateTreatments.length===0||this.vehiclePreEstimateTreatments.forEach(e=>{let r={id:e.id,vehicleTreatmentID:e.vehicleTreatmentID,fittingChargeName:e.fittingChargeName,paintName:e.paintName,partName:e.partName,other:e.other,sh:e.sh,repairName:e.repairName,priceType:e.priceType,type:e.type,partNumber:e.partNumber,availableQuantity:e.availableQuantity,unitPrice:e.unitPrice,treatmentType:e.treatmentType,quantity:e.quantity,isSystemPrice:e.isSystemPrice,isPriceConfirmed:e.isPriceConfirmed,approvedDate:e.approvedDate?F(e.approvedDate):void 0,price:e.price,customPrice:e.customPrice,approvedPrice:e.approvedPrice,approvedPriceState:e.approvedPriceState,estimateTreatmentReason:e.estimateTreatmentReason,opsUnitID:e.opsUnitID,createdBy:e.createdBy,createdDate:e.createdDate,lastModifiedBy:e.lastModifiedBy,lastModifiedDate:e.lastModifiedDate,estimate:{id:t}};this._estimateTreatmentService.update(r).subscribe(i=>{console.log("\u{1F6E0}\uFE0F Estimate Treatment Updated:",i.body),this._snackBarService.open("Estimate Updated Successfully!","Close",{duration:3e3})})})}getNextEstimateID(){let t={page:0,size:1,sort:"estimateID,desc"};return new Promise(e=>{this._estimateService.query(t).subscribe(r=>{let i=r.body?.[0],n="EST-000001";i?.estimateID&&(n="EST-"+(parseInt(i.estimateID.replace("EST-",""),10)+1).toString().padStart(6,"0")),e(n)})})}onEstimatePriceInput(t,e,r){let n=t.target.value.replace(/,/g,""),a=parseFloat(n);isNaN(a)||(e.price=a,this.onLineInputChange("price",a,e,r))}onApprovedPriceInput(t,e,r){let n=t.target.value.replace(/,/g,""),a=parseFloat(n);isNaN(a)||(e.approvedPrice=a,this.onLineInputChange("approvedPrice",a,e,r))}static{this.\u0275fac=function(e){return new(e||c)(_(Me),_(De),_(Re),_(we),_(Pe),_(Be),_(Se),_(Ae),_(ee),_(Ne),_(me),_(te),_(Ie))}}static{this.\u0275cmp=U({type:c,selectors:[["app-create-estimate"]],viewQuery:function(e,r){if(e&1&&(k(Ve,5),k(ke,5)),e&2){let i;V(i=O())&&(r.paginator=i.first),V(i=O())&&(r.sort=i.first)}},decls:5,vars:4,consts:[["auto","matAutocomplete"],[1,"absolute","inset-0","flex","min-w-0","flex-col","overflow-hidden"],["class","bg-default flex flex-0 flex-col p-6 dark:bg-transparent sm:flex-row sm:items-center sm:justify-between sm:px-10 sm:pt-3",4,"ngIf"],["class","px-4 mb-3",4,"ngIf"],["class","flex gap-4 px-6 mt-3",4,"ngIf"],["class","px-6 mt-2 overflow-x-auto w-full",4,"ngIf"],[1,"bg-default","flex","flex-0","flex-col","p-6","dark:bg-transparent","sm:flex-row","sm:items-center","sm:justify-between","sm:px-10","sm:pt-3"],[1,"min-w-0","flex-1"],[1,"mt-2"],[1,"flex","flex-col","md:flex-row","items-center","gap-4"],[1,"flex","items-center","gap-2"],[1,"px-1","py-1","text-white","rounded-xl","transition-all","bg-amber-400"],[1,"flex","h-10","w-10","items-center","justify-center","rounded-lg","bg-indigo-100","text-indigo-800","dark:bg-indigo-600","dark:text-indigo-50"],[1,"text-current","text-2xl",3,"svgIcon"],[1,"flex","w-full","md:w-auto","flex-1","items-center","gap-2"],[1,"relative","w-full"],[1,"w-full","p-3","pl-12","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-amber-400",3,"keydown.enter","formControl","placeholder"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none","text-gray-400"],[1,"px-4","py-3","bg-gradient-to-r","from-rose-500","to-red-500","hover:from-rose-600","hover:to-red-600","rounded-lg","shadow","text-white","flex","items-center","transition-all","duration-200",3,"click"],[1,"font-semibold"],[1,"px-4","mb-3"],[1,"flex","flex-wrap","gap-3","px-2"],["class","bg-amber-500 text-white text-sm md:text-base font-medium px-4 py-2 rounded-2xl shadow hover:bg-amber-600 hover:scale-[1.03] transition-all duration-200 ease-in-out cursor-pointer","matTooltip","Click to load estimate details",3,"click",4,"ngFor","ngForOf"],["matTooltip","Click to load estimate details",1,"bg-amber-500","text-white","text-sm","md:text-base","font-medium","px-4","py-2","rounded-2xl","shadow","hover:bg-amber-600","hover:scale-[1.03]","transition-all","duration-200","ease-in-out","cursor-pointer",3,"click"],[1,"flex","flex-col","gap-1","leading-tight"],[1,"text-sm","opacity-90","italic"],[1,"flex","gap-4","px-6","mt-3"],[1,"rounded-2xl","w-full"],[1,"bg-white","flex","flex-col","rounded-lg","p-6","h-full","space-y-4"],["class","w-full mb-6 flex justify-between items-center",4,"ngIf"],[1,"flex","flex-col","md:flex-row","gap-6"],[1,"flex","flex-1","items-center"],[1,"flex","h-14","w-14","items-center","justify-center","rounded-2xl","bg-indigo-100","text-indigo-800","dark:bg-indigo-600","dark:text-indigo-50"],[1,"text-current","text-xl",3,"svgIcon"],[1,"ml-4","leading-tight"],[1,"text-secondary","text-sm","font-medium"],[1,"text-lg","font-semibold"],[1,"bg-amber-500","text-white","px-3","py-1","mt-2","text-sm","rounded-lg"],[1,"text-sm","text-gray-500"],[1,"flex","flex-wrap","gap-2","mt-2"],[1,"bg-amber-500","text-white","px-3","py-1","rounded-lg"],[1,"bg-red-500","text-white","px-3","py-1","rounded-lg"],[1,"flex","h-14","w-14","items-center","justify-center","rounded-2xl","bg-teal-100","text-teal-800","dark:bg-teal-600","dark:text-teal-50"],[1,"text-sm","text-gray-500","mt-1"],[1,"bg-teal-500","text-white","px-3","py-1","rounded-lg"],[1,"bg-teal-500","text-white","px-3","mt-1","py-1","rounded-lg"],[1,"flex","h-14","w-14","items-center","justify-center","rounded-2xl","bg-red-100","text-red-800","dark:bg-teal-600","dark:text-teal-50"],[1,"w-full","mb-6","flex","justify-between","items-center"],[1,"text-xl","text-white","bg-indigo-600","rounded-lg","px-3","py-1","group-hover:bg-indigo-700","transition"],[1,"flex","flex-row","gap-2"],["mat-button","",1,"px-4","py-3","bg-gradient-to-r","from-indigo-500","to-blue-500","hover:from-indigo-600","hover:to-blue-600","rounded-lg","shadow","text-white","flex","items-center","transition-all","duration-200",3,"click"],[1,"mr-2"],[1,""],[1,"px-6","mt-2","overflow-x-auto","w-full"],[4,"ngFor","ngForOf"],["class","mb-2 w-full p-3 bg-white rounded-lg",4,"ngIf"],[1,"mb-2","w-full","p-3","bg-white","rounded-lg"],[1,"text-2xl","font-bold","capitalize","mb-4","text-indigo-600"],[1,"flex","gap-4","font-semibold","text-sm","text-gray-700","w-full"],[1,"flex-1","min-w-[200px]"],["class","flex-1 min-w-[150px]",4,"ngIf"],[1,"flex-1","min-w-[150px]"],["class","flex gap-4 w-full mt-2",4,"ngFor","ngForOf"],[1,"flex","gap-4","w-full","mt-2"],[1,"relative","flex-1","min-w-[200px]"],["type","text","matInput","","placeholder","Select Work",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-amber-400","appearance-none",3,"ngModelChange","focus","input","matAutocomplete","ngModel"],[3,"optionSelected"],[3,"value",4,"ngFor","ngForOf"],[1,"relative","flex-1","min-w-[150px]"],["type","text","placeholder","Price",1,"w-full","text-right","p-3","pl-12","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-amber-400",3,"input","value"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","pointer-events-none","text-gray-500","text-lg","font-semibold"],[3,"value"],["type","text",1,"w-full","p-3","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-amber-400",3,"ngModelChange","ngModel"]],template:function(e,r){e&1&&(s(0,"div",1),x(1,We,20,4,"div",2)(2,Qe,3,1,"div",3)(3,He,42,12,"div",4)(4,et,2,2,"div",5),o()),e&2&&(l(),d("ngIf",!r.esitamteID),l(),d("ngIf",!r.esitamte),l(),d("ngIf",r.esitamte),l(),d("ngIf",r.esitamte))},dependencies:[Z,J,X,K,Y,fe,de,ue,ve,ge,_e,oe,be,xe,ie,ye,ne,re,Te,Ce,Oe,se,ae,ce,Ee],encapsulation:2})}}return c})();export{$t as a};
