import{a as Te}from"./chunk-5B6KG46D.js";import{a as Pe}from"./chunk-7T3DP6DK.js";import{a as Be}from"./chunk-J5ZNQ65F.js";import{b as De}from"./chunk-FKEP7USQ.js";import{d as Ee}from"./chunk-MBFKKYVB.js";import"./chunk-2BGIWFS4.js";import{a as q,b as Ie}from"./chunk-JCUL3757.js";import"./chunk-R44K775J.js";import{a as z}from"./chunk-PH6QFVW6.js";import{a as he,b as ge,c as _e,d as xe,e as ye,f as Ce,g as Se,h as be,i as ve,j as we,k as Ne}from"./chunk-4HPTI4QK.js";import{a as M,b as Me}from"./chunk-4IV6I57G.js";import{b as ke}from"./chunk-T73PE35A.js";import{a as fe}from"./chunk-E4TC4E2W.js";import{a as w}from"./chunk-YEGTZ3HQ.js";import"./chunk-OT3AQSDR.js";import"./chunk-4WAQRQWE.js";import"./chunk-HLRQKUHW.js";import"./chunk-5RBAZJQA.js";import{J as de,O as ce,P as ue,d as te,i as ie,j as ne,l as me,q as se,w as pe}from"./chunk-MXRUEL7B.js";import{b as re,c as le}from"./chunk-PNSBUHWU.js";import{c as ee}from"./chunk-TEYA6QDP.js";import"./chunk-JTAP5U5F.js";import{a as ae,d as oe}from"./chunk-VPJKTFM7.js";import"./chunk-GXFYRQIF.js";import"./chunk-T4I3R2GV.js";import{i as Z}from"./chunk-DJWEABC6.js";import{n as K,p as W,r as Y}from"./chunk-MZLVPJ5Q.js";import{Aa as I,Bc as l,Db as G,Dc as f,E as H,Jc as J,Kb as d,Qc as R,Sc as O,Tb as h,Vb as P,a as V,ba as j,cc as a,dc as r,ec as g,fc as c,g as F,gc as u,ic as L,nb as p,oa as y,ob as T,oc as _,qc as B,t as $,uc as Q,vc as U,wc as X,y as A,za as E}from"./chunk-2GFQMTJ2.js";var ze=()=>[5,10,20];function qe(e,o){e&1&&(a(0,"th",40),l(1," Code "),r())}function Ve(e,o){if(e&1&&(a(0,"td",41),l(1),r()),e&2){let t=o.$implicit;p(),f(" ",t.grncode," ")}}function Fe(e,o){e&1&&(a(0,"th",40),l(1," ID "),r())}function $e(e,o){if(e&1&&(a(0,"td",41),l(1),r()),e&2){let t=o.$implicit;p(),f(" ",t.id," ")}}function Ae(e,o){e&1&&(a(0,"th",40),l(1," Name "),r())}function He(e,o){if(e&1&&(a(0,"td",41),l(1),r()),e&2){let t=o.$implicit;p(),f(" ",t.suppliername," ")}}function je(e,o){e&1&&(a(0,"th",40),l(1," GRN Value "),r())}function Ge(e,o){if(e&1&&(a(0,"td",41),l(1),r()),e&2){let t=o.$implicit;p(),f(" ",t.amountowing," ")}}function Le(e,o){e&1&&(a(0,"th",40),l(1," GRN date "),r())}function Qe(e,o){if(e&1&&(a(0,"td",41),l(1),R(2,"date"),r()),e&2){let t=o.$implicit;p(),f(" ",O(2,1,t.grnDate,"yyyy-MM-dd")," ")}}function Ue(e,o){e&1&&(a(0,"th",40),l(1," Invoice Code "),r())}function Xe(e,o){if(e&1&&(a(0,"td",41),l(1),r()),e&2){let t=o.$implicit;p(),f(" ",t.invoicecode," ")}}function Je(e,o){e&1&&(a(0,"th",40),l(1," Credit Period "),r())}function Ke(e,o){if(e&1&&(a(0,"td",41),l(1),r()),e&2){let t=o.$implicit;p(),f(" ",t.creditperiod," ")}}function We(e,o){e&1&&(a(0,"th",40),l(1," Days Due "),r())}function Ye(e,o){if(e&1&&(a(0,"td",41),l(1),r()),e&2){let t=o.$implicit;p(),f(" ",t.daysdue," ")}}function Ze(e,o){e&1&&(a(0,"th",40),l(1," Credit Limit "),r())}function et(e,o){if(e&1&&(a(0,"td",41),l(1),r()),e&2){let t=o.$implicit;p(),f(" ",t.creditlimit," ")}}function tt(e,o){e&1&&(a(0,"th",40),l(1," Days Diff "),r())}function it(e,o){if(e&1&&(a(0,"td",41),l(1),r()),e&2){let t=o.$implicit;p(),f(" ",t.daysdiff," ")}}function nt(e,o){e&1&&g(0,"th",42)}function at(e,o){if(e&1){let t=L();a(0,"td",43)(1,"div",44)(2,"button",45),_("click",function(){let n=E(t).$implicit,s=B();return I(s.viewopenSupplierViewDialog(n.id,n.suppliername,n.grncode))}),l(3," View "),r(),a(4,"button",45),_("click",function(){let n=E(t).$implicit,s=B();return I(s.updateAmountOwing(n.id,n.amountowing))}),l(5," Paid "),r()()()}}function ot(e,o){e&1&&g(0,"tr",46)}function rt(e,o){e&1&&g(0,"tr",47)}var Re=(()=>{class e{fetchpaymentdata(){this.grnservice.query("amountOwing.notEquals=0&page=0&size=20").subscribe({next:t=>{let i=t.body??[],n=t.headers.get("X-Total-Count");this.totalItems=n?+n:0,this.totalPages=Math.ceil(this.totalItems/this.pageSize);let s=i.map(m=>this.supplier.query(`name.equals=${m.supplierName}`).pipe(j(C=>{let v=C.body?.[0];return v?this.supplierbanks.find(v.id).pipe(A(x=>{let S=w(m.grnDate),b=w(),N=x.creditPeriod||0,k=S.add(N,"day").diff(b,"day"),D=b.diff(S,"day");return{id:m.id,grncode:m.grnCode||"",grnDate:S,amountowing:m.amountOwing||0,suppliername:m.supplierName||"",invoicecode:m.invoiceCode||"",creditlimit:x.maximumCreditLimit||0,creditperiod:N,daysdue:k,daysdiff:D,bankInfo:x}})):$(null)})));H(s).subscribe(m=>{this.nextpaymentdata=m.filter(Boolean),console.log("Fetched payment data:",this.nextpaymentdata)})},error:t=>{console.error("Error fetching GRNs:",t)}})}totalAmountOwing(){let t={"amountOwing.greaterThan":0,page:0,size:1e3};this.grnservice.query({"amountOwing.greaterThan":0,"inspected.equals":!1,size:1e9}).subscribe({next:i=>{let n=i.body?.content||i.body||i;console.log("Fetched data:",n);let s=n.reduce((m,C)=>m+(C.amountOwing||0),0);this.totalOwing=s,console.log("Total Amount Owing:",this.totalOwing)},error:i=>{console.error("Failed to fetch data:",i)}})}openSupplierViewDialog(t){this._dialogService.open(Pe,{data:{id:t}})}toggleDetails(t){this.supplierbankacc.find(t).subscribe({next:i=>{console.log("Bank Account:",i)},error:i=>console.error("Bank Account error:",i)}),this.supplierbank.find(t).subscribe({next:i=>{console.log("Bank:",i)},error:i=>console.error("Bank error:",i)}),this.supservice.find(t).subscribe({next:i=>{console.log("Supplier:",i)},error:i=>console.error("Supplier error:",i)})}onPaginateChange(t){this.pageSize=t.pageSize,this.currentPage=t.pageIndex+1,this.loadSuppliers()}deleteSupplier(t){this.supplierbankacc.delete(t).subscribe({next:()=>{this.supplierbank.delete(t).subscribe({next:()=>{this.supservice.delete(t).subscribe({next:()=>{this._snackBarService.open("Supplier deleted successfully!","Close",{duration:3e3}),this.loadSuppliers()},error:i=>{console.error("Supplier delete failed",i),this._snackBarService.open("Supplier delete failed","Close",{duration:3e3})}})},error:i=>{console.error("Supplier bank delete failed",i),this._snackBarService.open("Supplier bank delete failed","Close",{duration:3e3})}})},error:i=>{console.error("Supplier bank account delete failed",i),this._snackBarService.open("Supplier bank account delete failed","Close",{duration:3e3})}})}updateAmountOwing(t,i){let n={inspected:!0,total:i};this.grnservice.partialUpdate(V({id:t},n)).subscribe({next:s=>{console.log("Update successful:",s),this.paginator&&this.paginator.firstPage(),this.currentPage=1,this.loadSuppliers()},error:s=>{console.error("Update failed:",s)}})}ngOnInit(){this.loadSuppliers()}refreshFilters(){this.filter.code="",this.filter.name="",this.searchByCode=!0,this.loadSuppliers()}get displayedColumns(){let t=["code","vehicleOwnerName","vehicleBrand","vehicleModel","creditperiod","invoicecode","daysdue","creditlimit","daysdiff","action"];return this.showId&&t.unshift("id"),t}constructor(t,i){this._dialogService=t,this._snackBarService=i,this.nextpaymentdata=[],this.grnservice=y(De),this.supplierbanks=y(q),this.supplier=y(z),this.upservice=y(z),this.supplierbank=y(Ie),this.supplierbankacc=y(q),this.currentPage=1,this.pageSize=10,this.totalItems=0,this.totalPages=0,this.searchByCode=!1,this.filter={name:"",code:""},this.totalOwing=0,this.selectedSupplierId=3,this.itemsPerPage=10,this.showId=!1}openVehicleCreateDialog(){this._dialogService.open(Te,{width:"80vh",maxHeight:"95vh"}).afterClosed().subscribe(i=>{i&&this._snackBarService.open("Vehicle Created Successfully!","Close",{duration:3e3})})}viewopenSupplierViewDialog(t,i,n){this._dialogService.open(Be,{width:"900px",height:"auto",data:{id:t,name:i,code:n}})}loadSuppliers(){let t={page:this.currentPage-1,size:this.pageSize,"inspected.in":!1};console.log(this.filter.code.trim()),this.totalAmountOwing(),this.filter.name.trim()&&(t["supplierName.contains"]=this.filter.name.trim()),this.filter.code.trim()&&(t["grnCode.contains"]=this.filter.code.trim()),this.grnservice.query(t).subscribe({next:i=>F(this,null,function*(){let n=i.body??[],s=i.headers.get("X-Total-Count");this.totalItems=s?+s:0,this.totalPages=Math.ceil(this.totalItems/this.pageSize),console.log(n),this.nextpaymentdata=[];for(let m of n)try{let v=(yield this.supplier.query({"name.equals":m.supplierName}).toPromise()).body?.[0],x=null,S=0,b=0;v?.id&&(x=(yield this.supplierbanks.query({"id.equals":v.id}).toPromise()).body[0],S=x?.maximumCreditLimit||0,b=x?.creditPeriod||0);let N=w(m.grnDate),k=w().diff(N,"day"),D=b-k;this.nextpaymentdata=[...this.nextpaymentdata,{id:m.id,grncode:m.grnCode||"",grnDate:m.grnDate,amountowing:m.amountOwing||0,suppliername:m.supplierName||"",invoicecode:m.supplierInvoiceCode||"",creditlimit:S,creditperiod:b,daysdue:D,daysdiff:k,bankInfo:x}]}catch(C){console.error("Error loading supplier or bank info:",C)}}),error:i=>{console.error("Error fetching GRNs:",i)}})}goToPage(t){t>=1&&t<=this.totalPages&&(this.currentPage=t,this.loadSuppliers())}nextPage(){this.goToPage(this.currentPage+1)}previousPage(){this.goToPage(this.currentPage-1)}onSearch(){this.currentPage=1,this.loadSuppliers()}onRowCountChange(){this.currentPage=1,this.loadSuppliers()}static{this.\u0275fac=function(i){return new(i||e)(T(ee),T(fe))}}static{this.\u0275cmp=G({type:e,selectors:[["app-nextpayment"]],viewQuery:function(i,n){if(i&1&&Q(M,5),i&2){let s;U(s=X())&&(n.paginator=s.first)}},decls:65,vars:27,consts:[[1,"absolute","inset-0","flex","min-w-0","flex-col","overflow-hidden"],[1,"bg-default","flex","flex-0","flex-col","p-6","pb-22","dark:bg-transparent","sm:flex-row","sm:items-center","sm:justify-between","sm:px-10","sm:pb-28","sm:pt-12"],[1,"min-w-0","flex-1"],[1,"truncate","text-3xl","font-extrabold","leading-7","tracking-tight","sm:leading-10","md:text-4xl"],[1,"mt-6","flex","shrink-0","items-center","sm:ml-4","sm:mt-0"],[1,"flex","gap-2","mr-4"],["aria-label","Search by Code",1,"px-2","py-2","text-white","rounded-xl","transition-all","hover:bg-amber-400",3,"click"],[1,"flex","h-10","w-10","items-center","justify-center","rounded-lg","bg-indigo-100","text-indigo-800","dark:bg-indigo-600","dark:text-indigo-50"],[1,"text-2xl",3,"svgIcon"],["aria-label","Search by Name",1,"px-2","py-2","text-white","rounded-xl","transition-all","hover:bg-amber-400",3,"click"],["aria-label","Refresh Filters","title","Clear filters and reload",1,"px-2","py-2","text-white","rounded-xl","transition-all","hover:bg-amber-400","bg-gray-300",3,"click"],["svgIcon","mat_outline:refresh",1,"text-2xl"],[1,"fuse-mat-dense","fuse-mat-rounded","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","","autocomplete","off",3,"ngModelChange","keydown.enter","placeholder","ngModel"],["mat-flat-button","","color","primary",1,"ml-3",3,"click"],[1,"icon-size-4",3,"svgIcon"],[1,"ml-2"],[1,"example-table-container","bg-card","-mt-16","h-full","rounded-t-2xl","shadow","overflow-auto",2,"min-height","0"],[1,"flex","flex-col","flex-auto","sm:mb-18","overflow-auto"],["mat-table","","matSort","",1,"w-full","table-fixed","border-separate","border-spacing-y-2",3,"dataSource"],["matColumnDef","code"],["mat-header-cell","","mat-sort-header","","class","px-4 py-3 text-left font-semibold",4,"matHeaderCellDef"],["mat-cell","","class","px-4 py-2",4,"matCellDef"],["matColumnDef","id"],["matColumnDef","vehicleOwnerName"],["matColumnDef","vehicleBrand"],["matColumnDef","vehicleModel"],["matColumnDef","invoicecode"],["matColumnDef","creditperiod"],["matColumnDef","daysdue"],["matColumnDef","creditlimit"],["matColumnDef","daysdiff"],["matColumnDef","action"],["mat-header-cell","","class","px-4 py-3 text-left font-semibold w-48",4,"matHeaderCellDef"],["mat-cell","","class","px-4 py-2 w-48 whitespace-nowrap",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[3,"page","length","pageSize","pageIndex","pageSizeOptions"],[1,"fixed","bottom-2","left-1/2","transform","-translate-x-1/2","p-4","font-semibold","text-2xl","w-auto"],["mat-header-cell","","mat-sort-header","",1,"px-4","py-3","text-left","font-semibold"],["mat-cell","",1,"px-4","py-2"],["mat-header-cell","",1,"px-4","py-3","text-left","font-semibold","w-48"],["mat-cell","",1,"px-4","py-2","w-48","whitespace-nowrap"],[1,"flex","gap-2"],["mat-flat-button","","color","primary",1,"fuse-mat-button-large",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(i,n){i&1&&(a(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),l(4," Next Payment "),r()(),a(5,"div",4)(6,"div",5)(7,"button",6),_("click",function(){return n.searchByCode=!0}),a(8,"div",7),g(9,"mat-icon",8),r()(),a(10,"button",9),_("click",function(){return n.searchByCode=!1}),a(11,"div",7),g(12,"mat-icon",8),r()(),a(13,"button",10),_("click",function(){return n.refreshFilters()}),a(14,"div",7),g(15,"mat-icon",11),r()()(),a(16,"mat-form-field",12),g(17,"mat-icon",13),a(18,"input",14),_("ngModelChange",function(m){return n.searchByCode?n.filter.code=m:n.filter.name=m})("keydown.enter",function(){return n.loadSuppliers()}),r()(),a(19,"button",15),_("click",function(){return n.loadSuppliers()}),g(20,"mat-icon",16),a(21,"span",17),l(22,"Search"),r()()()(),a(23,"div",18)(24,"div",19)(25,"table",20),c(26,21),d(27,qe,2,0,"th",22)(28,Ve,2,1,"td",23),u(),c(29,24),d(30,Fe,2,0,"th",22)(31,$e,2,1,"td",23),u(),c(32,25),d(33,Ae,2,0,"th",22)(34,He,2,1,"td",23),u(),c(35,26),d(36,je,2,0,"th",22)(37,Ge,2,1,"td",23),u(),c(38,27),d(39,Le,2,0,"th",22)(40,Qe,3,4,"td",23),u(),c(41,28),d(42,Ue,2,0,"th",22)(43,Xe,2,1,"td",23),u(),c(44,29),d(45,Je,2,0,"th",22)(46,Ke,2,1,"td",23),u(),c(47,30),d(48,We,2,0,"th",22)(49,Ye,2,1,"td",23),u(),c(50,31),d(51,Ze,2,0,"th",22)(52,et,2,1,"td",23),u(),c(53,32),d(54,tt,2,0,"th",22)(55,it,2,1,"td",23),u(),c(56,33),d(57,nt,1,0,"th",34)(58,at,6,0,"td",35),u(),d(59,ot,1,0,"tr",36)(60,rt,1,0,"tr",37),r()()(),a(61,"mat-paginator",38),_("page",function(m){return n.onPaginateChange(m)}),r(),a(62,"div",39),l(63),R(64,"number"),r()()),i&2&&(p(7),P("bg-amber-400",n.searchByCode)("bg-gray-300",!n.searchByCode),p(2),h("svgIcon","mat_outline:qr_code_scanner"),p(),P("bg-amber-400",!n.searchByCode)("bg-gray-300",n.searchByCode),p(2),h("svgIcon","heroicons_outline:user-circle"),p(4),h("subscriptSizing","dynamic"),p(),h("svgIcon",n.searchByCode?"mat_outline:qr_code_scanner":"heroicons_solid:magnifying-glass"),p(),h("placeholder",n.searchByCode?"Search by Code":"Search by Name")("ngModel",n.searchByCode?n.filter.code:n.filter.name),p(2),h("svgIcon","heroicons_mini:magnifying-glass"),p(5),h("dataSource",n.nextpaymentdata),p(34),h("matHeaderRowDef",n.displayedColumns),p(),h("matRowDefColumns",n.displayedColumns),p(),h("length",n.totalItems)("pageSize",n.pageSize)("pageIndex",n.currentPage-1)("pageSizeOptions",J(26,ze)),p(2),f(" Total Amount Owing: ",O(64,23,n.totalOwing,"1.2-2"),`
`))},dependencies:[Y,W,K,de,me,se,pe,Z,Me,M,Ne,he,_e,Se,xe,ge,be,ye,Ce,ve,we,ne,ie,te,ue,ce,ke,oe,ae,Ee,le,re],encapsulation:2})}}return e})();var Ut=[{path:"",component:Re,children:[]}];export{Ut as default};
